(()=>{var t={913:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.isEnvironmentValid=t=>this.environments.includes(t),this.setEnvironment=t=>{t&&this.isEnvironmentValid(t)&&(this.environment=t,t===this.environmentStaging?(this.apiUrl=this.apiUrlStaging,this.eventsUrl=this.eventsUrlStaging):t===this.environmentLocal?(this.apiUrl=this.apiUrlLocal,this.eventsUrl=this.eventsUrlLocal):t===this.environmentProduction&&(this.apiUrl=this.apiUrlProduction,this.eventsUrl=this.eventsUrlProduction))},this.environmentLocal="local",this.environmentStaging="staging",this.environmentProduction="production",this.apiUrl="https://api.tonicpow.com",this.apiUrlLocal="http://localhost:3000",this.apiUrlStaging="https://api.staging.tonicpow.com",this.apiUrlProduction="https://api.tonicpow.com",this.eventsUrl="https://events.tonicpow.com",this.eventsUrlLocal="http://localhost:3002",this.eventsUrlStaging="https://events.staging.tonicpow.com",this.eventsUrlProduction="https://events.tonicpow.com",this.customEnvironment="data-environment",this.environment="",this.environments=[this.environmentLocal,this.environmentStaging,this.environmentProduction],this.maxSessionDays=60,this.sessionName="tncpw_session",this.version="v0.0.8",this.widgetDivClass="tonicpow-widget",this.widgetId="data-widget-id"}}}.apply(e,[i,e]))||(t.exports=n)},242:function(t,e,i){var n,o,s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(913)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=s(i),e.default=class{constructor(t){this.detectBounce=()=>{window.onbeforeunload=()=>{this.sendEvent("bounce",((new Date).getTime()-this.start).toString())}},this.detectInteraction=()=>{let t=!1;document.addEventListener("mousedown",(async()=>{if(!t)try{await this.sendEvent("interaction","mousedown"),t=!0}catch(t){console.error("failed to report interaction: mousedown",t)}})),document.addEventListener("scroll",(async()=>{if(!t)try{await this.sendEvent("interaction","scroll"),t=!0}catch(t){console.error("failed to report interaction: scroll",t)}})),document.addEventListener("keypress",(async()=>{if(!t)try{await this.sendEvent("interaction","keypress"),t=!0}catch(t){console.error("failed to report interaction: keypress",t)}})),document.addEventListener("click",(async()=>{if(!t)try{await this.sendEvent("interaction","click"),t=!0}catch(t){console.error("failed to report interaction: click",t)}}))},this.sendEvent=async(t,e)=>{if(!this.sessionId)return void console.info("you must call init with a session before sending events");let n=new i.default;await fetch(`${n.eventsUrl}/v1/events?v=${n.version}&name=${t}&tncpw_session=${this.sessionId}&data=${e}`,{method:"get"})},this.sessionId=t,this.start=(new Date).getTime(),this.detectInteraction(),this.detectBounce()}}}.apply(e,n))||(t.exports=o)},607:function(t,e,i){var n,o,s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(913),i(242),i(912)],void 0===(o=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=s(i),n=s(n),o=s(o);const r={AutoInit:!0};class a{constructor(t=r){this.registerEvents=()=>{let t=this.getVisitorSession();t&&(console.log("registering session",t),this.events=new n.default(t))},this.setOreo=(t,e,i)=>{const n=new Date;n.setTime(n.getTime()+864e5*i),document.cookie=`${t}=${e};path=/;expires=${n.toUTCString()}`},this.captureVisitorSession=(t="")=>{let e=t;return t&&t.length||"undefined"==typeof window||(e=new URLSearchParams(window.location.search).get(this.config.sessionName)||""),e&&e.length>0?(this.setOreo(this.config.sessionName,e,this.config.maxSessionDays),this.storage.setStorage(this.config.sessionName,e,86400*this.config.maxSessionDays),e):null},this.getVisitorSession=()=>this.storage.getStorage(this.config.sessionName),this.loadDivs=async()=>{const t=document.getElementsByClassName(this.config.widgetDivClass);for(let e=t.length-1;e>=0;e--){const i=t[e],n=i.getAttribute(this.config.widgetId);if(!n){console.log(`${n} not found`);continue}const o=i.getAttribute(this.config.customEnvironment);this.config.setEnvironment(o||"production");const s=await fetch(`${this.config.apiUrl}/v1/widgets/display/${n}?provider=embed-${this.config.version}`),r=await s.json(),a=encodeURIComponent(r.title);i.innerHTML=`\n    <a href="${r.link_url}?utm_source=tonicpow-widgets&utm_medium=widget&utm_campaign=${n}&utm_content=${a}">\n      <img src="${r.image_url}" \n      width="${r.width}" \n      height="${r.height}" \n      alt="${r.title}" />\n    </a>`,i.setAttribute("data-width",r.width),i.setAttribute("data-height",r.height)}},this.load=()=>{if("undefined"==typeof window)return void console.error("TonicPow embed only works in the browser");const t=document.getElementsByClassName(this.config.widgetDivClass);t&&t.length>0&&this.loadDivs().then((()=>{console.log("TonicPow widget(s) loaded!")}));const e=this.captureVisitorSession();e&&(this.events=new n.default(e))};for(let[e,i]of Object.entries(t))Object.defineProperty(this,e,{value:i,writable:!1});this.config=new i.default,this.storage=new o.default,t.AutoInit&&("complete"===document.readyState||"interactive"===document.readyState?(this.load(),this.registerEvents()):document.addEventListener("DOMContentLoaded",(()=>{this.load(),this.registerEvents()})))}}e.default=a,window.TonicPow=a||{}}.apply(e,n))||(t.exports=o)},912:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.removeStorage=t=>{try{localStorage.removeItem(t),localStorage.removeItem(`${t}_expiresIn`)}catch(e){return console.log(`removeStorage: Error removing key [${t}] from localStorage: ${JSON.stringify(e)}`),!1}return!0},this.getStorage=t=>{const e=Date.now();let i;try{i=localStorage.getItem(`${t}_expires`)}catch(t){return console.log(`getItem: error getting localStorage: ${JSON.stringify(t)}`),null}if(null==i&&(i=0),i<e)return this.removeStorage(t),null;try{return localStorage.getItem(t)}catch(e){return console.log(`getStorage: Error reading key [${t}] from localStorage: ${JSON.stringify(e)}`),null}},this.setStorage=(t,e,i=null)=>{i=i?Math.abs(i):86400;const n=Date.now()+1e3*i;try{localStorage.setItem(t,e),localStorage.setItem(`${t}_expires`,n.toString())}catch(e){return console.log(`setStorage: Error setting key [${t}] in localStorage: ${JSON.stringify(e)}`),!1}return!0}}}}.apply(e,[i,e]))||(t.exports=n)}},e={};!function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2NvbmZpZy50cyIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2V2ZW50cy50cyIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvc3RvcmFnZS50cyIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbImlzRW52aXJvbm1lbnRWYWxpZCIsImVudmlyb25tZW50IiwidGhpcyIsImVudmlyb25tZW50cyIsImluY2x1ZGVzIiwic2V0RW52aXJvbm1lbnQiLCJlbnZpcm9ubWVudFN0YWdpbmciLCJhcGlVcmwiLCJhcGlVcmxTdGFnaW5nIiwiZXZlbnRzVXJsIiwiZXZlbnRzVXJsU3RhZ2luZyIsImVudmlyb25tZW50TG9jYWwiLCJhcGlVcmxMb2NhbCIsImV2ZW50c1VybExvY2FsIiwiZW52aXJvbm1lbnRQcm9kdWN0aW9uIiwiYXBpVXJsUHJvZHVjdGlvbiIsImV2ZW50c1VybFByb2R1Y3Rpb24iLCJjdXN0b21FbnZpcm9ubWVudCIsIm1heFNlc3Npb25EYXlzIiwic2Vzc2lvbk5hbWUiLCJ2ZXJzaW9uIiwid2lkZ2V0RGl2Q2xhc3MiLCJ3aWRnZXRJZCIsInNlc3Npb25JZCIsImRldGVjdEJvdW5jZSIsIndpbmRvdyIsIm9uYmVmb3JldW5sb2FkIiwic2VuZEV2ZW50IiwiRGF0ZSIsImdldFRpbWUiLCJzdGFydCIsInRvU3RyaW5nIiwiZGV0ZWN0SW50ZXJhY3Rpb24iLCJpbnRlcmFjdGlvblNlbnQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhc3luYyIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJldmVudE5hbWUiLCJkYXRhIiwiaW5mbyIsImNvbmZpZyIsImZldGNoIiwibWV0aG9kIiwiZGVmYXVsdE9wdGlvbnMiLCJBdXRvSW5pdCIsIlRvbmljUG93Iiwib3B0aW9ucyIsInJlZ2lzdGVyRXZlbnRzIiwic2Vzc2lvbiIsImdldFZpc2l0b3JTZXNzaW9uIiwibG9nIiwiZXZlbnRzIiwic2V0T3JlbyIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkYXRlIiwic2V0VGltZSIsImNvb2tpZSIsInRvVVRDU3RyaW5nIiwiY2FwdHVyZVZpc2l0b3JTZXNzaW9uIiwiY3VzdG9tU2Vzc2lvbklkIiwibGVuZ3RoIiwiVVJMU2VhcmNoUGFyYW1zIiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJzdG9yYWdlIiwic2V0U3RvcmFnZSIsImdldFN0b3JhZ2UiLCJsb2FkRGl2cyIsInRvbmljRGl2cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJpIiwidG9uaWNEaXYiLCJnZXRBdHRyaWJ1dGUiLCJwcm9taXNlIiwicmVzcG9uc2UiLCJqc29uIiwiY2FtcGFpZ25UaXRsZSIsImVuY29kZVVSSUNvbXBvbmVudCIsInRpdGxlIiwiaW5uZXJIVE1MIiwibGlua191cmwiLCJpbWFnZV91cmwiLCJ3aWR0aCIsImhlaWdodCIsInNldEF0dHJpYnV0ZSIsImxvYWQiLCJ0aGVuIiwib3B0aW9uS2V5Iiwib3B0aW9uVmFsIiwiT2JqZWN0IiwiZW50cmllcyIsImRlZmluZVByb3BlcnR5Iiwid3JpdGFibGUiLCJyZWFkeVN0YXRlIiwicmVtb3ZlU3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJKU09OIiwic3RyaW5naWZ5Iiwia2V5Iiwibm93IiwiZXhwaXJlcyIsImdldEl0ZW0iLCJNYXRoIiwiYWJzIiwic2NoZWR1bGUiLCJzZXRJdGVtIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIl0sIm1hcHBpbmdz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LFFDakJXRixDQUFvQixNIiwiZmlsZSI6IndpZGdldC5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbmZpZyB7XHJcbiAgZW52aXJvbm1lbnRMb2NhbDogc3RyaW5nXHJcbiAgZW52aXJvbm1lbnRTdGFnaW5nOiBzdHJpbmdcclxuICBlbnZpcm9ubWVudFByb2R1Y3Rpb246IHN0cmluZ1xyXG4gIGFwaVVybDogc3RyaW5nXHJcbiAgYXBpVXJsTG9jYWw6IHN0cmluZ1xyXG4gIGFwaVVybFN0YWdpbmc6IHN0cmluZ1xyXG4gIGFwaVVybFByb2R1Y3Rpb246IHN0cmluZ1xyXG4gIGV2ZW50c1VybDogc3RyaW5nXHJcbiAgZXZlbnRzVXJsTG9jYWw6IHN0cmluZ1xyXG4gIGV2ZW50c1VybFN0YWdpbmc6IHN0cmluZ1xyXG4gIGV2ZW50c1VybFByb2R1Y3Rpb246IHN0cmluZ1xyXG4gIGN1c3RvbUVudmlyb25tZW50OiBzdHJpbmdcclxuICBlbnZpcm9ubWVudDogc3RyaW5nXHJcbiAgZW52aXJvbm1lbnRzOiBzdHJpbmdbXVxyXG4gIG1heFNlc3Npb25EYXlzOiBudW1iZXJcclxuICBzZXNzaW9uTmFtZTogc3RyaW5nXHJcbiAgdmVyc2lvbjogc3RyaW5nXHJcbiAgd2lkZ2V0RGl2Q2xhc3M6IHN0cmluZ1xyXG4gIHdpZGdldElkOiBzdHJpbmdcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmVudmlyb25tZW50TG9jYWwgPSAnbG9jYWwnXHJcbiAgICB0aGlzLmVudmlyb25tZW50U3RhZ2luZyA9ICdzdGFnaW5nJ1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudFByb2R1Y3Rpb24gPSAncHJvZHVjdGlvbidcclxuXHJcbiAgICB0aGlzLmFwaVVybCA9ICdodHRwczovL2FwaS50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmFwaVVybExvY2FsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCdcclxuICAgIHRoaXMuYXBpVXJsU3RhZ2luZyA9ICdodHRwczovL2FwaS5zdGFnaW5nLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuYXBpVXJsUHJvZHVjdGlvbiA9ICdodHRwczovL2FwaS50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmV2ZW50c1VybCA9ICdodHRwczovL2V2ZW50cy50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmV2ZW50c1VybExvY2FsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMidcclxuICAgIHRoaXMuZXZlbnRzVXJsU3RhZ2luZyA9ICdodHRwczovL2V2ZW50cy5zdGFnaW5nLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuZXZlbnRzVXJsUHJvZHVjdGlvbiA9ICdodHRwczovL2V2ZW50cy50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmN1c3RvbUVudmlyb25tZW50ID0gJ2RhdGEtZW52aXJvbm1lbnQnXHJcbiAgICB0aGlzLmVudmlyb25tZW50ID0gJydcclxuICAgIHRoaXMuZW52aXJvbm1lbnRzID0gW3RoaXMuZW52aXJvbm1lbnRMb2NhbCwgdGhpcy5lbnZpcm9ubWVudFN0YWdpbmcsIHRoaXMuZW52aXJvbm1lbnRQcm9kdWN0aW9uXVxyXG4gICAgdGhpcy5tYXhTZXNzaW9uRGF5cyA9IDYwXHJcbiAgICB0aGlzLnNlc3Npb25OYW1lID0gJ3RuY3B3X3Nlc3Npb24nXHJcbiAgICB0aGlzLnZlcnNpb24gPSAndjAuMC44J1xyXG4gICAgdGhpcy53aWRnZXREaXZDbGFzcyA9ICd0b25pY3Bvdy13aWRnZXQnXHJcbiAgICB0aGlzLndpZGdldElkID0gJ2RhdGEtd2lkZ2V0LWlkJ1xyXG4gIH1cclxuXHJcbiAgLy8gaXNFbnZpcm9ubWVudFZhbGlkIHdpbGwgY2hlY2sgaWYgdGhlIGdpdmVuIGVudmlyb25tZW50IGlzIHZhbGlkXHJcbiAgaXNFbnZpcm9ubWVudFZhbGlkID0gKGVudmlyb25tZW50OiBzdHJpbmcpID0+IHRoaXMuZW52aXJvbm1lbnRzLmluY2x1ZGVzKGVudmlyb25tZW50KVxyXG5cclxuICAvLyBzZXRFbnZpcm9ubWVudCB3aWxsIHNldCB0aGUgZW52aXJvbm1lbnRcclxuICBzZXRFbnZpcm9ubWVudCA9IChlbnZpcm9ubWVudDogc3RyaW5nKSA9PiB7XHJcbiAgICAvLyBObyBlbnZpcm9ubWVudCBzZXQ/IHVzZSB0aGUgZGVmYXVsdFxyXG4gICAgaWYgKCFlbnZpcm9ubWVudCkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBOb3QgYSB2YWxpZCBlbnZpcm9ubWVudD9cclxuICAgIGlmICghdGhpcy5pc0Vudmlyb25tZW50VmFsaWQoZW52aXJvbm1lbnQpKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCB0aGUgZW52aXJvbm1lbnRcclxuICAgIHRoaXMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudFxyXG5cclxuICAgIC8vIFNldCB0aGUgQVBJIHVybFxyXG4gICAgaWYgKGVudmlyb25tZW50ID09PSB0aGlzLmVudmlyb25tZW50U3RhZ2luZykge1xyXG4gICAgICB0aGlzLmFwaVVybCA9IHRoaXMuYXBpVXJsU3RhZ2luZ1xyXG4gICAgICB0aGlzLmV2ZW50c1VybCA9IHRoaXMuZXZlbnRzVXJsU3RhZ2luZ1xyXG4gICAgfSBlbHNlIGlmIChlbnZpcm9ubWVudCA9PT0gdGhpcy5lbnZpcm9ubWVudExvY2FsKSB7XHJcbiAgICAgIHRoaXMuYXBpVXJsID0gdGhpcy5hcGlVcmxMb2NhbFxyXG4gICAgICB0aGlzLmV2ZW50c1VybCA9IHRoaXMuZXZlbnRzVXJsTG9jYWxcclxuICAgIH0gZWxzZSBpZiAoZW52aXJvbm1lbnQgPT09IHRoaXMuZW52aXJvbm1lbnRQcm9kdWN0aW9uKSB7XHJcbiAgICAgIHRoaXMuYXBpVXJsID0gdGhpcy5hcGlVcmxQcm9kdWN0aW9uXHJcbiAgICAgIHRoaXMuZXZlbnRzVXJsID0gdGhpcy5ldmVudHNVcmxQcm9kdWN0aW9uXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBDb25maWcgZnJvbSAnLi9jb25maWcnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFdmVudHMge1xyXG4gIHNlc3Npb25JZDogc3RyaW5nXHJcbiAgc3RhcnQ6IG51bWJlclxyXG5cclxuICBjb25zdHJ1Y3RvcihzZXNzaW9uSWQ6IHN0cmluZykge1xyXG4gICAgLy8gU2V0IHRoZSBjdXJyZW50IHNlc3Npb25cclxuICAgIHRoaXMuc2Vzc2lvbklkID0gc2Vzc2lvbklkXHJcblxyXG4gICAgLy8gUmVtZW1iZXIgd2hlbiB3ZSBzdGFydGVkXHJcbiAgICB0aGlzLnN0YXJ0ID0gbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgIHRoaXMuZGV0ZWN0SW50ZXJhY3Rpb24oKVxyXG4gICAgdGhpcy5kZXRlY3RCb3VuY2UoKVxyXG4gIH1cclxuXHJcbiAgLy8gRGV0ZWN0cyBhIGJvdW5jZSBldmVudFxyXG4gIGRldGVjdEJvdW5jZSA9ICgpID0+IHtcclxuICAgIHdpbmRvdy5vbmJlZm9yZXVubG9hZCA9ICgpID0+IHtcclxuICAgICAgLy8gQ2FsY3VsYXRlIHRpbWUgb24gcGFnZVxyXG4gICAgICB0aGlzLnNlbmRFdmVudCgnYm91bmNlJywgKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5zdGFydCkudG9TdHJpbmcoKSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIERldGVjdHMgYSBwYWdlIGludGVyYWN0aW9uXHJcbiAgZGV0ZWN0SW50ZXJhY3Rpb24gPSAoKSA9PiB7XHJcbiAgICBsZXQgaW50ZXJhY3Rpb25TZW50ID0gZmFsc2VcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghaW50ZXJhY3Rpb25TZW50KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEV2ZW50KCdpbnRlcmFjdGlvbicsICdtb3VzZWRvd24nKVxyXG4gICAgICAgICAgaW50ZXJhY3Rpb25TZW50ID0gdHJ1ZVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZhaWxlZCB0byByZXBvcnQgaW50ZXJhY3Rpb246IG1vdXNlZG93bicsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFpbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ3Njcm9sbCcpXHJcbiAgICAgICAgICBpbnRlcmFjdGlvblNlbnQgPSB0cnVlXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjogc2Nyb2xsJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghaW50ZXJhY3Rpb25TZW50KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEV2ZW50KCdpbnRlcmFjdGlvbicsICdrZXlwcmVzcycpXHJcbiAgICAgICAgICBpbnRlcmFjdGlvblNlbnQgPSB0cnVlXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjoga2V5cHJlc3MnLCBlKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFpbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ2NsaWNrJylcclxuICAgICAgICAgIGludGVyYWN0aW9uU2VudCA9IHRydWVcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBjbGljaycsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLy8gU2VuZCBldmVudCB3aWxsIHNlbmQgYW4gZXZlbnQgdG8gVG9uaWNQb3dcclxuICBzZW5kRXZlbnQgPSBhc3luYyAoZXZlbnROYW1lOiBzdHJpbmcsIGRhdGE6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKCF0aGlzLnNlc3Npb25JZCkge1xyXG4gICAgICBjb25zb2xlLmluZm8oJ3lvdSBtdXN0IGNhbGwgaW5pdCB3aXRoIGEgc2Vzc2lvbiBiZWZvcmUgc2VuZGluZyBldmVudHMnKVxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgY29uZmlnXHJcbiAgICBsZXQgY29uZmlnID0gbmV3IENvbmZpZygpXHJcblxyXG4gICAgLy8gdG9kbzogb2JmdXNjYXRlIHRoZSB1cmwgcGFyYW1zIChjaGFuZ2UgdG8gcGF5bG9hZCBvZiBKU09OPylcclxuICAgIGF3YWl0IGZldGNoKFxyXG4gICAgICBgJHtjb25maWcuZXZlbnRzVXJsfS92MS9ldmVudHM/dj0ke2NvbmZpZy52ZXJzaW9ufSZuYW1lPSR7ZXZlbnROYW1lfSZ0bmNwd19zZXNzaW9uPSR7dGhpcy5zZXNzaW9uSWR9JmRhdGE9JHtkYXRhfWAsXHJcbiAgICAgIHsgbWV0aG9kOiAnZ2V0JyB9XHJcbiAgICApXHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBDb25maWcgZnJvbSAnLi9jb25maWcnXHJcbmltcG9ydCBFdmVudHMgZnJvbSAnLi9ldmVudHMnXHJcbmltcG9ydCBTdG9yYWdlIGZyb20gJy4vc3RvcmFnZSdcclxuXHJcbmludGVyZmFjZSBUb25pY1Bvd09wdGlvbnMge1xyXG4gIEF1dG9Jbml0OiBib29sZWFuIC8vIE1hbnVhbGx5IGluaXRpYWxpemUgaW5zdGVhZCBvZiBhdXRvLWRldGVjdGluZyBkaXZzXHJcbn1cclxuXHJcbi8vIERldGF1bHQgb3B0aW9uc1xyXG5jb25zdCBkZWZhdWx0T3B0aW9uczogVG9uaWNQb3dPcHRpb25zID0ge1xyXG4gIEF1dG9Jbml0OiB0cnVlLFxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb25pY1BvdyB7XHJcbiAgY29uZmlnOiBDb25maWdcclxuICBzdG9yYWdlOiBTdG9yYWdlXHJcbiAgZXZlbnRzOiBFdmVudHMgfCB1bmRlZmluZWRcclxuXHJcbiAgY29uc3RydWN0b3Iob3B0aW9uczogVG9uaWNQb3dPcHRpb25zID0gZGVmYXVsdE9wdGlvbnMpIHtcclxuICAgIC8vIEltYnVlIG9wdGlvbnNcclxuICAgIGZvciAobGV0IFtvcHRpb25LZXksIG9wdGlvblZhbF0gb2YgT2JqZWN0LmVudHJpZXMob3B0aW9ucykpIHtcclxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIG9wdGlvbktleSwge1xyXG4gICAgICAgIHZhbHVlOiBvcHRpb25WYWwsXHJcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCBuYW1lc3BhY2VzXHJcbiAgICB0aGlzLmNvbmZpZyA9IG5ldyBDb25maWcoKVxyXG4gICAgdGhpcy5zdG9yYWdlID0gbmV3IFN0b3JhZ2UoKVxyXG5cclxuICAgIC8vIFN0YXJ0IHRoZSBUb25pY1BvdyBzZXJ2aWNlIGFuZCBsb2FkIG1vZHVsZXNcclxuICAgIGlmIChvcHRpb25zLkF1dG9Jbml0KSB7XHJcbiAgICAgIC8vIExvYWQgdGhlIFRvbmljUG93IHdpZGdldFxyXG4gICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJyB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnaW50ZXJhY3RpdmUnKSB7XHJcbiAgICAgICAgLy8gVGhpcyBsb2FkcyBpZiB0aGUgPHNjcmlwdD4gaXMgZHluYW1pY2FsbHkgaW5qZWN0ZWQgaW50byB0aGUgcGFnZVxyXG4gICAgICAgIHRoaXMubG9hZCgpXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50cygpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gVGhpcyBsb2FkcyBpZiB0aGUgPHNjcmlwdD4gaXMgaGFyZGNvZGVkIGluIHRoZSBodG1sIHBhZ2UgaW4gdGhlIDxoZWFkPlxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWQoKVxyXG4gICAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50cygpXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gcmVnaXN0ZXJFdmVudHNcclxuICByZWdpc3RlckV2ZW50cyA9ICgpID0+IHtcclxuICAgIC8vIFJlZ2lzdGVyIGV2ZW50cyBpZiB3ZSBoYXZlIGEgdmFsaWQgc2Vzc2lvblxyXG4gICAgbGV0IHNlc3Npb24gPSB0aGlzLmdldFZpc2l0b3JTZXNzaW9uKClcclxuICAgIGlmIChzZXNzaW9uKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdyZWdpc3RlcmluZyBzZXNzaW9uJywgc2Vzc2lvbilcclxuICAgICAgdGhpcy5ldmVudHMgPSBuZXcgRXZlbnRzKHNlc3Npb24pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBzZXRPcmVvIGZvciBjcmVhdGluZyBuZXcgb3Jlb3NcclxuICBzZXRPcmVvID0gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgZGF5czogbnVtYmVyKSA9PiB7XHJcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKVxyXG4gICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgMjQgKiA2MCAqIDYwICogMTAwMCAqIGRheXMpXHJcbiAgICBkb2N1bWVudC5jb29raWUgPSBgJHtuYW1lfT0ke3ZhbHVlfTtwYXRoPS87ZXhwaXJlcz0ke2RhdGUudG9VVENTdHJpbmcoKX1gXHJcbiAgfVxyXG5cclxuICAvLyBjYXB0dXJlVmlzaXRvclNlc3Npb24gd2lsbCBjYXB0dXJlIHRoZSBzZXNzaW9uIGFuZCBzdG9yZSBpdFxyXG4gIC8vIEJ1aWxkcyBhIGNvb2tpZSBzbyBpdCdzIHNlbnQgb24gcmVxdWVzdHMgYXV0b21hdGljYWxseVxyXG4gIC8vIFN0b3JlcyBpbiBsb2NhbCBzdG9yYWdlIGZvciBlYXN5IGFjY2VzcyBmcm9tIHRoZSBhcHBsaWNhdGlvblxyXG4gIGNhcHR1cmVWaXNpdG9yU2Vzc2lvbiA9IChjdXN0b21TZXNzaW9uSWQ6IHN0cmluZyA9ICcnKSA9PiB7XHJcbiAgICBsZXQgc2Vzc2lvbklkID0gY3VzdG9tU2Vzc2lvbklkXHJcblxyXG4gICAgaWYgKCghY3VzdG9tU2Vzc2lvbklkIHx8ICFjdXN0b21TZXNzaW9uSWQubGVuZ3RoKSAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpXHJcbiAgICAgIHNlc3Npb25JZCA9IHVybFBhcmFtcy5nZXQodGhpcy5jb25maWcuc2Vzc2lvbk5hbWUpIHx8ICcnXHJcbiAgICB9XHJcbiAgICBpZiAoc2Vzc2lvbklkICYmIHNlc3Npb25JZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuc2V0T3Jlbyh0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSwgc2Vzc2lvbklkLCB0aGlzLmNvbmZpZy5tYXhTZXNzaW9uRGF5cylcclxuICAgICAgdGhpcy5zdG9yYWdlLnNldFN0b3JhZ2UoXHJcbiAgICAgICAgdGhpcy5jb25maWcuc2Vzc2lvbk5hbWUsXHJcbiAgICAgICAgc2Vzc2lvbklkLFxyXG4gICAgICAgIDI0ICogNjAgKiA2MCAqIHRoaXMuY29uZmlnLm1heFNlc3Npb25EYXlzXHJcbiAgICAgIClcclxuICAgICAgcmV0dXJuIHNlc3Npb25JZFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcblxyXG4gIC8vIGdldFZpc2l0b3JTZXNzaW9uIHdpbGwgZ2V0IHRoZSBzZXNzaW9uIGlmIGl0IGV4aXN0c1xyXG4gIGdldFZpc2l0b3JTZXNzaW9uID0gKCkgPT4gdGhpcy5zdG9yYWdlLmdldFN0b3JhZ2UodGhpcy5jb25maWcuc2Vzc2lvbk5hbWUpXHJcblxyXG4gIC8vIGxvYWREaXZzIHJlcGxhY2VzIGVhY2ggVG9uaWNQb3cgZGl2IHdpdGggYSBjb3JyZXNwb25kaW5nIGVtYmVkIHdpZGdldFxyXG4gIGxvYWREaXZzID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gR2V0IGFsbCBkaXZzXHJcbiAgICBjb25zdCB0b25pY0RpdnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuY29uZmlnLndpZGdldERpdkNsYXNzKVxyXG5cclxuICAgIC8vIExvb3AgYWxsIGRpdnMgdGhhdCB3ZSBmb3VuZFxyXG4gICAgZm9yIChsZXQgaSA9IHRvbmljRGl2cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAvLyBTZXQgdGhlIGRpdlxyXG4gICAgICBjb25zdCB0b25pY0RpdiA9IHRvbmljRGl2c1tpXVxyXG5cclxuICAgICAgLy8gR2V0IHRoZSB3aWRnZXQgaWRcclxuICAgICAgY29uc3Qgd2lkZ2V0SWQgPSB0b25pY0Rpdi5nZXRBdHRyaWJ1dGUodGhpcy5jb25maWcud2lkZ2V0SWQpXHJcbiAgICAgIGlmICghd2lkZ2V0SWQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgJHt3aWRnZXRJZH0gbm90IGZvdW5kYClcclxuICAgICAgICBjb250aW51ZVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGN1c3RvbSBlbnZpcm9ubWVudCAoc3dpdGNoaW5nIGF3YXkgZnJvbSBkZWZhdWx0OiBwcm9kdWN0aW9uKVxyXG4gICAgICBjb25zdCBjdXN0b21FbnZpcm9ubWVudCA9IHRvbmljRGl2LmdldEF0dHJpYnV0ZSh0aGlzLmNvbmZpZy5jdXN0b21FbnZpcm9ubWVudClcclxuICAgICAgdGhpcy5jb25maWcuc2V0RW52aXJvbm1lbnQoY3VzdG9tRW52aXJvbm1lbnQgfHwgJ3Byb2R1Y3Rpb24nKVxyXG5cclxuICAgICAgLy8gRmlyZSB0aGUgcmVxdWVzdCB0byBsb2FkIHRoZSB3aWRnZXQgZGF0YVxyXG4gICAgICBjb25zdCBwcm9taXNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgICAgYCR7dGhpcy5jb25maWcuYXBpVXJsfS92MS93aWRnZXRzL2Rpc3BsYXkvJHt3aWRnZXRJZH0/cHJvdmlkZXI9ZW1iZWQtJHt0aGlzLmNvbmZpZy52ZXJzaW9ufWBcclxuICAgICAgKVxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHByb21pc2UuanNvbigpXHJcblxyXG4gICAgICAvLyBTZXQgVVJJIGVuY29kZWQgdGl0bGVcclxuICAgICAgY29uc3QgY2FtcGFpZ25UaXRsZSA9IGVuY29kZVVSSUNvbXBvbmVudChyZXNwb25zZS50aXRsZSlcclxuXHJcbiAgICAgIC8vIFNldCB0aGUgSFRNTFxyXG4gICAgICB0b25pY0Rpdi5pbm5lckhUTUwgPSBgXHJcbiAgICA8YSBocmVmPVwiJHtyZXNwb25zZS5saW5rX3VybH0/dXRtX3NvdXJjZT10b25pY3Bvdy13aWRnZXRzJnV0bV9tZWRpdW09d2lkZ2V0JnV0bV9jYW1wYWlnbj0ke3dpZGdldElkfSZ1dG1fY29udGVudD0ke2NhbXBhaWduVGl0bGV9XCI+XHJcbiAgICAgIDxpbWcgc3JjPVwiJHtyZXNwb25zZS5pbWFnZV91cmx9XCIgXHJcbiAgICAgIHdpZHRoPVwiJHtyZXNwb25zZS53aWR0aH1cIiBcclxuICAgICAgaGVpZ2h0PVwiJHtyZXNwb25zZS5oZWlnaHR9XCIgXHJcbiAgICAgIGFsdD1cIiR7cmVzcG9uc2UudGl0bGV9XCIgLz5cclxuICAgIDwvYT5gXHJcblxyXG4gICAgICAvLyBTZXQgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxyXG4gICAgICB0b25pY0Rpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtd2lkdGgnLCByZXNwb25zZS53aWR0aClcclxuICAgICAgdG9uaWNEaXYuc2V0QXR0cmlidXRlKCdkYXRhLWhlaWdodCcsIHJlc3BvbnNlLmhlaWdodClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIExvYWQgdGhlIFRvbmljUG93IHNjcmlwdChzKSBhbmQgZGVmYXVsdCBzZXR0aW5nc1xyXG4gIGxvYWQgPSAoKSA9PiB7XHJcbiAgICAvLyBXZSBvbmx5IHdvcmsgaW4gYSBicm93c2VyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignVG9uaWNQb3cgZW1iZWQgb25seSB3b3JrcyBpbiB0aGUgYnJvd3NlcicpXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIExvYWQgYWxsIHRvbmljcyBmb3VuZCBvbiB0aGUgcGFnZSAoaWYgd2UgaGF2ZSBkaXYpXHJcbiAgICBjb25zdCB0b25pY0RpdnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuY29uZmlnLndpZGdldERpdkNsYXNzKVxyXG4gICAgaWYgKHRvbmljRGl2cyAmJiB0b25pY0RpdnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmxvYWREaXZzKCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1RvbmljUG93IHdpZGdldChzKSBsb2FkZWQhJylcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcm9jZXNzIHZpc2l0b3IgdG9rZW5cclxuICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLmNhcHR1cmVWaXNpdG9yU2Vzc2lvbigpXHJcblxyXG4gICAgLy8gQ2FwdHVyZSBldmVudHMgaWYgd2UgaGF2ZSBhIHNlc3Npb25cclxuICAgIGlmIChzZXNzaW9uKSB7XHJcbiAgICAgIHRoaXMuZXZlbnRzID0gbmV3IEV2ZW50cyhzZXNzaW9uKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8gVE9ETyAtIGhvdyB0ZiBkbyB3ZSB3ZSBhdXRvcnVuIHRoaXMgbm93P1xyXG5cclxuLy8gU2V0IG9uIHdpbmRvd1xyXG47KHdpbmRvdyBhcyBhbnkpLlRvbmljUG93ID0gVG9uaWNQb3cgfHwge31cclxuIiwiLyogZ2xvYmFsIGxvY2FsU3RvcmFnZSAqL1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3RvcmFnZSB7XHJcbiAgLypcclxuICByZW1vdmVTdG9yYWdlOiByZW1vdmVzIGEga2V5IGZyb20gbG9jYWxTdG9yYWdlIGFuZCBpdHMgc2libGluZyBleHBpcmFjeSBrZXlcclxuICBwYXJhbXM6XHJcbiAgICAgIGtleSA8c3RyaW5nPiA6IGxvY2FsU3RvcmFnZSBrZXkgdG8gcmVtb3ZlXHJcbiAgcmV0dXJuczpcclxuICAgICAgPGJvb2xlYW4+IDogdGVsbGluZyBpZiBvcGVyYXRpb24gc3VjY2VlZGVkXHJcbiAgKi9cclxuICByZW1vdmVTdG9yYWdlID0gKG5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0obmFtZSlcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYCR7bmFtZX1fZXhwaXJlc0luYClcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgYHJlbW92ZVN0b3JhZ2U6IEVycm9yIHJlbW92aW5nIGtleSBbJHtuYW1lfV0gZnJvbSBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YFxyXG4gICAgICApXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWVcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgZ2V0U3RvcmFnZTogcmV0cmlldmVzIGEga2V5IGZyb20gbG9jYWxTdG9yYWdlIHByZXZpb3VzbHkgc2V0IHdpdGggc2V0U3RvcmFnZSgpLlxyXG4gIHBhcmFtczpcclxuICAgICAga2V5IDxzdHJpbmc+IDogbG9jYWxTdG9yYWdlIGtleVxyXG4gIHJldHVybnM6XHJcbiAgICAgIDxzdHJpbmc+IDogdmFsdWUgb2YgbG9jYWxTdG9yYWdlIGtleVxyXG4gICAgICBudWxsIDogaW4gY2FzZSBvZiBleHBpcmVkIGtleSBvciBmYWlsdXJlXHJcbiAgKi9cclxuICBnZXRTdG9yYWdlID0gKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAvLyBlcG9jaCB0aW1lLCBsZXRzIGRlYWwgb25seSB3aXRoIGludGVnZXJcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcclxuXHJcbiAgICAvLyBTZXQgZXhwaXJhdGlvbiBmb3Igc3RvcmFnZVxyXG4gICAgbGV0IGV4cGlyZXNcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBleHBpcmVzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYCR7a2V5fV9leHBpcmVzYClcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYGdldEl0ZW06IGVycm9yIGdldHRpbmcgbG9jYWxTdG9yYWdlOiAke0pTT04uc3RyaW5naWZ5KGUpfWApXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGV4cGlyZXMgPT09IHVuZGVmaW5lZCB8fCBleHBpcmVzID09PSBudWxsKSB7XHJcbiAgICAgIGV4cGlyZXMgPSAwXHJcbiAgICB9XHJcblxyXG4gICAgLy8gRXhwaXJlZFxyXG4gICAgaWYgKGV4cGlyZXMgPCBub3cpIHtcclxuICAgICAgdGhpcy5yZW1vdmVTdG9yYWdlKGtleSlcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgdGhlIGV4aXN0aW5nIGl0ZW1cclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBnZXRTdG9yYWdlOiBFcnJvciByZWFkaW5nIGtleSBbJHtrZXl9XSBmcm9tIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICBzZXRTdG9yYWdlOiB3cml0ZXMgYSBrZXkgaW50byBsb2NhbFN0b3JhZ2Ugc2V0dGluZyBhIGV4cGlyZSB0aW1lXHJcbiAgcGFyYW1zOlxyXG4gICAgICBrZXkgPHN0cmluZz4gICAgIDogbG9jYWxTdG9yYWdlIGtleVxyXG4gICAgICB2YWx1ZSA8c3RyaW5nPiAgIDogbG9jYWxTdG9yYWdlIHZhbHVlXHJcbiAgICAgIGV4cGlyZXMgPG51bWJlcj4gOiBudW1iZXIgb2Ygc2Vjb25kcyBmcm9tIG5vdyB0byBleHBpcmUgdGhlIGtleVxyXG4gIHJldHVybnM6XHJcbiAgICAgIDxib29sZWFuPiA6IHRlbGxpbmcgaWYgb3BlcmF0aW9uIHN1Y2NlZWRlZFxyXG4gICovXHJcbiAgc2V0U3RvcmFnZSA9IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZywgZXhwaXJlczogbnVtYmVyIHwgbnVsbCA9IG51bGwpID0+IHtcclxuICAgIC8vIEV4cGlyZWQgdGltZVxyXG4gICAgaWYgKGV4cGlyZXMpIHtcclxuICAgICAgZXhwaXJlcyA9IE1hdGguYWJzKGV4cGlyZXMpIC8vIG1ha2Ugc3VyZSBpdCdzIHBvc2l0aXZlXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBleHBpcmVzID0gMjQgKiA2MCAqIDYwIC8vIGRlZmF1bHQ6IHNlY29uZHMgZm9yIDEgZGF5XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWlsbGkgc2Vjb25kcyBzaW5jZSBlcG9jaCB0aW1lLCBsZXRzIGRlYWwgb25seSB3aXRoIGludGVnZXJcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcclxuICAgIGNvbnN0IHNjaGVkdWxlID0gbm93ICsgZXhwaXJlcyAqIDEwMDBcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke2tleX1fZXhwaXJlc2AsIHNjaGVkdWxlLnRvU3RyaW5nKCkpXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBzZXRTdG9yYWdlOiBFcnJvciBzZXR0aW5nIGtleSBbJHtrZXl9XSBpbiBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YClcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZVxyXG4gIH1cclxufVxyXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHRpZihfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdKSB7XG5cdFx0cmV0dXJuIF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0uZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MDcpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==