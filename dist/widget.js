(()=>{var t={916:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n=i.p+"0cc67b926321b46c35cc929178804e2f.svg"},913:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.isEnvironmentValid=t=>this.environments.includes(t),this.setEnvironment=t=>{t&&this.isEnvironmentValid(t)&&(this.environment=t,t===this.environmentStaging?(this.apiUrl=this.apiUrlStaging,this.eventsUrl=this.eventsUrlStaging):t===this.environmentLocal?(this.apiUrl=this.apiUrlLocal,this.eventsUrl=this.eventsUrlLocal):t===this.environmentProduction&&(this.apiUrl=this.apiUrlProduction,this.eventsUrl=this.eventsUrlProduction))},this.environmentLocal="local",this.environmentStaging="staging",this.environmentProduction="production",this.apiUrl="https://api.tonicpow.com",this.apiUrlLocal="http://localhost:3000",this.apiUrlStaging="https://api.staging.tonicpow.com",this.apiUrlProduction="https://api.tonicpow.com",this.eventsUrl="https://events.tonicpow.com",this.eventsUrlLocal="http://localhost:3002",this.eventsUrlStaging="https://events.staging.tonicpow.com",this.eventsUrlProduction="https://events.tonicpow.com",this.customEnvironmentAttribute="data-environment",this.environment="",this.environments=[this.environmentLocal,this.environmentStaging,this.environmentProduction],this.maxSessionDays=60,this.sessionName="tncpw_session",this.version="v0.0.8",this.widgetDivClass="tonicpow-widget",this.widgetIdAttribute="data-widget-id"}}}.apply(e,[i,e]))||(t.exports=n)},242:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.detectWidgetClick=()=>{document.addEventListener("click",(async t=>{let e=(t||window.event).target?.parentElement?.parentElement;if(e?.classList?.contains("tonicpow-widget"))try{await this.sendEvent("click",e.getAttribute("widget-id")||"")}catch(t){console.error("failed to report interaction: click",t)}}))},this.detectBounce=()=>{window.onbeforeunload=()=>{this.sendEvent("bounce",((new Date).getTime()-this.start).toString())}},this.detectInteraction=()=>{document.addEventListener("mousedown",(async()=>{if(!this.interactionSent)try{await this.sendEvent("interaction","mousedown"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: mousedown",t)}})),document.addEventListener("scroll",(async()=>{if(!this.interactionSent)try{await this.sendEvent("interaction","scroll"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: scroll",t)}})),document.addEventListener("keypress",(async()=>{if(!this.interactionSent)try{await this.sendEvent("interaction","keypress"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: keypress",t)}}))},this.sendEvent=async(t,e)=>{if(!this.sessionId)return void console.info("you must call init with a session before sending events");let i={v:this.config.version,name:t,tncpw_session:this.sessionId,data:e};await fetch(`${this.config.eventsUrl}/v1/events?d=${btoa(JSON.stringify(i))}`,{method:"get"})},this.sessionId=t,this.config=e,this.interactionSent=!1,this.start=(new Date).getTime(),this.detectInteraction(),this.detectBounce(),this.detectWidgetClick()}}}.apply(e,[i,e]))||(t.exports=n)},607:function(t,e,i){var n,o,s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(916),i(913),i(242),i(912)],void 0===(o=function(t,e,i,n,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=s(i),n=s(n),o=s(o),r=s(r);class a{constructor(t){this.registerEvents=()=>{if(!this.events){let t=this.getVisitorSession();t&&t.length&&(this.events=new o.default(t,this.config))}},this.setOreo=(t,e,i)=>{const n=new Date;n.setTime(n.getTime()+864e5*i),document.cookie=`${t}=${e};path=/;expires=${n.toUTCString()}`},this.captureVisitorSession=(t="")=>{let e=t;return t&&t.length||"undefined"==typeof window||(e=new URLSearchParams(window.location.search).get(this.config.sessionName)||""),e&&e.length>0?(this.setOreo(this.config.sessionName,e,this.config.maxSessionDays),this.storage.setStorage(this.config.sessionName,e,86400*this.config.maxSessionDays),e):null},this.getVisitorSession=()=>this.storage.getStorage(this.config.sessionName),this.loadDivs=async()=>{const t=document.getElementsByClassName(this.config.widgetDivClass);for(let n=t.length-1;n>=0;n--){const o=t[n];if(!o){console.log("exit early - remove this?");continue}const s=o.getAttribute(this.config.widgetIdAttribute);if(!s){console.log(`${s} not found`);continue}const r=o.getAttribute(this.config.customEnvironmentAttribute);this.config.setEnvironment(r||"production"),this.widgets.set(s,null);try{const t=await fetch(`${this.config.apiUrl}/v1/widgets/display/${s}?provider=embed-${this.config.version}`);var e;403===t.status?(console.info(`${t.status}: Domain not allowed`),e={link_url:"https://tonicpow.com",image_url:i.default}):e=await t.json();const n=encodeURIComponent(e.title);o.innerHTML=`\n      <a href="${e.link_url}?utm_source=tonicpow-widgets&utm_medium=widget&utm_campaign=${s}&utm_content=${n}" style="display: inline-block">\n      <img src="${e.image_url}" \n      width="${e.width}" \n      height="${e.height}" \n      alt="${e.title}" />\n      </a>`,o.setAttribute("data-width",e.width),o.setAttribute("data-height",e.height),this.widgets.set(s,e),this.options&&this.options.onWidgetLoaded&&(e.id=s,this.options.onWidgetLoaded(e))}catch(t){throw t}}},this.load=async()=>{if("undefined"==typeof window)return void console.error("TonicPow embed only works in the browser");const t=document.getElementsByClassName(this.config.widgetDivClass);if(t&&t.length>0)try{await this.loadDivs(),console.log("%c TonicPow widget(s) loaded! ","background: #974CD2; color: #fff")}catch(t){throw t}const e=this.captureVisitorSession();e&&(this.events=new o.default(e,this.config))},this.config=new n.default,this.storage=new r.default,this.widgets=new Map,this.options=t,"complete"===document.readyState||"interactive"===document.readyState?(this.load(),this.registerEvents()):document.addEventListener("DOMContentLoaded",(()=>{this.load(),this.registerEvents()}))}}e.default=a;var c=new a;console.log({config:c.config}),window.TonicPow=c||{}}.apply(e,n))||(t.exports=o)},912:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.removeStorage=t=>{try{localStorage.removeItem(t),localStorage.removeItem(`${t}_expiresIn`)}catch(e){return console.log(`removeStorage: Error removing key [${t}] from localStorage: ${JSON.stringify(e)}`),!1}return!0},this.getStorage=t=>{const e=Date.now();let i;try{i=localStorage.getItem(`${t}_expires`)}catch(t){return console.log(`getItem: error getting localStorage: ${JSON.stringify(t)}`),null}if(null==i&&(i=0),i<e)return this.removeStorage(t),null;try{return localStorage.getItem(t)}catch(e){return console.log(`getStorage: Error reading key [${t}] from localStorage: ${JSON.stringify(e)}`),null}},this.setStorage=(t,e,i=null)=>{i=i?Math.abs(i):86400;const n=Date.now()+1e3*i;try{localStorage.setItem(t,e),localStorage.setItem(`${t}_expires`,n.toString())}catch(e){return console.log(`setStorage: Error setting key [${t}] in localStorage: ${JSON.stringify(e)}`),!1}return!0}}}}.apply(e,[i,e]))||(t.exports=n)}},e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),i(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2Fzc2V0cy9pbWFnZV9wbGFjZWhvbGRlcl90b25pY3Bvd19zcXVhcmUuc3ZnIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvY29uZmlnLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvZXZlbnRzLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC8uL3NyYy9zdG9yYWdlLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0L3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0L3dlYnBhY2svc3RhcnR1cCJdLCJuYW1lcyI6WyJpc0Vudmlyb25tZW50VmFsaWQiLCJlbnZpcm9ubWVudCIsInRoaXMiLCJlbnZpcm9ubWVudHMiLCJpbmNsdWRlcyIsInNldEVudmlyb25tZW50IiwiZW52aXJvbm1lbnRTdGFnaW5nIiwiYXBpVXJsIiwiYXBpVXJsU3RhZ2luZyIsImV2ZW50c1VybCIsImV2ZW50c1VybFN0YWdpbmciLCJlbnZpcm9ubWVudExvY2FsIiwiYXBpVXJsTG9jYWwiLCJldmVudHNVcmxMb2NhbCIsImVudmlyb25tZW50UHJvZHVjdGlvbiIsImFwaVVybFByb2R1Y3Rpb24iLCJldmVudHNVcmxQcm9kdWN0aW9uIiwiY3VzdG9tRW52aXJvbm1lbnRBdHRyaWJ1dGUiLCJtYXhTZXNzaW9uRGF5cyIsInNlc3Npb25OYW1lIiwidmVyc2lvbiIsIndpZGdldERpdkNsYXNzIiwid2lkZ2V0SWRBdHRyaWJ1dGUiLCJzZXNzaW9uSWQiLCJjb25maWciLCJkZXRlY3RXaWRnZXRDbGljayIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImFzeW5jIiwiZSIsImNvbnRhaW5lciIsIndpbmRvdyIsImV2ZW50IiwidGFyZ2V0IiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwic2VuZEV2ZW50IiwiZ2V0QXR0cmlidXRlIiwiY29uc29sZSIsImVycm9yIiwiZGV0ZWN0Qm91bmNlIiwib25iZWZvcmV1bmxvYWQiLCJEYXRlIiwiZ2V0VGltZSIsInN0YXJ0IiwidG9TdHJpbmciLCJkZXRlY3RJbnRlcmFjdGlvbiIsImludGVyYWN0aW9uU2VudCIsImV2ZW50TmFtZSIsImRhdGEiLCJpbmZvIiwicGF5bG9hZCIsInYiLCJuYW1lIiwidG5jcHdfc2Vzc2lvbiIsImZldGNoIiwiYnRvYSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRob2QiLCJUb25pY1BvdyIsIm9wdGlvbnMiLCJyZWdpc3RlckV2ZW50cyIsImV2ZW50cyIsInNlc3Npb24iLCJnZXRWaXNpdG9yU2Vzc2lvbiIsImxlbmd0aCIsInNldE9yZW8iLCJ2YWx1ZSIsImRheXMiLCJkYXRlIiwic2V0VGltZSIsImNvb2tpZSIsInRvVVRDU3RyaW5nIiwiY2FwdHVyZVZpc2l0b3JTZXNzaW9uIiwiY3VzdG9tU2Vzc2lvbklkIiwiVVJMU2VhcmNoUGFyYW1zIiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJzdG9yYWdlIiwic2V0U3RvcmFnZSIsImdldFN0b3JhZ2UiLCJsb2FkRGl2cyIsInRvbmljRGl2cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJpIiwidG9uaWNEaXYiLCJsb2ciLCJ3aWRnZXRJZCIsImN1c3RvbUVudmlyb25tZW50Iiwid2lkZ2V0cyIsInNldCIsInByb21pc2UiLCJyZXNwb25zZSIsInN0YXR1cyIsImxpbmtfdXJsIiwiaW1hZ2VfdXJsIiwianNvbiIsImNhbXBhaWduVGl0bGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJ0aXRsZSIsImlubmVySFRNTCIsIndpZHRoIiwiaGVpZ2h0Iiwic2V0QXR0cmlidXRlIiwib25XaWRnZXRMb2FkZWQiLCJpZCIsImxvYWQiLCJNYXAiLCJyZWFkeVN0YXRlIiwidHBvdyIsInJlbW92ZVN0b3JhZ2UiLCJsb2NhbFN0b3JhZ2UiLCJyZW1vdmVJdGVtIiwia2V5Iiwibm93IiwiZXhwaXJlcyIsImdldEl0ZW0iLCJNYXRoIiwiYWJzIiwic2NoZWR1bGUiLCJzZXRJdGVtIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwiZCIsImRlZmluaXRpb24iLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZyIsImdsb2JhbFRoaXMiLCJGdW5jdGlvbiIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJjdXJyZW50U2NyaXB0Iiwic3JjIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiRXJyb3IiLCJyZXBsYWNlIiwicCJdLCJtYXBwaW5ncyI6InNFQUFBLFFBQWUsSUFBMEIsd0MsNEdDQXpDLGdCQXFCRSxjQXdCQSxLQUFBQSxtQkFBc0JDLEdBQXdCQyxLQUFLQyxhQUFhQyxTQUFTSCxHQUd6RSxLQUFBSSxlQUFrQkosSUFFWEEsR0FLQUMsS0FB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LEVBQW9CbUIsRUFBS2pCLElBQ0gsb0JBQVhrQixRQUEwQkEsT0FBT0MsYUFDMUNaLE9BQU9DLGVBQWVSLEVBQVNrQixPQUFPQyxZQUFhLENBQUU3RSxNQUFPLFdBRTdEaUUsT0FBT0MsZUFBZVIsRUFBUyxhQUFjLENBQUUxRCxPQUFPLEssTUNMdkQsSUFBSThFLEVBQ0F0QixFQUFvQlksRUFBRVcsZ0JBQWVELEVBQVl0QixFQUFvQlksRUFBRTNELFNBQVcsSUFDdEYsSUFBSXBELEVBQVdtRyxFQUFvQlksRUFBRS9HLFNBQ3JDLElBQUt5SCxHQUFhekgsSUFDYkEsRUFBUzJILGdCQUNaRixFQUFZekgsRUFBUzJILGNBQWNDLE1BQy9CSCxHQUFXLENBQ2YsSUFBSUksRUFBVTdILEVBQVM4SCxxQkFBcUIsVUFDekNELEVBQVFwRixTQUFRZ0YsRUFBWUksRUFBUUEsRUFBUXBGLE9BQVMsR0FBR21GLEtBSzdELElBQUtILEVBQVcsTUFBTSxJQUFJTSxNQUFNLHlEQUNoQ04sRUFBWUEsRUFBVU8sUUFBUSxPQUFRLElBQUlBLFFBQVEsUUFBUyxJQUFJQSxRQUFRLFlBQWEsS0FDcEY3QixFQUFvQjhCLEVBQUlSLEcsR0NaRXRCLEVBQW9CLE0iLCJmaWxlIjoid2lkZ2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gKyBcIjBjYzY3YjkyNjMyMWI0NmMzNWNjOTI5MTc4ODA0ZTJmLnN2Z1wiOyIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbmZpZyB7XHJcbiAgZW52aXJvbm1lbnRMb2NhbDogc3RyaW5nXHJcbiAgZW52aXJvbm1lbnRTdGFnaW5nOiBzdHJpbmdcclxuICBlbnZpcm9ubWVudFByb2R1Y3Rpb246IHN0cmluZ1xyXG4gIGFwaVVybDogc3RyaW5nXHJcbiAgYXBpVXJsTG9jYWw6IHN0cmluZ1xyXG4gIGFwaVVybFN0YWdpbmc6IHN0cmluZ1xyXG4gIGFwaVVybFByb2R1Y3Rpb246IHN0cmluZ1xyXG4gIGV2ZW50c1VybDogc3RyaW5nXHJcbiAgZXZlbnRzVXJsTG9jYWw6IHN0cmluZ1xyXG4gIGV2ZW50c1VybFN0YWdpbmc6IHN0cmluZ1xyXG4gIGV2ZW50c1VybFByb2R1Y3Rpb246IHN0cmluZ1xyXG4gIGN1c3RvbUVudmlyb25tZW50QXR0cmlidXRlOiBzdHJpbmdcclxuICBlbnZpcm9ubWVudDogc3RyaW5nXHJcbiAgZW52aXJvbm1lbnRzOiBzdHJpbmdbXVxyXG4gIG1heFNlc3Npb25EYXlzOiBudW1iZXJcclxuICBzZXNzaW9uTmFtZTogc3RyaW5nXHJcbiAgdmVyc2lvbjogc3RyaW5nXHJcbiAgd2lkZ2V0RGl2Q2xhc3M6IHN0cmluZ1xyXG4gIHdpZGdldElkQXR0cmlidXRlOiBzdHJpbmdcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmVudmlyb25tZW50TG9jYWwgPSAnbG9jYWwnXHJcbiAgICB0aGlzLmVudmlyb25tZW50U3RhZ2luZyA9ICdzdGFnaW5nJ1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudFByb2R1Y3Rpb24gPSAncHJvZHVjdGlvbidcclxuXHJcbiAgICB0aGlzLmFwaVVybCA9ICdodHRwczovL2FwaS50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmFwaVVybExvY2FsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCdcclxuICAgIHRoaXMuYXBpVXJsU3RhZ2luZyA9ICdodHRwczovL2FwaS5zdGFnaW5nLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuYXBpVXJsUHJvZHVjdGlvbiA9ICdodHRwczovL2FwaS50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmV2ZW50c1VybCA9ICdodHRwczovL2V2ZW50cy50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmV2ZW50c1VybExvY2FsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMidcclxuICAgIHRoaXMuZXZlbnRzVXJsU3RhZ2luZyA9ICdodHRwczovL2V2ZW50cy5zdGFnaW5nLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuZXZlbnRzVXJsUHJvZHVjdGlvbiA9ICdodHRwczovL2V2ZW50cy50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmN1c3RvbUVudmlyb25tZW50QXR0cmlidXRlID0gJ2RhdGEtZW52aXJvbm1lbnQnXHJcbiAgICB0aGlzLmVudmlyb25tZW50ID0gJydcclxuICAgIHRoaXMuZW52aXJvbm1lbnRzID0gW3RoaXMuZW52aXJvbm1lbnRMb2NhbCwgdGhpcy5lbnZpcm9ubWVudFN0YWdpbmcsIHRoaXMuZW52aXJvbm1lbnRQcm9kdWN0aW9uXVxyXG4gICAgdGhpcy5tYXhTZXNzaW9uRGF5cyA9IDYwXHJcbiAgICB0aGlzLnNlc3Npb25OYW1lID0gJ3RuY3B3X3Nlc3Npb24nXHJcbiAgICB0aGlzLnZlcnNpb24gPSAndjAuMC44J1xyXG4gICAgdGhpcy53aWRnZXREaXZDbGFzcyA9ICd0b25pY3Bvdy13aWRnZXQnXHJcbiAgICB0aGlzLndpZGdldElkQXR0cmlidXRlID0gJ2RhdGEtd2lkZ2V0LWlkJ1xyXG4gIH1cclxuXHJcbiAgLy8gaXNFbnZpcm9ubWVudFZhbGlkIHdpbGwgY2hlY2sgaWYgdGhlIGdpdmVuIGVudmlyb25tZW50IGlzIHZhbGlkXHJcbiAgaXNFbnZpcm9ubWVudFZhbGlkID0gKGVudmlyb25tZW50OiBzdHJpbmcpID0+IHRoaXMuZW52aXJvbm1lbnRzLmluY2x1ZGVzKGVudmlyb25tZW50KVxyXG5cclxuICAvLyBzZXRFbnZpcm9ubWVudCB3aWxsIHNldCB0aGUgZW52aXJvbm1lbnRcclxuICBzZXRFbnZpcm9ubWVudCA9IChlbnZpcm9ubWVudDogc3RyaW5nKSA9PiB7XHJcbiAgICAvLyBObyBlbnZpcm9ubWVudCBzZXQ/IHVzZSB0aGUgZGVmYXVsdFxyXG4gICAgaWYgKCFlbnZpcm9ubWVudCkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBOb3QgYSB2YWxpZCBlbnZpcm9ubWVudD9cclxuICAgIGlmICghdGhpcy5pc0Vudmlyb25tZW50VmFsaWQoZW52aXJvbm1lbnQpKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCB0aGUgZW52aXJvbm1lbnRcclxuICAgIHRoaXMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudFxyXG5cclxuICAgIC8vIFNldCB0aGUgQVBJIHVybFxyXG4gICAgaWYgKGVudmlyb25tZW50ID09PSB0aGlzLmVudmlyb25tZW50U3RhZ2luZykge1xyXG4gICAgICB0aGlzLmFwaVVybCA9IHRoaXMuYXBpVXJsU3RhZ2luZ1xyXG4gICAgICB0aGlzLmV2ZW50c1VybCA9IHRoaXMuZXZlbnRzVXJsU3RhZ2luZ1xyXG4gICAgfSBlbHNlIGlmIChlbnZpcm9ubWVudCA9PT0gdGhpcy5lbnZpcm9ubWVudExvY2FsKSB7XHJcbiAgICAgIHRoaXMuYXBpVXJsID0gdGhpcy5hcGlVcmxMb2NhbFxyXG4gICAgICB0aGlzLmV2ZW50c1VybCA9IHRoaXMuZXZlbnRzVXJsTG9jYWxcclxuICAgIH0gZWxzZSBpZiAoZW52aXJvbm1lbnQgPT09IHRoaXMuZW52aXJvbm1lbnRQcm9kdWN0aW9uKSB7XHJcbiAgICAgIHRoaXMuYXBpVXJsID0gdGhpcy5hcGlVcmxQcm9kdWN0aW9uXHJcbiAgICAgIHRoaXMuZXZlbnRzVXJsID0gdGhpcy5ldmVudHNVcmxQcm9kdWN0aW9uXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBDb25maWcgZnJvbSAnLi9jb25maWcnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFdmVudHMge1xyXG4gIHNlc3Npb25JZDogc3RyaW5nXHJcbiAgc3RhcnQ6IG51bWJlclxyXG4gIGludGVyYWN0aW9uU2VudDogYm9vbGVhblxyXG4gIGNvbmZpZzogQ29uZmlnXHJcblxyXG4gIGNvbnN0cnVjdG9yKHNlc3Npb25JZDogc3RyaW5nLCBjb25maWc6IENvbmZpZykge1xyXG4gICAgLy8gU2V0IHRoZSBjdXJyZW50IHNlc3Npb25cclxuICAgIHRoaXMuc2Vzc2lvbklkID0gc2Vzc2lvbklkXHJcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ1xyXG5cclxuICAgIHRoaXMuaW50ZXJhY3Rpb25TZW50ID0gZmFsc2VcclxuXHJcbiAgICAvLyBSZW1lbWJlciB3aGVuIHdlIHN0YXJ0ZWRcclxuICAgIHRoaXMuc3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG4gICAgdGhpcy5kZXRlY3RJbnRlcmFjdGlvbigpXHJcbiAgICB0aGlzLmRldGVjdEJvdW5jZSgpXHJcbiAgICB0aGlzLmRldGVjdFdpZGdldENsaWNrKClcclxuICB9XHJcblxyXG4gIC8vIERldGVjdHMgY2xpY2sgb24gdGhlIHdpZGdldFxyXG4gIGRldGVjdFdpZGdldENsaWNrID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZTogRXZlbnQpID0+IHtcclxuICAgICAgLy8gR2V0IHRoZSBjbGljayB0YXJnZXRcclxuICAgICAgdmFyIHRhcmdldCA9IChlIHx8IHdpbmRvdy5ldmVudCkudGFyZ2V0IGFzIEhUTUxEaXZFbGVtZW50XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIHdpZGdldCBjb250YWluZXJcclxuICAgICAgbGV0IGNvbnRhaW5lciA9IHRhcmdldD8ucGFyZW50RWxlbWVudD8ucGFyZW50RWxlbWVudFxyXG5cclxuICAgICAgLy8gU2VuZCBldmVudCBvbmx5IGlmIHdpZGdldCB3YXMgY2xpY2tlZFxyXG4gICAgICBpZiAoY29udGFpbmVyPy5jbGFzc0xpc3Q/LmNvbnRhaW5zKCd0b25pY3Bvdy13aWRnZXQnKSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRFdmVudCgnY2xpY2snLCBjb250YWluZXIuZ2V0QXR0cmlidXRlKCd3aWRnZXQtaWQnKSB8fCAnJylcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBjbGljaycsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLy8gRGV0ZWN0cyBhIGJvdW5jZSBldmVudFxyXG4gIGRldGVjdEJvdW5jZSA9ICgpID0+IHtcclxuICAgIHdpbmRvdy5vbmJlZm9yZXVubG9hZCA9ICgpID0+IHtcclxuICAgICAgLy8gQ2FsY3VsYXRlIHRpbWUgb24gcGFnZVxyXG4gICAgICB0aGlzLnNlbmRFdmVudCgnYm91bmNlJywgKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5zdGFydCkudG9TdHJpbmcoKSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIERldGVjdHMgYSBwYWdlIGludGVyYWN0aW9uXHJcbiAgZGV0ZWN0SW50ZXJhY3Rpb24gPSAoKSA9PiB7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ21vdXNlZG93bicpXHJcbiAgICAgICAgICB0aGlzLmludGVyYWN0aW9uU2VudCA9IHRydWVcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBtb3VzZWRvd24nLCBlKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ3Njcm9sbCcpXHJcbiAgICAgICAgICB0aGlzLmludGVyYWN0aW9uU2VudCA9IHRydWVcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBzY3JvbGwnLCBlKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCF0aGlzLmludGVyYWN0aW9uU2VudCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRFdmVudCgnaW50ZXJhY3Rpb24nLCAna2V5cHJlc3MnKVxyXG4gICAgICAgICAgdGhpcy5pbnRlcmFjdGlvblNlbnQgPSB0cnVlXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjoga2V5cHJlc3MnLCBlKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIFNlbmQgZXZlbnQgd2lsbCBzZW5kIGFuIGV2ZW50IHRvIFRvbmljUG93XHJcbiAgc2VuZEV2ZW50ID0gYXN5bmMgKGV2ZW50TmFtZTogc3RyaW5nLCBkYXRhOiBzdHJpbmcpID0+IHtcclxuICAgIGlmICghdGhpcy5zZXNzaW9uSWQpIHtcclxuICAgICAgY29uc29sZS5pbmZvKCd5b3UgbXVzdCBjYWxsIGluaXQgd2l0aCBhIHNlc3Npb24gYmVmb3JlIHNlbmRpbmcgZXZlbnRzJylcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGFja2FnZSBwYXlsb2FkXHJcbiAgICBsZXQgcGF5bG9hZCA9IHtcclxuICAgICAgdjogdGhpcy5jb25maWcudmVyc2lvbixcclxuICAgICAgbmFtZTogZXZlbnROYW1lLFxyXG4gICAgICB0bmNwd19zZXNzaW9uOiB0aGlzLnNlc3Npb25JZCxcclxuICAgICAgZGF0YSxcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCBmZXRjaChgJHt0aGlzLmNvbmZpZy5ldmVudHNVcmx9L3YxL2V2ZW50cz9kPSR7YnRvYShKU09OLnN0cmluZ2lmeShwYXlsb2FkKSl9YCwge1xyXG4gICAgICBtZXRob2Q6ICdnZXQnLFxyXG4gICAgfSlcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IGZhbGxiYWNrSW1hZ2UgZnJvbSAnLi9hc3NldHMvaW1hZ2VfcGxhY2Vob2xkZXJfdG9uaWNwb3dfc3F1YXJlLnN2ZydcclxuaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZydcclxuaW1wb3J0IEV2ZW50cyBmcm9tICcuL2V2ZW50cydcclxuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi9zdG9yYWdlJ1xyXG5pbXBvcnQgV2lkZ2V0IGZyb20gJy4vdHlwZXMnXHJcblxyXG5pbnRlcmZhY2UgVG9uaWNQb3dPcHRpb25zIHtcclxuICBvbldpZGdldExvYWRlZDogKHdpZGdldDogdHlwZW9mIFdpZGdldCkgPT4gdm9pZFxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb25pY1BvdyB7XHJcbiAgY29uZmlnOiBDb25maWdcclxuICBzdG9yYWdlOiBTdG9yYWdlXHJcbiAgZXZlbnRzOiBFdmVudHMgfCB1bmRlZmluZWRcclxuICB3aWRnZXRzOiBNYXA8U3RyaW5nLCB0eXBlb2YgV2lkZ2V0IHwgbnVsbD5cclxuICBvcHRpb25zOiBUb25pY1Bvd09wdGlvbnMgfCB1bmRlZmluZWRcclxuXHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucz86IFRvbmljUG93T3B0aW9ucykge1xyXG4gICAgLy8gU2V0IG5hbWVzcGFjZXNcclxuICAgIHRoaXMuY29uZmlnID0gbmV3IENvbmZpZygpXHJcbiAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgU3RvcmFnZSgpXHJcbiAgICB0aGlzLndpZGdldHMgPSBuZXcgTWFwPFN0cmluZywgdHlwZW9mIFdpZGdldD4oKVxyXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9uc1xyXG5cclxuICAgIC8vIFN0YXJ0IHRoZSBUb25pY1BvdyBzZXJ2aWNlIGFuZCBsb2FkIG1vZHVsZXNcclxuXHJcbiAgICAvLyBMb2FkIHRoZSBUb25pY1BvdyB3aWRnZXQgd2hlbiBET00gaXMgcmVhZHlcclxuICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdpbnRlcmFjdGl2ZScpIHtcclxuICAgICAgLy8gVGhpcyBsb2FkcyBpZiB0aGUgPHNjcmlwdD4gaXMgZHluYW1pY2FsbHkgaW5qZWN0ZWQgaW50byB0aGUgcGFnZVxyXG4gICAgICB0aGlzLmxvYWQoKVxyXG4gICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRzKClcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIFRoaXMgbG9hZHMgaWYgdGhlIDxzY3JpcHQ+IGlzIGhhcmRjb2RlZCBpbiB0aGUgaHRtbCBwYWdlIGluIHRoZSA8aGVhZD5cclxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcclxuICAgICAgICB0aGlzLmxvYWQoKVxyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudHMoKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gcmVnaXN0ZXJFdmVudHMgLVJlZ2lzdGVycyBldmVudCBsaXN0ZW5lcnMuIFJ1bnMgb25seSBvbmNlXHJcbiAgcmVnaXN0ZXJFdmVudHMgPSAoKSA9PiB7XHJcbiAgICBpZiAoIXRoaXMuZXZlbnRzKSB7XHJcbiAgICAgIC8vIFJlZ2lzdGVyIGV2ZW50cyBpZiB3ZSBoYXZlIGEgdmFsaWQgc2Vzc2lvblxyXG4gICAgICBsZXQgc2Vzc2lvbiA9IHRoaXMuZ2V0VmlzaXRvclNlc3Npb24oKVxyXG4gICAgICAvLyBUT0RPOiBWYWxpZGF0ZSBzZXNzaW9uIGhlcmVcclxuICAgICAgaWYgKHNlc3Npb24gJiYgc2Vzc2lvbi5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudHMoc2Vzc2lvbiwgdGhpcy5jb25maWcpXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIHNldE9yZW8gZm9yIGNyZWF0aW5nIG5ldyBvcmVvc1xyXG4gIHNldE9yZW8gPSAobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBkYXlzOiBudW1iZXIpID0+IHtcclxuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpXHJcbiAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAyNCAqIDYwICogNjAgKiAxMDAwICogZGF5cylcclxuICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke25hbWV9PSR7dmFsdWV9O3BhdGg9LztleHBpcmVzPSR7ZGF0ZS50b1VUQ1N0cmluZygpfWBcclxuICB9XHJcblxyXG4gIC8vIGNhcHR1cmVWaXNpdG9yU2Vzc2lvbiB3aWxsIGNhcHR1cmUgdGhlIHNlc3Npb24gYW5kIHN0b3JlIGl0XHJcbiAgLy8gQnVpbGRzIGEgY29va2llIHNvIGl0J3Mgc2VudCBvbiByZXF1ZXN0cyBhdXRvbWF0aWNhbGx5XHJcbiAgLy8gU3RvcmVzIGluIGxvY2FsIHN0b3JhZ2UgZm9yIGVhc3kgYWNjZXNzIGZyb20gdGhlIGFwcGxpY2F0aW9uXHJcbiAgY2FwdHVyZVZpc2l0b3JTZXNzaW9uID0gKGN1c3RvbVNlc3Npb25JZDogc3RyaW5nID0gJycpID0+IHtcclxuICAgIGxldCBzZXNzaW9uSWQgPSBjdXN0b21TZXNzaW9uSWRcclxuXHJcbiAgICBpZiAoKCFjdXN0b21TZXNzaW9uSWQgfHwgIWN1c3RvbVNlc3Npb25JZC5sZW5ndGgpICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaClcclxuICAgICAgc2Vzc2lvbklkID0gdXJsUGFyYW1zLmdldCh0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSkgfHwgJydcclxuICAgIH1cclxuICAgIGlmIChzZXNzaW9uSWQgJiYgc2Vzc2lvbklkLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5zZXRPcmVvKHRoaXMuY29uZmlnLnNlc3Npb25OYW1lLCBzZXNzaW9uSWQsIHRoaXMuY29uZmlnLm1heFNlc3Npb25EYXlzKVxyXG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0U3RvcmFnZShcclxuICAgICAgICB0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSxcclxuICAgICAgICBzZXNzaW9uSWQsXHJcbiAgICAgICAgMjQgKiA2MCAqIDYwICogdGhpcy5jb25maWcubWF4U2Vzc2lvbkRheXNcclxuICAgICAgKVxyXG4gICAgICByZXR1cm4gc2Vzc2lvbklkXHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuXHJcbiAgLy8gZ2V0VmlzaXRvclNlc3Npb24gd2lsbCBnZXQgdGhlIHNlc3Npb24gaWYgaXQgZXhpc3RzXHJcbiAgZ2V0VmlzaXRvclNlc3Npb24gPSAoKSA9PiB0aGlzLnN0b3JhZ2UuZ2V0U3RvcmFnZSh0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSlcclxuXHJcbiAgLy8gbG9hZERpdnMgcmVwbGFjZXMgZWFjaCBUb25pY1BvdyBkaXYgd2l0aCBhIGNvcnJlc3BvbmRpbmcgZW1iZWQgd2lkZ2V0XHJcbiAgbG9hZERpdnMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBHZXQgYWxsIGRpdnNcclxuICAgIGNvbnN0IHRvbmljRGl2cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGhpcy5jb25maWcud2lkZ2V0RGl2Q2xhc3MpXHJcblxyXG4gICAgLy8gTG9vcCBhbGwgZGl2cyB0aGF0IHdlIGZvdW5kXHJcbiAgICBmb3IgKGxldCBpID0gdG9uaWNEaXZzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgIC8vIFNldCB0aGUgZGl2XHJcbiAgICAgIGNvbnN0IHRvbmljRGl2ID0gdG9uaWNEaXZzW2ldIGFzIEhUTUxEaXZFbGVtZW50XHJcblxyXG4gICAgICAvLyBOb3Qgc3VyZSB3aHkgdGhpcyBpcyBuZWVkZWQgYnV0IGVuY291bnRlcmVkIHRoaXMgaW4gcHJvZCAzLzUvMjAyMSAtIGx1a2VcclxuICAgICAgaWYgKCF0b25pY0Rpdikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdleGl0IGVhcmx5IC0gcmVtb3ZlIHRoaXM/JylcclxuICAgICAgICBjb250aW51ZVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIHdpZGdldCBpZFxyXG4gICAgICBjb25zdCB3aWRnZXRJZCA9IHRvbmljRGl2LmdldEF0dHJpYnV0ZSh0aGlzLmNvbmZpZy53aWRnZXRJZEF0dHJpYnV0ZSlcclxuICAgICAgaWYgKCF3aWRnZXRJZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGAke3dpZGdldElkfSBub3QgZm91bmRgKVxyXG4gICAgICAgIGNvbnRpbnVlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCB0aGUgY3VzdG9tIGVudmlyb25tZW50IChzd2l0Y2hpbmcgYXdheSBmcm9tIGRlZmF1bHQ6IHByb2R1Y3Rpb24pXHJcbiAgICAgIGNvbnN0IGN1c3RvbUVudmlyb25tZW50ID0gdG9uaWNEaXYuZ2V0QXR0cmlidXRlKHRoaXMuY29uZmlnLmN1c3RvbUVudmlyb25tZW50QXR0cmlidXRlKVxyXG4gICAgICB0aGlzLmNvbmZpZy5zZXRFbnZpcm9ubWVudChjdXN0b21FbnZpcm9ubWVudCB8fCAncHJvZHVjdGlvbicpXHJcblxyXG4gICAgICAvLyBBZGQgdG8gd2lkZ2V0cyBtYXBcclxuICAgICAgdGhpcy53aWRnZXRzLnNldCh3aWRnZXRJZCwgbnVsbClcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8gRmlyZSB0aGUgcmVxdWVzdCB0byBsb2FkIHRoZSB3aWRnZXQgZGF0YVxyXG4gICAgICAgIGNvbnN0IHByb21pc2UgPSBhd2FpdCBmZXRjaChcclxuICAgICAgICAgIGAke3RoaXMuY29uZmlnLmFwaVVybH0vdjEvd2lkZ2V0cy9kaXNwbGF5LyR7d2lkZ2V0SWR9P3Byb3ZpZGVyPWVtYmVkLSR7dGhpcy5jb25maWcudmVyc2lvbn1gXHJcbiAgICAgICAgKVxyXG5cclxuICAgICAgICB2YXIgcmVzcG9uc2VcclxuXHJcbiAgICAgICAgLy8gSGFuZGxlIGRvbWFpbiBub3QgYWxsb3dlZFxyXG4gICAgICAgIGlmIChwcm9taXNlLnN0YXR1cyA9PT0gNDAzKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmluZm8oYCR7cHJvbWlzZS5zdGF0dXN9OiBEb21haW4gbm90IGFsbG93ZWRgKVxyXG4gICAgICAgICAgcmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgIGxpbmtfdXJsOiAnaHR0cHM6Ly90b25pY3Bvdy5jb20nLFxyXG4gICAgICAgICAgICBpbWFnZV91cmw6IGZhbGxiYWNrSW1hZ2UsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIEdldCBKU09OIHJlc3BvbnNlXHJcbiAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHByb21pc2UuanNvbigpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTZXQgVVJJIGVuY29kZWQgdGl0bGVcclxuICAgICAgICBjb25zdCBjYW1wYWlnblRpdGxlID0gZW5jb2RlVVJJQ29tcG9uZW50KHJlc3BvbnNlLnRpdGxlKVxyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIEhUTUxcclxuICAgICAgICB0b25pY0Rpdi5pbm5lckhUTUwgPSBgXHJcbiAgICAgIDxhIGhyZWY9XCIke3Jlc3BvbnNlLmxpbmtfdXJsfT91dG1fc291cmNlPXRvbmljcG93LXdpZGdldHMmdXRtX21lZGl1bT13aWRnZXQmdXRtX2NhbXBhaWduPSR7d2lkZ2V0SWR9JnV0bV9jb250ZW50PSR7Y2FtcGFpZ25UaXRsZX1cIiBzdHlsZT1cImRpc3BsYXk6IGlubGluZS1ibG9ja1wiPlxyXG4gICAgICA8aW1nIHNyYz1cIiR7cmVzcG9uc2UuaW1hZ2VfdXJsfVwiIFxyXG4gICAgICB3aWR0aD1cIiR7cmVzcG9uc2Uud2lkdGh9XCIgXHJcbiAgICAgIGhlaWdodD1cIiR7cmVzcG9uc2UuaGVpZ2h0fVwiIFxyXG4gICAgICBhbHQ9XCIke3Jlc3BvbnNlLnRpdGxlfVwiIC8+XHJcbiAgICAgIDwvYT5gXHJcblxyXG4gICAgICAgIC8vIFNldCB3aWRnZXQgZGltZXNpb25zXHJcbiAgICAgICAgdG9uaWNEaXYuc2V0QXR0cmlidXRlKCdkYXRhLXdpZHRoJywgcmVzcG9uc2Uud2lkdGgpXHJcbiAgICAgICAgdG9uaWNEaXYuc2V0QXR0cmlidXRlKCdkYXRhLWhlaWdodCcsIHJlc3BvbnNlLmhlaWdodClcclxuXHJcbiAgICAgICAgLy8gQWRkIHRvIHdpZGdldHMgbWFwXHJcbiAgICAgICAgdGhpcy53aWRnZXRzLnNldCh3aWRnZXRJZCwgcmVzcG9uc2UgYXMgdHlwZW9mIFdpZGdldClcclxuXHJcbiAgICAgICAgLy8gRmlyZSBvbldpZGdldExvYWRlZCBjYWxsYmFjayBpZiBwcm92aWRlZFxyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLm9uV2lkZ2V0TG9hZGVkKSB7XHJcbiAgICAgICAgICByZXNwb25zZS5pZCA9IHdpZGdldElkXHJcbiAgICAgICAgICB0aGlzLm9wdGlvbnMub25XaWRnZXRMb2FkZWQocmVzcG9uc2UgYXMgdHlwZW9mIFdpZGdldClcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICB0aHJvdyBlXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIExvYWQgdGhlIFRvbmljUG93IHNjcmlwdChzKSBhbmQgZGVmYXVsdCBzZXR0aW5nc1xyXG4gIGxvYWQgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBXZSBvbmx5IHdvcmsgaW4gYSBicm93c2VyXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignVG9uaWNQb3cgZW1iZWQgb25seSB3b3JrcyBpbiB0aGUgYnJvd3NlcicpXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIExvYWQgYWxsIHRvbmljcyBmb3VuZCBvbiB0aGUgcGFnZSAoaWYgd2UgaGF2ZSBkaXYpXHJcbiAgICBjb25zdCB0b25pY0RpdnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuY29uZmlnLndpZGdldERpdkNsYXNzKVxyXG4gICAgaWYgKHRvbmljRGl2cyAmJiB0b25pY0RpdnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZERpdnMoKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCclYyBUb25pY1BvdyB3aWRnZXQocykgbG9hZGVkISAnLCAnYmFja2dyb3VuZDogIzk3NENEMjsgY29sb3I6ICNmZmYnKVxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgdGhyb3cgZVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUHJvY2VzcyB2aXNpdG9yIHRva2VuXHJcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5jYXB0dXJlVmlzaXRvclNlc3Npb24oKVxyXG5cclxuICAgIC8vIENhcHR1cmUgZXZlbnRzIGlmIHdlIGhhdmUgYSBzZXNzaW9uXHJcbiAgICBpZiAoc2Vzc2lvbikge1xyXG4gICAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudHMoc2Vzc2lvbiwgdGhpcy5jb25maWcpXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyBBdXRvLWxvYWQgYW5kIHNldCBvbiB3aW5kb3dcclxudmFyIHRwb3cgPSBuZXcgVG9uaWNQb3coKVxyXG5jb25zb2xlLmxvZyh7IGNvbmZpZzogdHBvdy5jb25maWcgfSlcclxuOyh3aW5kb3cgYXMgYW55KS5Ub25pY1BvdyA9IHRwb3cgfHwge31cclxuIiwiLyogZ2xvYmFsIGxvY2FsU3RvcmFnZSAqL1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3RvcmFnZSB7XHJcbiAgLypcclxuICByZW1vdmVTdG9yYWdlOiByZW1vdmVzIGEga2V5IGZyb20gbG9jYWxTdG9yYWdlIGFuZCBpdHMgc2libGluZyBleHBpcmFjeSBrZXlcclxuICBwYXJhbXM6XHJcbiAgICAgIGtleSA8c3RyaW5nPiA6IGxvY2FsU3RvcmFnZSBrZXkgdG8gcmVtb3ZlXHJcbiAgcmV0dXJuczpcclxuICAgICAgPGJvb2xlYW4+IDogdGVsbGluZyBpZiBvcGVyYXRpb24gc3VjY2VlZGVkXHJcbiAgKi9cclxuICByZW1vdmVTdG9yYWdlID0gKG5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0obmFtZSlcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYCR7bmFtZX1fZXhwaXJlc0luYClcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgYHJlbW92ZVN0b3JhZ2U6IEVycm9yIHJlbW92aW5nIGtleSBbJHtuYW1lfV0gZnJvbSBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YFxyXG4gICAgICApXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWVcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgZ2V0U3RvcmFnZTogcmV0cmlldmVzIGEga2V5IGZyb20gbG9jYWxTdG9yYWdlIHByZXZpb3VzbHkgc2V0IHdpdGggc2V0U3RvcmFnZSgpLlxyXG4gIHBhcmFtczpcclxuICAgICAga2V5IDxzdHJpbmc+IDogbG9jYWxTdG9yYWdlIGtleVxyXG4gIHJldHVybnM6XHJcbiAgICAgIDxzdHJpbmc+IDogdmFsdWUgb2YgbG9jYWxTdG9yYWdlIGtleVxyXG4gICAgICBudWxsIDogaW4gY2FzZSBvZiBleHBpcmVkIGtleSBvciBmYWlsdXJlXHJcbiAgKi9cclxuICBnZXRTdG9yYWdlID0gKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAvLyBlcG9jaCB0aW1lLCBsZXRzIGRlYWwgb25seSB3aXRoIGludGVnZXJcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcclxuXHJcbiAgICAvLyBTZXQgZXhwaXJhdGlvbiBmb3Igc3RvcmFnZVxyXG4gICAgbGV0IGV4cGlyZXNcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBleHBpcmVzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYCR7a2V5fV9leHBpcmVzYClcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYGdldEl0ZW06IGVycm9yIGdldHRpbmcgbG9jYWxTdG9yYWdlOiAke0pTT04uc3RyaW5naWZ5KGUpfWApXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGV4cGlyZXMgPT09IHVuZGVmaW5lZCB8fCBleHBpcmVzID09PSBudWxsKSB7XHJcbiAgICAgIGV4cGlyZXMgPSAwXHJcbiAgICB9XHJcblxyXG4gICAgLy8gRXhwaXJlZFxyXG4gICAgaWYgKGV4cGlyZXMgPCBub3cpIHtcclxuICAgICAgdGhpcy5yZW1vdmVTdG9yYWdlKGtleSlcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZXQgdGhlIGV4aXN0aW5nIGl0ZW1cclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBnZXRTdG9yYWdlOiBFcnJvciByZWFkaW5nIGtleSBbJHtrZXl9XSBmcm9tIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICBzZXRTdG9yYWdlOiB3cml0ZXMgYSBrZXkgaW50byBsb2NhbFN0b3JhZ2Ugc2V0dGluZyBhIGV4cGlyZSB0aW1lXHJcbiAgcGFyYW1zOlxyXG4gICAgICBrZXkgPHN0cmluZz4gICAgIDogbG9jYWxTdG9yYWdlIGtleVxyXG4gICAgICB2YWx1ZSA8c3RyaW5nPiAgIDogbG9jYWxTdG9yYWdlIHZhbHVlXHJcbiAgICAgIGV4cGlyZXMgPG51bWJlcj4gOiBudW1iZXIgb2Ygc2Vjb25kcyBmcm9tIG5vdyB0byBleHBpcmUgdGhlIGtleVxyXG4gIHJldHVybnM6XHJcbiAgICAgIDxib29sZWFuPiA6IHRlbGxpbmcgaWYgb3BlcmF0aW9uIHN1Y2NlZWRlZFxyXG4gICovXHJcbiAgc2V0U3RvcmFnZSA9IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZywgZXhwaXJlczogbnVtYmVyIHwgbnVsbCA9IG51bGwpID0+IHtcclxuICAgIC8vIEV4cGlyZWQgdGltZVxyXG4gICAgaWYgKGV4cGlyZXMpIHtcclxuICAgICAgZXhwaXJlcyA9IE1hdGguYWJzKGV4cGlyZXMpIC8vIG1ha2Ugc3VyZSBpdCdzIHBvc2l0aXZlXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBleHBpcmVzID0gMjQgKiA2MCAqIDYwIC8vIGRlZmF1bHQ6IHNlY29uZHMgZm9yIDEgZGF5XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWlsbGkgc2Vjb25kcyBzaW5jZSBlcG9jaCB0aW1lLCBsZXRzIGRlYWwgb25seSB3aXRoIGludGVnZXJcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcclxuICAgIGNvbnN0IHNjaGVkdWxlID0gbm93ICsgZXhwaXJlcyAqIDEwMDBcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke2tleX1fZXhwaXJlc2AsIHNjaGVkdWxlLnRvU3RyaW5nKCkpXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBzZXRTdG9yYWdlOiBFcnJvciBzZXR0aW5nIGtleSBbJHtrZXl9XSBpbiBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YClcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZVxyXG4gIH1cclxufVxyXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHRpZihfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdKSB7XG5cdFx0cmV0dXJuIF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0uZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdClcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyY1xuXHRpZiAoIXNjcmlwdFVybCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0aWYoc2NyaXB0cy5sZW5ndGgpIHNjcmlwdFVybCA9IHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXS5zcmNcblx0fVxufVxuLy8gV2hlbiBzdXBwb3J0aW5nIGJyb3dzZXJzIHdoZXJlIGFuIGF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgeW91IG11c3Qgc3BlY2lmeSBhbiBvdXRwdXQucHVibGljUGF0aCBtYW51YWxseSB2aWEgY29uZmlndXJhdGlvblxuLy8gb3IgcGFzcyBhbiBlbXB0eSBzdHJpbmcgKFwiXCIpIGFuZCBzZXQgdGhlIF9fd2VicGFja19wdWJsaWNfcGF0aF9fIHZhcmlhYmxlIGZyb20geW91ciBjb2RlIHRvIHVzZSB5b3VyIG93biBsb2dpYy5cbmlmICghc2NyaXB0VXJsKSB0aHJvdyBuZXcgRXJyb3IoXCJBdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclwiKTtcbnNjcmlwdFVybCA9IHNjcmlwdFVybC5yZXBsYWNlKC8jLiokLywgXCJcIikucmVwbGFjZSgvXFw/LiokLywgXCJcIikucmVwbGFjZSgvXFwvW15cXC9dKyQvLCBcIi9cIik7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBzY3JpcHRVcmw7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYwNyk7XG4iXSwic291cmNlUm9vdCI6IiJ9