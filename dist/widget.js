(()=>{var t={916:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n=i.p+"0cc67b926321b46c35cc929178804e2f.svg"},913:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.isEnvironmentValid=t=>this.environments.includes(t),this.setEnvironment=t=>{t&&this.isEnvironmentValid(t)&&(this.environment=t,t===this.environmentStaging?(this.apiUrl=this.apiUrlStaging,this.eventsUrl=this.eventsUrlStaging):t===this.environmentLocal?(this.apiUrl=this.apiUrlLocal,this.eventsUrl=this.eventsUrlLocal):t===this.environmentProduction&&(this.apiUrl=this.apiUrlProduction,this.eventsUrl=this.eventsUrlProduction))},this.environmentLocal="local",this.environmentStaging="staging",this.environmentProduction="production",this.apiUrl="https://api.tonicpow.com",this.apiUrlLocal="http://localhost:3000",this.apiUrlStaging="https://api.staging.tonicpow.com",this.apiUrlProduction="https://api.tonicpow.com",this.eventsUrl="https://events.tonicpow.com",this.eventsUrlLocal="http://localhost:3002",this.eventsUrlStaging="https://events.staging.tonicpow.com",this.eventsUrlProduction="https://events.tonicpow.com",this.customEnvironmentAttribute="data-environment",this.environment="",this.environments=[this.environmentLocal,this.environmentStaging,this.environmentProduction],this.maxSessionDays=60,this.sessionName="tncpw_session",this.version="v0.0.8",this.widgetDivClass="tonicpow-widget",this.widgetIdAttribute="data-widget-id"}}}.apply(e,[i,e]))||(t.exports=n)},242:function(t,e,i){var n,o=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function c(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,c)}a((n=n.apply(t,e||[])).next())}))};void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.detectWidgetClick=()=>{document.addEventListener("click",(t=>o(this,void 0,void 0,(function*(){var e,i,n=(t||window.event).target;let o=null===(e=null==n?void 0:n.parentElement)||void 0===e?void 0:e.parentElement;if(null===(i=null==o?void 0:o.classList)||void 0===i?void 0:i.contains("tonicpow-widget"))try{yield this.sendEvent("click",o.getAttribute("widget-id")||"")}catch(t){console.error("failed to report interaction: click",t)}}))))},this.detectBounce=()=>{window.onbeforeunload=()=>{this.sendEvent("bounce",((new Date).getTime()-this.start).toString())}},this.detectInteraction=()=>{document.addEventListener("mousedown",(()=>o(this,void 0,void 0,(function*(){if(!this.interactionSent)try{yield this.sendEvent("interaction","mousedown"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: mousedown",t)}})))),document.addEventListener("scroll",(()=>o(this,void 0,void 0,(function*(){if(!this.interactionSent)try{yield this.sendEvent("interaction","scroll"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: scroll",t)}})))),document.addEventListener("keypress",(()=>o(this,void 0,void 0,(function*(){if(!this.interactionSent)try{yield this.sendEvent("interaction","keypress"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: keypress",t)}}))))},this.sendEvent=(t,e)=>o(this,void 0,void 0,(function*(){if(!this.sessionId)return void console.info("you must call init with a session before sending events");let i={v:this.config.version,name:t,tncpw_session:this.sessionId,data:e};yield fetch(`${this.config.eventsUrl}/v1/events?d=${btoa(JSON.stringify(i))}`,{method:"get"})})),this.sessionId=t,this.config=e,this.interactionSent=!1,this.start=(new Date).getTime(),this.detectInteraction(),this.detectBounce(),this.detectWidgetClick()}}}.apply(e,[i,e]))||(t.exports=n)},607:function(t,e,i){var n,o,s=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function c(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,c)}a((n=n.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(916),i(913),i(242),i(912)],void 0===(o=function(t,e,i,n,o,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=r(i),n=r(n),o=r(o),c=r(c);class a{constructor(t){this.registerEvents=()=>{if(!this.events){let t=this.getVisitorSession();t&&t.length&&(this.events=new o.default(t,this.config))}},this.setOreo=(t,e,i)=>{const n=new Date;n.setTime(n.getTime()+864e5*i),document.cookie=`${t}=${e};path=/;expires=${n.toUTCString()}`},this.captureVisitorSession=(t="")=>{let e=t;return t&&t.length||"undefined"==typeof window||(e=new URLSearchParams(window.location.search).get(this.config.sessionName)||""),e&&e.length>0?(this.setOreo(this.config.sessionName,e,this.config.maxSessionDays),this.storage.setStorage(this.config.sessionName,e,86400*this.config.maxSessionDays),e):null},this.getVisitorSession=()=>this.storage.getStorage(this.config.sessionName),this.loadDivs=()=>s(this,void 0,void 0,(function*(){const t=document.getElementsByClassName(this.config.widgetDivClass);for(let n=t.length-1;n>=0;n--){const o=t[n];if(!o){console.log("exit early - remove this?");continue}const s=o.getAttribute(this.config.widgetIdAttribute);if(!s){console.log(`${s} not found`);continue}const r=o.getAttribute(this.config.customEnvironmentAttribute);this.config.setEnvironment(r||"production"),this.widgets.set(s,null);try{const t=yield fetch(`${this.config.apiUrl}/v1/widgets/display/${s}?provider=embed-${this.config.version}`);var e;403===t.status?(console.info(`${t.status}: Domain not allowed`),e={link_url:"https://tonicpow.com",image_url:i.default}):e=yield t.json();const n=encodeURIComponent(e.title);o.innerHTML=`\n      <a href="${e.link_url}?utm_source=tonicpow-widgets&utm_medium=widget&utm_campaign=${s}&utm_content=${n}" style="display: inline-block">\n      <img src="${e.image_url}" \n      width="${e.width}" \n      height="${e.height}" \n      alt="${e.title}" />\n      </a>`,o.setAttribute("data-width",e.width),o.setAttribute("data-height",e.height),this.widgets.set(s,e),this.options&&this.options.onWidgetLoaded&&(e.id=s,this.options.onWidgetLoaded(e))}catch(t){throw t}}})),this.load=()=>s(this,void 0,void 0,(function*(){if("undefined"==typeof window)return void console.error("TonicPow embed only works in the browser");const t=document.getElementsByClassName(this.config.widgetDivClass);if(t&&t.length>0)try{yield this.loadDivs(),console.log("%c TonicPow widget(s) loaded! ","background: #974CD2; color: #fff")}catch(t){throw t}const e=this.captureVisitorSession();e&&(this.events=new o.default(e,this.config))})),this.config=new n.default,this.storage=new c.default,this.widgets=new Map,this.options=t,"complete"===document.readyState||"interactive"===document.readyState?(this.load(),this.registerEvents()):document.addEventListener("DOMContentLoaded",(()=>{this.load(),this.registerEvents()}))}}e.default=a;var l=new a;window.TonicPow=l||{}}.apply(e,n))||(t.exports=o)},912:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.removeStorage=t=>{try{localStorage.removeItem(t),localStorage.removeItem(`${t}_expiresIn`)}catch(e){return console.log(`removeStorage: Error removing key [${t}] from localStorage: ${JSON.stringify(e)}`),!1}return!0},this.getStorage=t=>{const e=Date.now();let i;try{i=localStorage.getItem(`${t}_expires`)}catch(t){return console.log(`getItem: error getting localStorage: ${JSON.stringify(t)}`),null}if(null==i&&(i=0),i<e)return this.removeStorage(t),null;try{return localStorage.getItem(t)}catch(e){return console.log(`getStorage: Error reading key [${t}] from localStorage: ${JSON.stringify(e)}`),null}},this.setStorage=(t,e,i=null)=>{i=i?Math.abs(i):86400;const n=Date.now()+1e3*i;try{localStorage.setItem(t,e),localStorage.setItem(`${t}_expires`,n.toString())}catch(e){return console.log(`setStorage: Error setting key [${t}] in localStorage: ${JSON.stringify(e)}`),!1}return!0}}}}.apply(e,[i,e]))||(t.exports=n)}},e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.p="",i(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2Fzc2V0cy9pbWFnZV9wbGFjZWhvbGRlcl90b25pY3Bvd19zcXVhcmUuc3ZnIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvY29uZmlnLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvZXZlbnRzLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC8uL3NyYy9zdG9yYWdlLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0L3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbImlzRW52aXJvbm1lbnRWYWxpZCIsImVudmlyb25tZW50IiwidGhpcyIsImVudmlyb25tZW50cyIsImluY2x1ZGVzIiwic2V0RW52aXJvbm1lbnQiLCJlbnZpcm9ubWVudFN0YWdpbmciLCJhcGlVcmwiLCJhcGlVcmxTdGFnaW5nIiwiZXZlbnRzVXJsIiwiZXZlbnRzVXJsU3RhZ2luZyIsImVudmlyb25tZW50TG9jYWwiLCJhcGlVcmxMb2NhbCIsImV2ZW50c1VybExvY2FsIiwiZW52aXJvbm1lbnRQcm9kdWN0aW9uIiwiYXBpVXJsUHJvZHVjdGlvbiIsImV2ZW50c1VybFByb2R1Y3Rpb24iLCJjdXN0b21FbnZpcm9ubWVudEF0dHJpYnV0ZSIsIm1heFNlc3Npb25EYXlzIiwic2Vzc2lvbk5hbWUiLCJ2ZXJzaW9uIiwid2lkZ2V0RGl2Q2xhc3MiLCJ3aWRnZXRJZEF0dHJpYnV0ZSIsInNlc3Npb25JZCIsImNvbmZpZyIsImRldGVjdFdpZGdldENsaWNrIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRhcmdldCIsIndpbmRvdyIsImV2ZW50IiwiY29udGFpbmVyIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwic2VuZEV2ZW50IiwiZ2V0QXR0cmlidXRlIiwiY29uc29sZSIsImVycm9yIiwiZGV0ZWN0Qm91bmNlIiwib25iZWZvcmV1bmxvYWQiLCJEYXRlIiwiZ2V0VGltZSIsInN0YXJ0IiwidG9TdHJpbmciLCJkZXRlY3RJbnRlcmFjdGlvbiIsImludGVyYWN0aW9uU2VudCIsImV2ZW50TmFtZSIsImRhdGEiLCJpbmZvIiwicGF5bG9hZCIsInYiLCJuYW1lIiwidG5jcHdfc2Vzc2lvbiIsImZldGNoIiwiYnRvYSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRob2QiLCJUb25pY1BvdyIsIm9wdGlvbnMiLCJyZWdpc3RlckV2ZW50cyIsImV2ZW50cyIsInNlc3Npb24iLCJnZXRWaXNpdG9yU2Vzc2lvbiIsImxlbmd0aCIsInNldE9yZW8iLCJ2YWx1ZSIsImRheXMiLCJkYXRlIiwic2V0VGltZSIsImNvb2tpZSIsInRvVVRDU3RyaW5nIiwiY2FwdHVyZVZpc2l0b3JTZXNzaW9uIiwiY3VzdG9tU2Vzc2lvbklkIiwiVVJMU2VhcmNoUGFyYW1zIiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJzdG9yYWdlIiwic2V0U3RvcmFnZSIsImdldFN0b3JhZ2UiLCJsb2FkRGl2cyIsInRvbmljRGl2cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJpIiwidG9uaWNEaXYiLCJsb2ciLCJ3aWRnZXRJZCIsImN1c3RvbUVudmlyb25tZW50Iiwid2lkZ2V0cyIsInNldCIsInByb21pc2UiLCJyZXNwb25zZSIsInN0YXR1cyIsImxpbmtfdXJsIiwiaW1hZ2VfdXJsIiwianNvbiIsImNhbXBhaWduVGl0bGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJ0aXRsZSIsImlubmVySFRNTCIsIndpZHRoIiwiaGVpZ2h0Iiwic2V0QXR0cmlidXRlIiwib25XaWRnZXRMb2FkZWQiLCJpZCIsImxvYWQiLCJNYXAiLCJyZWFkeVN0YXRlIiwidHBvdyIsInJlbW92ZVN0b3JhZ2UiLCJsb2NhbFN0b3JhZ2UiLCJyZW1vdmVJdGVtIiwia2V5Iiwibm93IiwiZXhwaXJlcyIsImdldEl0ZW0iLCJNYXRoIiwiYWJzIiwic2NoZWR1bGUiLCJzZXRJdGVtIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwiZCIsImRlZmluaXRpb24iLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwicCJdLCJtYXBwaW5ncyI6InNFQUFBLFFBQWUsSUFBMEIsd0MsNEdDQXpDLGdCQXFCRSxjQXdCQSxLQUFBQSxtQkFBc0JDLEdBQXdCQyxLQUFLQyxhQUFhQyxTQUFTSCxHQUd6RSxLQUFBSSxlQUFrQkosSUFFWEEsR0FLQUMsS0FBS0YsbUJBQW1CQyxLQUs3QkMsS0FBS0QsWUFBY0EsRUFHZkEsSUFBZ0JDLEtBQUtJLG9CQUN2QkosS0FBS0ssT0FBU0wsS0FBS00sY0FDbkJOLEtBQUtPLFVBQVlQLEtBQUtRLGtCQUNiVCxJQUFnQkMsS0FBS1Msa0JBQzlCVCxLQUFLSyxPQUFTTCxLQUFLVSxZQUNuQlYsS0FBS08sVUFBWVAsS0FBS1csZ0JBQ2JaLElBQWdCQyxLQUFL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cHVibGljX3BhdGhfXyArIFwiMGNjNjdiOTI2MzIxYjQ2YzM1Y2M5MjkxNzg4MDRlMmYuc3ZnXCI7IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uZmlnIHtcclxuICBlbnZpcm9ubWVudExvY2FsOiBzdHJpbmdcclxuICBlbnZpcm9ubWVudFN0YWdpbmc6IHN0cmluZ1xyXG4gIGVudmlyb25tZW50UHJvZHVjdGlvbjogc3RyaW5nXHJcbiAgYXBpVXJsOiBzdHJpbmdcclxuICBhcGlVcmxMb2NhbDogc3RyaW5nXHJcbiAgYXBpVXJsU3RhZ2luZzogc3RyaW5nXHJcbiAgYXBpVXJsUHJvZHVjdGlvbjogc3RyaW5nXHJcbiAgZXZlbnRzVXJsOiBzdHJpbmdcclxuICBldmVudHNVcmxMb2NhbDogc3RyaW5nXHJcbiAgZXZlbnRzVXJsU3RhZ2luZzogc3RyaW5nXHJcbiAgZXZlbnRzVXJsUHJvZHVjdGlvbjogc3RyaW5nXHJcbiAgY3VzdG9tRW52aXJvbm1lbnRBdHRyaWJ1dGU6IHN0cmluZ1xyXG4gIGVudmlyb25tZW50OiBzdHJpbmdcclxuICBlbnZpcm9ubWVudHM6IHN0cmluZ1tdXHJcbiAgbWF4U2Vzc2lvbkRheXM6IG51bWJlclxyXG4gIHNlc3Npb25OYW1lOiBzdHJpbmdcclxuICB2ZXJzaW9uOiBzdHJpbmdcclxuICB3aWRnZXREaXZDbGFzczogc3RyaW5nXHJcbiAgd2lkZ2V0SWRBdHRyaWJ1dGU6IHN0cmluZ1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZW52aXJvbm1lbnRMb2NhbCA9ICdsb2NhbCdcclxuICAgIHRoaXMuZW52aXJvbm1lbnRTdGFnaW5nID0gJ3N0YWdpbmcnXHJcbiAgICB0aGlzLmVudmlyb25tZW50UHJvZHVjdGlvbiA9ICdwcm9kdWN0aW9uJ1xyXG5cclxuICAgIHRoaXMuYXBpVXJsID0gJ2h0dHBzOi8vYXBpLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuYXBpVXJsTG9jYWwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ1xyXG4gICAgdGhpcy5hcGlVcmxTdGFnaW5nID0gJ2h0dHBzOi8vYXBpLnN0YWdpbmcudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5hcGlVcmxQcm9kdWN0aW9uID0gJ2h0dHBzOi8vYXBpLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuZXZlbnRzVXJsID0gJ2h0dHBzOi8vZXZlbnRzLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuZXZlbnRzVXJsTG9jYWwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAyJ1xyXG4gICAgdGhpcy5ldmVudHNVcmxTdGFnaW5nID0gJ2h0dHBzOi8vZXZlbnRzLnN0YWdpbmcudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5ldmVudHNVcmxQcm9kdWN0aW9uID0gJ2h0dHBzOi8vZXZlbnRzLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuY3VzdG9tRW52aXJvbm1lbnRBdHRyaWJ1dGUgPSAnZGF0YS1lbnZpcm9ubWVudCdcclxuICAgIHRoaXMuZW52aXJvbm1lbnQgPSAnJ1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudHMgPSBbdGhpcy5lbnZpcm9ubWVudExvY2FsLCB0aGlzLmVudmlyb25tZW50U3RhZ2luZywgdGhpcy5lbnZpcm9ubWVudFByb2R1Y3Rpb25dXHJcbiAgICB0aGlzLm1heFNlc3Npb25EYXlzID0gNjBcclxuICAgIHRoaXMuc2Vzc2lvbk5hbWUgPSAndG5jcHdfc2Vzc2lvbidcclxuICAgIHRoaXMudmVyc2lvbiA9ICd2MC4wLjgnXHJcbiAgICB0aGlzLndpZGdldERpdkNsYXNzID0gJ3RvbmljcG93LXdpZGdldCdcclxuICAgIHRoaXMud2lkZ2V0SWRBdHRyaWJ1dGUgPSAnZGF0YS13aWRnZXQtaWQnXHJcbiAgfVxyXG5cclxuICAvLyBpc0Vudmlyb25tZW50VmFsaWQgd2lsbCBjaGVjayBpZiB0aGUgZ2l2ZW4gZW52aXJvbm1lbnQgaXMgdmFsaWRcclxuICBpc0Vudmlyb25tZW50VmFsaWQgPSAoZW52aXJvbm1lbnQ6IHN0cmluZykgPT4gdGhpcy5lbnZpcm9ubWVudHMuaW5jbHVkZXMoZW52aXJvbm1lbnQpXHJcblxyXG4gIC8vIHNldEVudmlyb25tZW50IHdpbGwgc2V0IHRoZSBlbnZpcm9ubWVudFxyXG4gIHNldEVudmlyb25tZW50ID0gKGVudmlyb25tZW50OiBzdHJpbmcpID0+IHtcclxuICAgIC8vIE5vIGVudmlyb25tZW50IHNldD8gdXNlIHRoZSBkZWZhdWx0XHJcbiAgICBpZiAoIWVudmlyb25tZW50KSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIE5vdCBhIHZhbGlkIGVudmlyb25tZW50P1xyXG4gICAgaWYgKCF0aGlzLmlzRW52aXJvbm1lbnRWYWxpZChlbnZpcm9ubWVudCkpIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IHRoZSBlbnZpcm9ubWVudFxyXG4gICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50XHJcblxyXG4gICAgLy8gU2V0IHRoZSBBUEkgdXJsXHJcbiAgICBpZiAoZW52aXJvbm1lbnQgPT09IHRoaXMuZW52aXJvbm1lbnRTdGFnaW5nKSB7XHJcbiAgICAgIHRoaXMuYXBpVXJsID0gdGhpcy5hcGlVcmxTdGFnaW5nXHJcbiAgICAgIHRoaXMuZXZlbnRzVXJsID0gdGhpcy5ldmVudHNVcmxTdGFnaW5nXHJcbiAgICB9IGVsc2UgaWYgKGVudmlyb25tZW50ID09PSB0aGlzLmVudmlyb25tZW50TG9jYWwpIHtcclxuICAgICAgdGhpcy5hcGlVcmwgPSB0aGlzLmFwaVVybExvY2FsXHJcbiAgICAgIHRoaXMuZXZlbnRzVXJsID0gdGhpcy5ldmVudHNVcmxMb2NhbFxyXG4gICAgfSBlbHNlIGlmIChlbnZpcm9ubWVudCA9PT0gdGhpcy5lbnZpcm9ubWVudFByb2R1Y3Rpb24pIHtcclxuICAgICAgdGhpcy5hcGlVcmwgPSB0aGlzLmFwaVVybFByb2R1Y3Rpb25cclxuICAgICAgdGhpcy5ldmVudHNVcmwgPSB0aGlzLmV2ZW50c1VybFByb2R1Y3Rpb25cclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZydcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50cyB7XHJcbiAgc2Vzc2lvbklkOiBzdHJpbmdcclxuICBzdGFydDogbnVtYmVyXHJcbiAgaW50ZXJhY3Rpb25TZW50OiBib29sZWFuXHJcbiAgY29uZmlnOiBDb25maWdcclxuXHJcbiAgY29uc3RydWN0b3Ioc2Vzc2lvbklkOiBzdHJpbmcsIGNvbmZpZzogQ29uZmlnKSB7XHJcbiAgICAvLyBTZXQgdGhlIGN1cnJlbnQgc2Vzc2lvblxyXG4gICAgdGhpcy5zZXNzaW9uSWQgPSBzZXNzaW9uSWRcclxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnXHJcblxyXG4gICAgdGhpcy5pbnRlcmFjdGlvblNlbnQgPSBmYWxzZVxyXG5cclxuICAgIC8vIFJlbWVtYmVyIHdoZW4gd2Ugc3RhcnRlZFxyXG4gICAgdGhpcy5zdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICB0aGlzLmRldGVjdEludGVyYWN0aW9uKClcclxuICAgIHRoaXMuZGV0ZWN0Qm91bmNlKClcclxuICAgIHRoaXMuZGV0ZWN0V2lkZ2V0Q2xpY2soKVxyXG4gIH1cclxuXHJcbiAgLy8gRGV0ZWN0cyBjbGljayBvbiB0aGUgd2lkZ2V0XHJcbiAgZGV0ZWN0V2lkZ2V0Q2xpY2sgPSAoKSA9PiB7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlOiBFdmVudCkgPT4ge1xyXG4gICAgICAvLyBHZXQgdGhlIGNsaWNrIHRhcmdldFxyXG4gICAgICB2YXIgdGFyZ2V0ID0gKGUgfHwgd2luZG93LmV2ZW50KS50YXJnZXQgYXMgSFRNTERpdkVsZW1lbnRcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgd2lkZ2V0IGNvbnRhaW5lclxyXG4gICAgICBsZXQgY29udGFpbmVyID0gdGFyZ2V0Py5wYXJlbnRFbGVtZW50Py5wYXJlbnRFbGVtZW50XHJcblxyXG4gICAgICAvLyBTZW5kIGV2ZW50IG9ubHkgaWYgd2lkZ2V0IHdhcyBjbGlja2VkXHJcbiAgICAgIGlmIChjb250YWluZXI/LmNsYXNzTGlzdD8uY29udGFpbnMoJ3RvbmljcG93LXdpZGdldCcpKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEV2ZW50KCdjbGljaycsIGNvbnRhaW5lci5nZXRBdHRyaWJ1dGUoJ3dpZGdldC1pZCcpIHx8ICcnKVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZhaWxlZCB0byByZXBvcnQgaW50ZXJhY3Rpb246IGNsaWNrJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBEZXRlY3RzIGEgYm91bmNlIGV2ZW50XHJcbiAgZGV0ZWN0Qm91bmNlID0gKCkgPT4ge1xyXG4gICAgd2luZG93Lm9uYmVmb3JldW5sb2FkID0gKCkgPT4ge1xyXG4gICAgICAvLyBDYWxjdWxhdGUgdGltZSBvbiBwYWdlXHJcbiAgICAgIHRoaXMuc2VuZEV2ZW50KCdib3VuY2UnLCAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0KS50b1N0cmluZygpKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRGV0ZWN0cyBhIHBhZ2UgaW50ZXJhY3Rpb25cclxuICBkZXRlY3RJbnRlcmFjdGlvbiA9ICgpID0+IHtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCF0aGlzLmludGVyYWN0aW9uU2VudCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRFdmVudCgnaW50ZXJhY3Rpb24nLCAnbW91c2Vkb3duJylcclxuICAgICAgICAgIHRoaXMuaW50ZXJhY3Rpb25TZW50ID0gdHJ1ZVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZhaWxlZCB0byByZXBvcnQgaW50ZXJhY3Rpb246IG1vdXNlZG93bicsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCF0aGlzLmludGVyYWN0aW9uU2VudCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRFdmVudCgnaW50ZXJhY3Rpb24nLCAnc2Nyb2xsJylcclxuICAgICAgICAgIHRoaXMuaW50ZXJhY3Rpb25TZW50ID0gdHJ1ZVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZhaWxlZCB0byByZXBvcnQgaW50ZXJhY3Rpb246IHNjcm9sbCcsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25TZW50KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEV2ZW50KCdpbnRlcmFjdGlvbicsICdrZXlwcmVzcycpXHJcbiAgICAgICAgICB0aGlzLmludGVyYWN0aW9uU2VudCA9IHRydWVcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBrZXlwcmVzcycsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLy8gU2VuZCBldmVudCB3aWxsIHNlbmQgYW4gZXZlbnQgdG8gVG9uaWNQb3dcclxuICBzZW5kRXZlbnQgPSBhc3luYyAoZXZlbnROYW1lOiBzdHJpbmcsIGRhdGE6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKCF0aGlzLnNlc3Npb25JZCkge1xyXG4gICAgICBjb25zb2xlLmluZm8oJ3lvdSBtdXN0IGNhbGwgaW5pdCB3aXRoIGEgc2Vzc2lvbiBiZWZvcmUgc2VuZGluZyBldmVudHMnKVxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBQYWNrYWdlIHBheWxvYWRcclxuICAgIGxldCBwYXlsb2FkID0ge1xyXG4gICAgICB2OiB0aGlzLmNvbmZpZy52ZXJzaW9uLFxyXG4gICAgICBuYW1lOiBldmVudE5hbWUsXHJcbiAgICAgIHRuY3B3X3Nlc3Npb246IHRoaXMuc2Vzc2lvbklkLFxyXG4gICAgICBkYXRhLFxyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IGZldGNoKGAke3RoaXMuY29uZmlnLmV2ZW50c1VybH0vdjEvZXZlbnRzP2Q9JHtidG9hKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKX1gLCB7XHJcbiAgICAgIG1ldGhvZDogJ2dldCcsXHJcbiAgICB9KVxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgZmFsbGJhY2tJbWFnZSBmcm9tICcuL2Fzc2V0cy9pbWFnZV9wbGFjZWhvbGRlcl90b25pY3Bvd19zcXVhcmUuc3ZnJ1xyXG5pbXBvcnQgQ29uZmlnIGZyb20gJy4vY29uZmlnJ1xyXG5pbXBvcnQgRXZlbnRzIGZyb20gJy4vZXZlbnRzJ1xyXG5pbXBvcnQgU3RvcmFnZSBmcm9tICcuL3N0b3JhZ2UnXHJcbmltcG9ydCBXaWRnZXQgZnJvbSAnLi90eXBlcydcclxuXHJcbmludGVyZmFjZSBUb25pY1Bvd09wdGlvbnMge1xyXG4gIG9uV2lkZ2V0TG9hZGVkOiAod2lkZ2V0OiB0eXBlb2YgV2lkZ2V0KSA9PiB2b2lkXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvbmljUG93IHtcclxuICBjb25maWc6IENvbmZpZ1xyXG4gIHN0b3JhZ2U6IFN0b3JhZ2VcclxuICBldmVudHM6IEV2ZW50cyB8IHVuZGVmaW5lZFxyXG4gIHdpZGdldHM6IE1hcDxTdHJpbmcsIHR5cGVvZiBXaWRnZXQgfCBudWxsPlxyXG4gIG9wdGlvbnM6IFRvbmljUG93T3B0aW9ucyB8IHVuZGVmaW5lZFxyXG5cclxuICBjb25zdHJ1Y3RvcihvcHRpb25zPzogVG9uaWNQb3dPcHRpb25zKSB7XHJcbiAgICAvLyBTZXQgbmFtZXNwYWNlc1xyXG4gICAgdGhpcy5jb25maWcgPSBuZXcgQ29uZmlnKClcclxuICAgIHRoaXMuc3RvcmFnZSA9IG5ldyBTdG9yYWdlKClcclxuICAgIHRoaXMud2lkZ2V0cyA9IG5ldyBNYXA8U3RyaW5nLCB0eXBlb2YgV2lkZ2V0PigpXHJcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zXHJcblxyXG4gICAgLy8gU3RhcnQgdGhlIFRvbmljUG93IHNlcnZpY2UgYW5kIGxvYWQgbW9kdWxlc1xyXG5cclxuICAgIC8vIExvYWQgdGhlIFRvbmljUG93IHdpZGdldCB3aGVuIERPTSBpcyByZWFkeVxyXG4gICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJykge1xyXG4gICAgICAvLyBUaGlzIGxvYWRzIGlmIHRoZSA8c2NyaXB0PiBpcyBkeW5hbWljYWxseSBpbmplY3RlZCBpbnRvIHRoZSBwYWdlXHJcbiAgICAgIHRoaXMubG9hZCgpXHJcbiAgICAgIHRoaXMucmVnaXN0ZXJFdmVudHMoKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gVGhpcyBsb2FkcyBpZiB0aGUgPHNjcmlwdD4gaXMgaGFyZGNvZGVkIGluIHRoZSBodG1sIHBhZ2UgaW4gdGhlIDxoZWFkPlxyXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubG9hZCgpXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50cygpXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyByZWdpc3RlckV2ZW50cyAtUmVnaXN0ZXJzIGV2ZW50IGxpc3RlbmVycy4gUnVucyBvbmx5IG9uY2VcclxuICByZWdpc3RlckV2ZW50cyA9ICgpID0+IHtcclxuICAgIGlmICghdGhpcy5ldmVudHMpIHtcclxuICAgICAgLy8gUmVnaXN0ZXIgZXZlbnRzIGlmIHdlIGhhdmUgYSB2YWxpZCBzZXNzaW9uXHJcbiAgICAgIGxldCBzZXNzaW9uID0gdGhpcy5nZXRWaXNpdG9yU2Vzc2lvbigpXHJcbiAgICAgIC8vIFRPRE86IFZhbGlkYXRlIHNlc3Npb24gaGVyZVxyXG4gICAgICBpZiAoc2Vzc2lvbiAmJiBzZXNzaW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuZXZlbnRzID0gbmV3IEV2ZW50cyhzZXNzaW9uLCB0aGlzLmNvbmZpZylcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gc2V0T3JlbyBmb3IgY3JlYXRpbmcgbmV3IG9yZW9zXHJcbiAgc2V0T3JlbyA9IChuYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIGRheXM6IG51bWJlcikgPT4ge1xyXG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKClcclxuICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIDI0ICogNjAgKiA2MCAqIDEwMDAgKiBkYXlzKVxyXG4gICAgZG9jdW1lbnQuY29va2llID0gYCR7bmFtZX09JHt2YWx1ZX07cGF0aD0vO2V4cGlyZXM9JHtkYXRlLnRvVVRDU3RyaW5nKCl9YFxyXG4gIH1cclxuXHJcbiAgLy8gY2FwdHVyZVZpc2l0b3JTZXNzaW9uIHdpbGwgY2FwdHVyZSB0aGUgc2Vzc2lvbiBhbmQgc3RvcmUgaXRcclxuICAvLyBCdWlsZHMgYSBjb29raWUgc28gaXQncyBzZW50IG9uIHJlcXVlc3RzIGF1dG9tYXRpY2FsbHlcclxuICAvLyBTdG9yZXMgaW4gbG9jYWwgc3RvcmFnZSBmb3IgZWFzeSBhY2Nlc3MgZnJvbSB0aGUgYXBwbGljYXRpb25cclxuICBjYXB0dXJlVmlzaXRvclNlc3Npb24gPSAoY3VzdG9tU2Vzc2lvbklkOiBzdHJpbmcgPSAnJykgPT4ge1xyXG4gICAgbGV0IHNlc3Npb25JZCA9IGN1c3RvbVNlc3Npb25JZFxyXG5cclxuICAgIGlmICgoIWN1c3RvbVNlc3Npb25JZCB8fCAhY3VzdG9tU2Vzc2lvbklkLmxlbmd0aCkgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKVxyXG4gICAgICBzZXNzaW9uSWQgPSB1cmxQYXJhbXMuZ2V0KHRoaXMuY29uZmlnLnNlc3Npb25OYW1lKSB8fCAnJ1xyXG4gICAgfVxyXG4gICAgaWYgKHNlc3Npb25JZCAmJiBzZXNzaW9uSWQubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLnNldE9yZW8odGhpcy5jb25maWcuc2Vzc2lvbk5hbWUsIHNlc3Npb25JZCwgdGhpcy5jb25maWcubWF4U2Vzc2lvbkRheXMpXHJcbiAgICAgIHRoaXMuc3RvcmFnZS5zZXRTdG9yYWdlKFxyXG4gICAgICAgIHRoaXMuY29uZmlnLnNlc3Npb25OYW1lLFxyXG4gICAgICAgIHNlc3Npb25JZCxcclxuICAgICAgICAyNCAqIDYwICogNjAgKiB0aGlzLmNvbmZpZy5tYXhTZXNzaW9uRGF5c1xyXG4gICAgICApXHJcbiAgICAgIHJldHVybiBzZXNzaW9uSWRcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsXHJcbiAgfVxyXG5cclxuICAvLyBnZXRWaXNpdG9yU2Vzc2lvbiB3aWxsIGdldCB0aGUgc2Vzc2lvbiBpZiBpdCBleGlzdHNcclxuICBnZXRWaXNpdG9yU2Vzc2lvbiA9ICgpID0+IHRoaXMuc3RvcmFnZS5nZXRTdG9yYWdlKHRoaXMuY29uZmlnLnNlc3Npb25OYW1lKVxyXG5cclxuICAvLyBsb2FkRGl2cyByZXBsYWNlcyBlYWNoIFRvbmljUG93IGRpdiB3aXRoIGEgY29ycmVzcG9uZGluZyBlbWJlZCB3aWRnZXRcclxuICBsb2FkRGl2cyA9IGFzeW5jICgpID0+IHtcclxuICAgIC8vIEdldCBhbGwgZGl2c1xyXG4gICAgY29uc3QgdG9uaWNEaXZzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLmNvbmZpZy53aWRnZXREaXZDbGFzcylcclxuXHJcbiAgICAvLyBMb29wIGFsbCBkaXZzIHRoYXQgd2UgZm91bmRcclxuICAgIGZvciAobGV0IGkgPSB0b25pY0RpdnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgLy8gU2V0IHRoZSBkaXZcclxuICAgICAgY29uc3QgdG9uaWNEaXYgPSB0b25pY0RpdnNbaV0gYXMgSFRNTERpdkVsZW1lbnRcclxuXHJcbiAgICAgIC8vIE5vdCBzdXJlIHdoeSB0aGlzIGlzIG5lZWRlZCBidXQgZW5jb3VudGVyZWQgdGhpcyBpbiBwcm9kIDMvNS8yMDIxIC0gbHVrZVxyXG4gICAgICBpZiAoIXRvbmljRGl2KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2V4aXQgZWFybHkgLSByZW1vdmUgdGhpcz8nKVxyXG4gICAgICAgIGNvbnRpbnVlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCB0aGUgd2lkZ2V0IGlkXHJcbiAgICAgIGNvbnN0IHdpZGdldElkID0gdG9uaWNEaXYuZ2V0QXR0cmlidXRlKHRoaXMuY29uZmlnLndpZGdldElkQXR0cmlidXRlKVxyXG4gICAgICBpZiAoIXdpZGdldElkKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYCR7d2lkZ2V0SWR9IG5vdCBmb3VuZGApXHJcbiAgICAgICAgY29udGludWVcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IHRoZSBjdXN0b20gZW52aXJvbm1lbnQgKHN3aXRjaGluZyBhd2F5IGZyb20gZGVmYXVsdDogcHJvZHVjdGlvbilcclxuICAgICAgY29uc3QgY3VzdG9tRW52aXJvbm1lbnQgPSB0b25pY0Rpdi5nZXRBdHRyaWJ1dGUodGhpcy5jb25maWcuY3VzdG9tRW52aXJvbm1lbnRBdHRyaWJ1dGUpXHJcbiAgICAgIHRoaXMuY29uZmlnLnNldEVudmlyb25tZW50KGN1c3RvbUVudmlyb25tZW50IHx8ICdwcm9kdWN0aW9uJylcclxuXHJcbiAgICAgIC8vIEFkZCB0byB3aWRnZXRzIG1hcFxyXG4gICAgICB0aGlzLndpZGdldHMuc2V0KHdpZGdldElkLCBudWxsKVxyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBGaXJlIHRoZSByZXF1ZXN0IHRvIGxvYWQgdGhlIHdpZGdldCBkYXRhXHJcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IGF3YWl0IGZldGNoKFxyXG4gICAgICAgICAgYCR7dGhpcy5jb25maWcuYXBpVXJsfS92MS93aWRnZXRzL2Rpc3BsYXkvJHt3aWRnZXRJZH0/cHJvdmlkZXI9ZW1iZWQtJHt0aGlzLmNvbmZpZy52ZXJzaW9ufWBcclxuICAgICAgICApXHJcblxyXG4gICAgICAgIHZhciByZXNwb25zZVxyXG5cclxuICAgICAgICAvLyBIYW5kbGUgZG9tYWluIG5vdCBhbGxvd2VkXHJcbiAgICAgICAgaWYgKHByb21pc2Uuc3RhdHVzID09PSA0MDMpIHtcclxuICAgICAgICAgIGNvbnNvbGUuaW5mbyhgJHtwcm9taXNlLnN0YXR1c306IERvbWFpbiBub3QgYWxsb3dlZGApXHJcbiAgICAgICAgICByZXNwb25zZSA9IHtcclxuICAgICAgICAgICAgbGlua191cmw6ICdodHRwczovL3RvbmljcG93LmNvbScsXHJcbiAgICAgICAgICAgIGltYWdlX3VybDogZmFsbGJhY2tJbWFnZSxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gR2V0IEpTT04gcmVzcG9uc2VcclxuICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgcHJvbWlzZS5qc29uKClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNldCBVUkkgZW5jb2RlZCB0aXRsZVxyXG4gICAgICAgIGNvbnN0IGNhbXBhaWduVGl0bGUgPSBlbmNvZGVVUklDb21wb25lbnQocmVzcG9uc2UudGl0bGUpXHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgSFRNTFxyXG4gICAgICAgIHRvbmljRGl2LmlubmVySFRNTCA9IGBcclxuICAgICAgPGEgaHJlZj1cIiR7cmVzcG9uc2UubGlua191cmx9P3V0bV9zb3VyY2U9dG9uaWNwb3ctd2lkZ2V0cyZ1dG1fbWVkaXVtPXdpZGdldCZ1dG1fY2FtcGFpZ249JHt3aWRnZXRJZH0mdXRtX2NvbnRlbnQ9JHtjYW1wYWlnblRpdGxlfVwiIHN0eWxlPVwiZGlzcGxheTogaW5saW5lLWJsb2NrXCI+XHJcbiAgICAgIDxpbWcgc3JjPVwiJHtyZXNwb25zZS5pbWFnZV91cmx9XCIgXHJcbiAgICAgIHdpZHRoPVwiJHtyZXNwb25zZS53aWR0aH1cIiBcclxuICAgICAgaGVpZ2h0PVwiJHtyZXNwb25zZS5oZWlnaHR9XCIgXHJcbiAgICAgIGFsdD1cIiR7cmVzcG9uc2UudGl0bGV9XCIgLz5cclxuICAgICAgPC9hPmBcclxuXHJcbiAgICAgICAgLy8gU2V0IHdpZGdldCBkaW1lc2lvbnNcclxuICAgICAgICB0b25pY0Rpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtd2lkdGgnLCByZXNwb25zZS53aWR0aClcclxuICAgICAgICB0b25pY0Rpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JywgcmVzcG9uc2UuaGVpZ2h0KVxyXG5cclxuICAgICAgICAvLyBBZGQgdG8gd2lkZ2V0cyBtYXBcclxuICAgICAgICB0aGlzLndpZGdldHMuc2V0KHdpZGdldElkLCByZXNwb25zZSBhcyB0eXBlb2YgV2lkZ2V0KVxyXG5cclxuICAgICAgICAvLyBGaXJlIG9uV2lkZ2V0TG9hZGVkIGNhbGxiYWNrIGlmIHByb3ZpZGVkXHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMub25XaWRnZXRMb2FkZWQpIHtcclxuICAgICAgICAgIHJlc3BvbnNlLmlkID0gd2lkZ2V0SWRcclxuICAgICAgICAgIHRoaXMub3B0aW9ucy5vbldpZGdldExvYWRlZChyZXNwb25zZSBhcyB0eXBlb2YgV2lkZ2V0KVxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHRocm93IGVcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTG9hZCB0aGUgVG9uaWNQb3cgc2NyaXB0KHMpIGFuZCBkZWZhdWx0IHNldHRpbmdzXHJcbiAgbG9hZCA9IGFzeW5jICgpID0+IHtcclxuICAgIC8vIFdlIG9ubHkgd29yayBpbiBhIGJyb3dzZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdUb25pY1BvdyBlbWJlZCBvbmx5IHdvcmtzIGluIHRoZSBicm93c2VyJylcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9hZCBhbGwgdG9uaWNzIGZvdW5kIG9uIHRoZSBwYWdlIChpZiB3ZSBoYXZlIGRpdilcclxuICAgIGNvbnN0IHRvbmljRGl2cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGhpcy5jb25maWcud2lkZ2V0RGl2Q2xhc3MpXHJcbiAgICBpZiAodG9uaWNEaXZzICYmIHRvbmljRGl2cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkRGl2cygpXHJcbiAgICAgICAgY29uc29sZS5sb2coJyVjIFRvbmljUG93IHdpZGdldChzKSBsb2FkZWQhICcsICdiYWNrZ3JvdW5kOiAjOTc0Q0QyOyBjb2xvcjogI2ZmZicpXHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICB0aHJvdyBlXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBQcm9jZXNzIHZpc2l0b3IgdG9rZW5cclxuICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLmNhcHR1cmVWaXNpdG9yU2Vzc2lvbigpXHJcblxyXG4gICAgLy8gQ2FwdHVyZSBldmVudHMgaWYgd2UgaGF2ZSBhIHNlc3Npb25cclxuICAgIGlmIChzZXNzaW9uKSB7XHJcbiAgICAgIHRoaXMuZXZlbnRzID0gbmV3IEV2ZW50cyhzZXNzaW9uLCB0aGlzLmNvbmZpZylcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIEF1dG8tbG9hZCBhbmQgc2V0IG9uIHdpbmRvd1xyXG52YXIgdHBvdyA9IG5ldyBUb25pY1BvdygpXHJcblxyXG47KHdpbmRvdyBhcyBhbnkpLlRvbmljUG93ID0gdHBvdyB8fCB7fVxyXG4iLCIvKiBnbG9iYWwgbG9jYWxTdG9yYWdlICovXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdG9yYWdlIHtcclxuICAvKlxyXG4gIHJlbW92ZVN0b3JhZ2U6IHJlbW92ZXMgYSBrZXkgZnJvbSBsb2NhbFN0b3JhZ2UgYW5kIGl0cyBzaWJsaW5nIGV4cGlyYWN5IGtleVxyXG4gIHBhcmFtczpcclxuICAgICAga2V5IDxzdHJpbmc+IDogbG9jYWxTdG9yYWdlIGtleSB0byByZW1vdmVcclxuICByZXR1cm5zOlxyXG4gICAgICA8Ym9vbGVhbj4gOiB0ZWxsaW5nIGlmIG9wZXJhdGlvbiBzdWNjZWVkZWRcclxuICAqL1xyXG4gIHJlbW92ZVN0b3JhZ2UgPSAobmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShuYW1lKVxyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgJHtuYW1lfV9leHBpcmVzSW5gKVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBgcmVtb3ZlU3RvcmFnZTogRXJyb3IgcmVtb3Zpbmcga2V5IFske25hbWV9XSBmcm9tIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gXHJcbiAgICAgIClcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZVxyXG4gIH1cclxuXHJcbiAgLypcclxuICBnZXRTdG9yYWdlOiByZXRyaWV2ZXMgYSBrZXkgZnJvbSBsb2NhbFN0b3JhZ2UgcHJldmlvdXNseSBzZXQgd2l0aCBzZXRTdG9yYWdlKCkuXHJcbiAgcGFyYW1zOlxyXG4gICAgICBrZXkgPHN0cmluZz4gOiBsb2NhbFN0b3JhZ2Uga2V5XHJcbiAgcmV0dXJuczpcclxuICAgICAgPHN0cmluZz4gOiB2YWx1ZSBvZiBsb2NhbFN0b3JhZ2Uga2V5XHJcbiAgICAgIG51bGwgOiBpbiBjYXNlIG9mIGV4cGlyZWQga2V5IG9yIGZhaWx1cmVcclxuICAqL1xyXG4gIGdldFN0b3JhZ2UgPSAoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgIC8vIGVwb2NoIHRpbWUsIGxldHMgZGVhbCBvbmx5IHdpdGggaW50ZWdlclxyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxyXG5cclxuICAgIC8vIFNldCBleHBpcmF0aW9uIGZvciBzdG9yYWdlXHJcbiAgICBsZXQgZXhwaXJlc1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGV4cGlyZXMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgJHtrZXl9X2V4cGlyZXNgKVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgZ2V0SXRlbTogZXJyb3IgZ2V0dGluZyBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YClcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZXhwaXJlcyA9PT0gdW5kZWZpbmVkIHx8IGV4cGlyZXMgPT09IG51bGwpIHtcclxuICAgICAgZXhwaXJlcyA9IDBcclxuICAgIH1cclxuXHJcbiAgICAvLyBFeHBpcmVkXHJcbiAgICBpZiAoZXhwaXJlcyA8IG5vdykge1xyXG4gICAgICB0aGlzLnJlbW92ZVN0b3JhZ2Uoa2V5KVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCB0aGUgZXhpc3RpbmcgaXRlbVxyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSlcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYGdldFN0b3JhZ2U6IEVycm9yIHJlYWRpbmcga2V5IFske2tleX1dIGZyb20gbG9jYWxTdG9yYWdlOiAke0pTT04uc3RyaW5naWZ5KGUpfWApXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gIHNldFN0b3JhZ2U6IHdyaXRlcyBhIGtleSBpbnRvIGxvY2FsU3RvcmFnZSBzZXR0aW5nIGEgZXhwaXJlIHRpbWVcclxuICBwYXJhbXM6XHJcbiAgICAgIGtleSA8c3RyaW5nPiAgICAgOiBsb2NhbFN0b3JhZ2Uga2V5XHJcbiAgICAgIHZhbHVlIDxzdHJpbmc+ICAgOiBsb2NhbFN0b3JhZ2UgdmFsdWVcclxuICAgICAgZXhwaXJlcyA8bnVtYmVyPiA6IG51bWJlciBvZiBzZWNvbmRzIGZyb20gbm93IHRvIGV4cGlyZSB0aGUga2V5XHJcbiAgcmV0dXJuczpcclxuICAgICAgPGJvb2xlYW4+IDogdGVsbGluZyBpZiBvcGVyYXRpb24gc3VjY2VlZGVkXHJcbiAgKi9cclxuICBzZXRTdG9yYWdlID0gKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBleHBpcmVzOiBudW1iZXIgfCBudWxsID0gbnVsbCkgPT4ge1xyXG4gICAgLy8gRXhwaXJlZCB0aW1lXHJcbiAgICBpZiAoZXhwaXJlcykge1xyXG4gICAgICBleHBpcmVzID0gTWF0aC5hYnMoZXhwaXJlcykgLy8gbWFrZSBzdXJlIGl0J3MgcG9zaXRpdmVcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGV4cGlyZXMgPSAyNCAqIDYwICogNjAgLy8gZGVmYXVsdDogc2Vjb25kcyBmb3IgMSBkYXlcclxuICAgIH1cclxuXHJcbiAgICAvLyBNaWxsaSBzZWNvbmRzIHNpbmNlIGVwb2NoIHRpbWUsIGxldHMgZGVhbCBvbmx5IHdpdGggaW50ZWdlclxyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxyXG4gICAgY29uc3Qgc2NoZWR1bGUgPSBub3cgKyBleHBpcmVzICogMTAwMFxyXG4gICAgdHJ5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSlcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7a2V5fV9leHBpcmVzYCwgc2NoZWR1bGUudG9TdHJpbmcoKSlcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYHNldFN0b3JhZ2U6IEVycm9yIHNldHRpbmcga2V5IFske2tleX1dIGluIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gKVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlXHJcbiAgfVxyXG59XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYwNyk7XG4iXSwic291cmNlUm9vdCI6IiJ9