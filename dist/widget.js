(()=>{"use strict";const e="production",t="staging",o="local",n={apiUrl:"https://api.tonicpow.com",apiUrlLocal:"http://localhost:3000",apiUrlStaging:"https://api.staging.tonicpow.com",apiUrlProduction:"https://api.tonicpow.com",customEnvironment:"data-environment",environment:e,environmentLocal:o,environmentProduction:e,environments:[e,t,o],environmentStaging:t,maxSessionDays:60,sessionName:"tncpw_session",version:"v0.0.1",widgetDivClass:"tonicpow-widget",widgetId:"data-widget-id",isEnvironmentValid:e=>n.environments.indexOf(e)>=0,setEnvironment:e=>{e&&n.isEnvironmentValid(e)&&(n.environment=e,e===n.environmentStaging?n.apiUrl=n.apiUrlStaging:e===n.environmentLocal?n.apiUrl=n.apiUrlLocal:e===n.environmentProduction&&(n.apiUrl=n.apiUrlProduction))}},i=n,r={removeStorage:e=>{try{localStorage.removeItem(e),localStorage.removeItem(e+"_expiresIn")}catch(t){return console.log("removeStorage: Error removing key ["+e+"] from localStorage: "+JSON.stringify(t)),!1}return!0},getStorage:e=>{let t=Date.now(),o=localStorage.getItem(e+"_expires");if(null==o&&(o=0),o<t)return r.removeStorage(e),null;try{return localStorage.getItem(e)}catch(t){return console.log("getStorage: Error reading key ["+e+"] from localStorage: "+JSON.stringify(t)),null}},setStorage:(e,t,o=null)=>{o=o?Math.abs(o):86400;let n=Date.now()+1e3*o;try{localStorage.setItem(e,t),localStorage.setItem(e+"_expires",n.toString())}catch(t){return console.log("setStorage: Error setting key ["+e+"] in localStorage: "+JSON.stringify(t)),!1}return!0}},a=r;let s={};s.Config=i,s.Storage=a,s.setOreo=(e,t,o)=>{let n=new Date;n.setTime(n.getTime()+864e5*o),document.cookie=e+"="+t+";path=/;expires="+n.toGMTString()},s.captureVisitorSession=(e="")=>{let t=e;e&&0!==e.length||"undefined"==typeof window||(t=new URLSearchParams(window.location.search).get(i.sessionName)),t&&t.length>0&&(s.setOreo(i.sessionName,t,i.maxSessionDays),s.Storage.setStorage(i.sessionName,t,86400*i.maxSessionDays))},s.getVisitorSession=()=>s.Storage.getStorage(i.sessionName),s.loadDivs=async()=>{let e=document.getElementsByClassName(i.widgetDivClass);for(let t=e.length-1;t>=0;t--){let o=e[t],n=o.getAttribute(i.widgetId);if(!n){console.log(n+" not found");continue}let r=o.getAttribute(i.customEnvironment);i.setEnvironment(r);let a=await fetch(i.apiUrl+"/v1/widgets/display/"+n+"?provider=embed-"+i.version),s=await a.json(),l=encodeURIComponent(s.title);o.innerHTML=`\n    <a href="${s.link_url}?utm_source=tonicpow-widgets&utm_medium=widget&utm_campaign=${n}&utm_content=${l}">\n      <img src="${s.image_url}" \n      width="${s.width}" \n      height="${s.height}" \n      alt="${s.title}" />\n    </a>`,o.setAttribute("data-width",s.width),o.setAttribute("data-height",s.height)}},s.load=()=>{if("undefined"==typeof window)return void console.error("TonicPow embed only works in the browser");let e=document.getElementsByClassName(i.widgetDivClass);e&&e.length>0&&s.loadDivs().then((e=>{console.log("TonicPow widget(s) loaded!")})),s.captureVisitorSession()},"complete"===document.readyState||"interactive"===document.readyState?s.load():document.addEventListener("DOMContentLoaded",(function(){s.load()})),"undefined"!=typeof window&&(window.TonicPow=s)})();