(()=>{var t={913:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.isEnvironmentValid=t=>this.environments.includes(t),this.setEnvironment=t=>{t&&this.isEnvironmentValid(t)&&(this.environment=t,t===this.environmentStaging?(this.apiUrl=this.apiUrlStaging,this.eventsUrl=this.eventsUrlStaging):t===this.environmentLocal?(this.apiUrl=this.apiUrlLocal,this.eventsUrl=this.eventsUrlLocal):t===this.environmentProduction&&(this.apiUrl=this.apiUrlProduction,this.eventsUrl=this.eventsUrlProduction))},this.environmentLocal="local",this.environmentStaging="staging",this.environmentProduction="production",this.apiUrl="https://api.tonicpow.com",this.apiUrlLocal="http://localhost:3000",this.apiUrlStaging="https://api.staging.tonicpow.com",this.apiUrlProduction="https://api.tonicpow.com",this.eventsUrl="https://events.tonicpow.com",this.eventsUrlLocal="http://localhost:3002",this.eventsUrlStaging="https://events.staging.tonicpow.com",this.eventsUrlProduction="https://events.tonicpow.com",this.customEnvironment="data-environment",this.environment="",this.environments=[this.environmentLocal,this.environmentStaging,this.environmentProduction],this.maxSessionDays=60,this.sessionName="tncpw_session",this.version="v0.0.8",this.widgetDivClass="tonicpow-widget",this.widgetId="data-widget-id"}}}.apply(e,[i,e]))||(t.exports=n)},242:function(t,e,i){var n,o,s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(913)],void 0===(o=function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=s(i),e.default=class{constructor(t){this.detectBounce=()=>{window.onbeforeunload=()=>{this.sendEvent("bounce",((new Date).getTime()-this.start).toString())}},this.detectInteraction=()=>{let t=!1;document.addEventListener("mousedown",(async()=>{if(!t)try{await this.sendEvent("interaction","mousedown"),t=!0}catch(t){console.error("failed to report interaction: mousedown",t)}})),document.addEventListener("scroll",(async()=>{if(!t)try{await this.sendEvent("interaction","scroll"),t=!0}catch(t){console.error("failed to report interaction: scroll",t)}})),document.addEventListener("keypress",(async()=>{if(!t)try{await this.sendEvent("interaction","keypress"),t=!0}catch(t){console.error("failed to report interaction: keypress",t)}})),document.addEventListener("click",(async()=>{if(!t)try{await this.sendEvent("interaction","click"),t=!0}catch(t){console.error("failed to report interaction: click",t)}}))},this.sendEvent=async(t,e)=>{if(!this.sessionId)return void console.info("you must call init with a session before sending events");let n=new i.default;await fetch(`${n.eventsUrl}/v1/events?v=${n.version}&name=${t}&tncpw_session=${this.sessionId}&data=${e}`,{method:"get"})},this.sessionId=t,this.start=(new Date).getTime(),this.detectInteraction(),this.detectBounce()}}}.apply(e,n))||(t.exports=o)},607:function(t,e,i){var n,o,s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(913),i(242),i(912)],void 0===(o=function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=s(i),n=s(n),o=s(o);const r={AutoInit:!0};class a{constructor(t=r){this.registerEvents=()=>{let t=this.getVisitorSession();t&&(console.log("registering session",t),this.events=new n.default(t))},this.setOreo=(t,e,i)=>{const n=new Date;n.setTime(n.getTime()+864e5*i),document.cookie=`${t}=${e};path=/;expires=${n.toUTCString()}`},this.captureVisitorSession=(t="")=>{let e=t;return t&&t.length||"undefined"==typeof window||(e=new URLSearchParams(window.location.search).get(this.config.sessionName)||""),e&&e.length>0?(this.setOreo(this.config.sessionName,e,this.config.maxSessionDays),this.storage.setStorage(this.config.sessionName,e,86400*this.config.maxSessionDays),e):null},this.getVisitorSession=()=>this.storage.getStorage(this.config.sessionName),this.loadDivs=async()=>{const t=document.getElementsByClassName(this.config.widgetDivClass);for(let e=t.length-1;e>=0;e--){const i=t[e],n=i.getAttribute(this.config.widgetId);if(!n){console.log(`${n} not found`);continue}const o=i.getAttribute(this.config.customEnvironment);this.config.setEnvironment(o||"production");const s=await fetch(`${this.config.apiUrl}/v1/widgets/display/${n}?provider=embed-${this.config.version}`),r=await s.json(),a=encodeURIComponent(r.title);i.innerHTML=`\n    <a href="${r.link_url}?utm_source=tonicpow-widgets&utm_medium=widget&utm_campaign=${n}&utm_content=${a}">\n      <img src="${r.image_url}" \n      width="${r.width}" \n      height="${r.height}" \n      alt="${r.title}" />\n    </a>`,i.setAttribute("data-width",r.width),i.setAttribute("data-height",r.height)}},this.load=()=>{if("undefined"==typeof window)return void console.error("TonicPow embed only works in the browser");const t=document.getElementsByClassName(this.config.widgetDivClass);t&&t.length>0&&this.loadDivs().then((()=>{console.log("TonicPow widget(s) loaded!")}));const e=this.captureVisitorSession();e&&(this.events=new n.default(e))};for(let[e,i]of Object.entries(t))Object.defineProperty(this,e,{value:i,writable:!1});this.config=new i.default,this.storage=new o.default,t.AutoInit&&("complete"===document.readyState||"interactive"===document.readyState?(this.load(),this.registerEvents()):document.addEventListener("DOMContentLoaded",(()=>{this.load(),this.registerEvents()})))}}e.default=a,window.TonicPow=a||{}}.apply(e,n))||(t.exports=o)},912:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.removeStorage=t=>{try{localStorage.removeItem(t),localStorage.removeItem(`${t}_expiresIn`)}catch(e){return console.log(`removeStorage: Error removing key [${t}] from localStorage: ${JSON.stringify(e)}`),!1}return!0},this.getStorage=t=>{const e=Date.now();let i;try{i=localStorage.getItem(`${t}_expires`)}catch(t){return console.log(`getItem: error getting localStorage: ${JSON.stringify(t)}`),null}if(null==i&&(i=0),i<e)return this.removeStorage(t),null;try{return localStorage.getItem(t)}catch(e){return console.log(`getStorage: Error reading key [${t}] from localStorage: ${JSON.stringify(e)}`),null}},this.setStorage=(t,e,i=null)=>{i=i?Math.abs(i):86400;const n=Date.now()+1e3*i;try{localStorage.setItem(t,e),localStorage.setItem(`${t}_expires`,n.toString())}catch(e){return console.log(`setStorage: Error setting key [${t}] in localStorage: ${JSON.stringify(e)}`),!1}return!0}}}}.apply(e,[i,e]))||(t.exports=n)}},e={};!function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2NvbmZpZy50cyIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2V2ZW50cy50cyIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvc3RvcmFnZS50cyIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbImlzRW52aXJvbm1lbnRWYWxpZCIsImVudmlyb25tZW50IiwidGhpcyIsImVudmlyb25tZW50cyIsImluY2x1ZGVzIiwic2V0RW52aXJvbm1lbnQiLCJlbnZpcm9ubWVudFN0YWdpbmciLCJhcGlVcmwiLCJhcGlVcmxTdGFnaW5nIiwiZXZlbnRzVXJsIiwiZXZlbnRzVXJsU3RhZ2luZyIsImVudmlyb25tZW50TG9jYWwiLCJhcGlVcmxMb2NhbCIsImV2ZW50c1VybExvY2FsIiwiZW52aXJvbm1lbnRQcm9kdWN0aW9uIiwiYXBpVXJsUHJvZHVjdGlvbiIsImV2ZW50c1VybFByb2R1Y3Rpb24iLCJjdXN0b21FbnZpcm9ubWVudCIsIm1heFNlc3Npb25EYXlzIiwic2Vzc2lvbk5hbWUiLCJ2ZXJzaW9uIiwid2lkZ2V0RGl2Q2xhc3MiLCJ3aWRnZXRJZCIsInNlc3Npb25JZCIsImRldGVjdEJvdW5jZSIsIndpbmRvdyIsIm9uYmVmb3JldW5sb2FkIiwic2VuZEV2ZW50IiwiRGF0ZSIsImdldFRpbWUiLCJzdGFydCIsInRvU3RyaW5nIiwiZGV0ZWN0SW50ZXJhY3Rpb24iLCJpbnRlcmFjdGlvblNlbnQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhc3luYyIsImUiLCJjb25zb2xlIiwiZXJyb3IiLCJldmVudE5hbWUiLCJkYXRhIiwiaW5mbyIsImNvbmZpZyIsImZldGNoIiwibWV0aG9kIiwiZGVmYXVsdE9wdGlvbnMiLCJBdXRvSW5pdCIsIlRvbmljUG93Iiwib3B0aW9ucyIsInJlZ2lzdGVyRXZlbnRzIiwic2Vzc2lvbiIsImdldFZpc2l0b3JTZXNzaW9uIiwibG9nIiwiZXZlbnRzIiwic2V0T3JlbyIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkYXRlIiwic2V0VGltZSIsImNvb2tpZSIsInRvVVRDU3RyaW5nIiwiY2FwdHVyZVZpc2l0b3JTZXNzaW9uIiwiY3VzdG9tU2Vzc2lvbklkIiwibGVuZ3RoIiwiVVJMU2VhcmNoUGFyYW1zIiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJzdG9yYWdlIiwic2V0U3RvcmFnZSIsImdldFN0b3JhZ2UiLCJsb2FkRGl2cyIsInRvbmljRGl2cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJpIiwidG9uaWNEaXYiLCJnZXRBdHRyaWJ1dGUiLCJwcm9taXNlIiwicmVzcG9uc2UiLCJqc29uIiwiY2FtcGFpZ25UaXRsZSIsImVuY29kZVVSSUNvbXBvbmVudCIsInRpdGxlIiwiaW5uZXJIVE1MIiwibGlua191cmwiLCJpbWFnZV91cmwiLCJ3aWR0aCIsImhlaWdodCIsInNldEF0dHJpYnV0ZSIsImxvYWQiLCJ0aGVuIiwib3B0aW9uS2V5Iiwib3B0aW9uVmFsIiwiT2JqZWN0IiwiZW50cmllcyIsImRlZmluZVByb3BlcnR5Iiwid3JpdGFibGUiLCJyZWFkeVN0YXRlIiwicmVtb3ZlU3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJKU09OIiwic3RyaW5naWZ5Iiwia2V5Iiwibm93IiwiZXhwaXJlcyIsImdldEl0ZW0iLCJNYXRoIiwiYWJzIiwic2NoZWR1bGUiLCJzZXRJdGVtIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIl0sIm1hcHBpbmdz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LFFDakJXRixDQUFvQixNIiwiZmlsZSI6InRvbmljcG93LmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uZmlnIHtcclxuICBlbnZpcm9ubWVudExvY2FsOiBzdHJpbmdcclxuICBlbnZpcm9ubWVudFN0YWdpbmc6IHN0cmluZ1xyXG4gIGVudmlyb25tZW50UHJvZHVjdGlvbjogc3RyaW5nXHJcbiAgYXBpVXJsOiBzdHJpbmdcclxuICBhcGlVcmxMb2NhbDogc3RyaW5nXHJcbiAgYXBpVXJsU3RhZ2luZzogc3RyaW5nXHJcbiAgYXBpVXJsUHJvZHVjdGlvbjogc3RyaW5nXHJcbiAgZXZlbnRzVXJsOiBzdHJpbmdcclxuICBldmVudHNVcmxMb2NhbDogc3RyaW5nXHJcbiAgZXZlbnRzVXJsU3RhZ2luZzogc3RyaW5nXHJcbiAgZXZlbnRzVXJsUHJvZHVjdGlvbjogc3RyaW5nXHJcbiAgY3VzdG9tRW52aXJvbm1lbnQ6IHN0cmluZ1xyXG4gIGVudmlyb25tZW50OiBzdHJpbmdcclxuICBlbnZpcm9ubWVudHM6IHN0cmluZ1tdXHJcbiAgbWF4U2Vzc2lvbkRheXM6IG51bWJlclxyXG4gIHNlc3Npb25OYW1lOiBzdHJpbmdcclxuICB2ZXJzaW9uOiBzdHJpbmdcclxuICB3aWRnZXREaXZDbGFzczogc3RyaW5nXHJcbiAgd2lkZ2V0SWQ6IHN0cmluZ1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZW52aXJvbm1lbnRMb2NhbCA9ICdsb2NhbCdcclxuICAgIHRoaXMuZW52aXJvbm1lbnRTdGFnaW5nID0gJ3N0YWdpbmcnXHJcbiAgICB0aGlzLmVudmlyb25tZW50UHJvZHVjdGlvbiA9ICdwcm9kdWN0aW9uJ1xyXG5cclxuICAgIHRoaXMuYXBpVXJsID0gJ2h0dHBzOi8vYXBpLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuYXBpVXJsTG9jYWwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ1xyXG4gICAgdGhpcy5hcGlVcmxTdGFnaW5nID0gJ2h0dHBzOi8vYXBpLnN0YWdpbmcudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5hcGlVcmxQcm9kdWN0aW9uID0gJ2h0dHBzOi8vYXBpLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuZXZlbnRzVXJsID0gJ2h0dHBzOi8vZXZlbnRzLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuZXZlbnRzVXJsTG9jYWwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAyJ1xyXG4gICAgdGhpcy5ldmVudHNVcmxTdGFnaW5nID0gJ2h0dHBzOi8vZXZlbnRzLnN0YWdpbmcudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5ldmVudHNVcmxQcm9kdWN0aW9uID0gJ2h0dHBzOi8vZXZlbnRzLnRvbmljcG93LmNvbSdcclxuICAgIHRoaXMuY3VzdG9tRW52aXJvbm1lbnQgPSAnZGF0YS1lbnZpcm9ubWVudCdcclxuICAgIHRoaXMuZW52aXJvbm1lbnQgPSAnJ1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudHMgPSBbdGhpcy5lbnZpcm9ubWVudExvY2FsLCB0aGlzLmVudmlyb25tZW50U3RhZ2luZywgdGhpcy5lbnZpcm9ubWVudFByb2R1Y3Rpb25dXHJcbiAgICB0aGlzLm1heFNlc3Npb25EYXlzID0gNjBcclxuICAgIHRoaXMuc2Vzc2lvbk5hbWUgPSAndG5jcHdfc2Vzc2lvbidcclxuICAgIHRoaXMudmVyc2lvbiA9ICd2MC4wLjgnXHJcbiAgICB0aGlzLndpZGdldERpdkNsYXNzID0gJ3RvbmljcG93LXdpZGdldCdcclxuICAgIHRoaXMud2lkZ2V0SWQgPSAnZGF0YS13aWRnZXQtaWQnXHJcbiAgfVxyXG5cclxuICAvLyBpc0Vudmlyb25tZW50VmFsaWQgd2lsbCBjaGVjayBpZiB0aGUgZ2l2ZW4gZW52aXJvbm1lbnQgaXMgdmFsaWRcclxuICBpc0Vudmlyb25tZW50VmFsaWQgPSAoZW52aXJvbm1lbnQ6IHN0cmluZykgPT4gdGhpcy5lbnZpcm9ubWVudHMuaW5jbHVkZXMoZW52aXJvbm1lbnQpXHJcblxyXG4gIC8vIHNldEVudmlyb25tZW50IHdpbGwgc2V0IHRoZSBlbnZpcm9ubWVudFxyXG4gIHNldEVudmlyb25tZW50ID0gKGVudmlyb25tZW50OiBzdHJpbmcpID0+IHtcclxuICAgIC8vIE5vIGVudmlyb25tZW50IHNldD8gdXNlIHRoZSBkZWZhdWx0XHJcbiAgICBpZiAoIWVudmlyb25tZW50KSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIE5vdCBhIHZhbGlkIGVudmlyb25tZW50P1xyXG4gICAgaWYgKCF0aGlzLmlzRW52aXJvbm1lbnRWYWxpZChlbnZpcm9ubWVudCkpIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IHRoZSBlbnZpcm9ubWVudFxyXG4gICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50XHJcblxyXG4gICAgLy8gU2V0IHRoZSBBUEkgdXJsXHJcbiAgICBpZiAoZW52aXJvbm1lbnQgPT09IHRoaXMuZW52aXJvbm1lbnRTdGFnaW5nKSB7XHJcbiAgICAgIHRoaXMuYXBpVXJsID0gdGhpcy5hcGlVcmxTdGFnaW5nXHJcbiAgICAgIHRoaXMuZXZlbnRzVXJsID0gdGhpcy5ldmVudHNVcmxTdGFnaW5nXHJcbiAgICB9IGVsc2UgaWYgKGVudmlyb25tZW50ID09PSB0aGlzLmVudmlyb25tZW50TG9jYWwpIHtcclxuICAgICAgdGhpcy5hcGlVcmwgPSB0aGlzLmFwaVVybExvY2FsXHJcbiAgICAgIHRoaXMuZXZlbnRzVXJsID0gdGhpcy5ldmVudHNVcmxMb2NhbFxyXG4gICAgfSBlbHNlIGlmIChlbnZpcm9ubWVudCA9PT0gdGhpcy5lbnZpcm9ubWVudFByb2R1Y3Rpb24pIHtcclxuICAgICAgdGhpcy5hcGlVcmwgPSB0aGlzLmFwaVVybFByb2R1Y3Rpb25cclxuICAgICAgdGhpcy5ldmVudHNVcmwgPSB0aGlzLmV2ZW50c1VybFByb2R1Y3Rpb25cclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZydcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50cyB7XHJcbiAgc2Vzc2lvbklkOiBzdHJpbmdcclxuICBzdGFydDogbnVtYmVyXHJcblxyXG4gIGNvbnN0cnVjdG9yKHNlc3Npb25JZDogc3RyaW5nKSB7XHJcbiAgICAvLyBTZXQgdGhlIGN1cnJlbnQgc2Vzc2lvblxyXG4gICAgdGhpcy5zZXNzaW9uSWQgPSBzZXNzaW9uSWRcclxuXHJcbiAgICAvLyBSZW1lbWJlciB3aGVuIHdlIHN0YXJ0ZWRcclxuICAgIHRoaXMuc3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG4gICAgdGhpcy5kZXRlY3RJbnRlcmFjdGlvbigpXHJcbiAgICB0aGlzLmRldGVjdEJvdW5jZSgpXHJcbiAgfVxyXG5cclxuICAvLyBEZXRlY3RzIGEgYm91bmNlIGV2ZW50XHJcbiAgZGV0ZWN0Qm91bmNlID0gKCkgPT4ge1xyXG4gICAgd2luZG93Lm9uYmVmb3JldW5sb2FkID0gKCkgPT4ge1xyXG4gICAgICAvLyBDYWxjdWxhdGUgdGltZSBvbiBwYWdlXHJcbiAgICAgIHRoaXMuc2VuZEV2ZW50KCdib3VuY2UnLCAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0KS50b1N0cmluZygpKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRGV0ZWN0cyBhIHBhZ2UgaW50ZXJhY3Rpb25cclxuICBkZXRlY3RJbnRlcmFjdGlvbiA9ICgpID0+IHtcclxuICAgIGxldCBpbnRlcmFjdGlvblNlbnQgPSBmYWxzZVxyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFpbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ21vdXNlZG93bicpXHJcbiAgICAgICAgICBpbnRlcmFjdGlvblNlbnQgPSB0cnVlXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjogbW91c2Vkb3duJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIWludGVyYWN0aW9uU2VudCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRFdmVudCgnaW50ZXJhY3Rpb24nLCAnc2Nyb2xsJylcclxuICAgICAgICAgIGludGVyYWN0aW9uU2VudCA9IHRydWVcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBzY3JvbGwnLCBlKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFpbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ2tleXByZXNzJylcclxuICAgICAgICAgIGludGVyYWN0aW9uU2VudCA9IHRydWVcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdmYWlsZWQgdG8gcmVwb3J0IGludGVyYWN0aW9uOiBrZXlwcmVzcycsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIWludGVyYWN0aW9uU2VudCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRFdmVudCgnaW50ZXJhY3Rpb24nLCAnY2xpY2snKVxyXG4gICAgICAgICAgaW50ZXJhY3Rpb25TZW50ID0gdHJ1ZVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZhaWxlZCB0byByZXBvcnQgaW50ZXJhY3Rpb246IGNsaWNrJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBTZW5kIGV2ZW50IHdpbGwgc2VuZCBhbiBldmVudCB0byBUb25pY1Bvd1xyXG4gIHNlbmRFdmVudCA9IGFzeW5jIChldmVudE5hbWU6IHN0cmluZywgZGF0YTogc3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoIXRoaXMuc2Vzc2lvbklkKSB7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygneW91IG11c3QgY2FsbCBpbml0IHdpdGggYSBzZXNzaW9uIGJlZm9yZSBzZW5kaW5nIGV2ZW50cycpXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjb25maWdcclxuICAgIGxldCBjb25maWcgPSBuZXcgQ29uZmlnKClcclxuXHJcbiAgICAvLyB0b2RvOiBvYmZ1c2NhdGUgdGhlIHVybCBwYXJhbXMgKGNoYW5nZSB0byBwYXlsb2FkIG9mIEpTT04/KVxyXG4gICAgYXdhaXQgZmV0Y2goXHJcbiAgICAgIGAke2NvbmZpZy5ldmVudHNVcmx9L3YxL2V2ZW50cz92PSR7Y29uZmlnLnZlcnNpb259Jm5hbWU9JHtldmVudE5hbWV9JnRuY3B3X3Nlc3Npb249JHt0aGlzLnNlc3Npb25JZH0mZGF0YT0ke2RhdGF9YCxcclxuICAgICAgeyBtZXRob2Q6ICdnZXQnIH1cclxuICAgIClcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZydcclxuaW1wb3J0IEV2ZW50cyBmcm9tICcuL2V2ZW50cydcclxuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi9zdG9yYWdlJ1xyXG5cclxuaW50ZXJmYWNlIFRvbmljUG93T3B0aW9ucyB7XHJcbiAgQXV0b0luaXQ6IGJvb2xlYW4gLy8gTWFudWFsbHkgaW5pdGlhbGl6ZSBpbnN0ZWFkIG9mIGF1dG8tZGV0ZWN0aW5nIGRpdnNcclxufVxyXG5cclxuLy8gRGV0YXVsdCBvcHRpb25zXHJcbmNvbnN0IGRlZmF1bHRPcHRpb25zOiBUb25pY1Bvd09wdGlvbnMgPSB7XHJcbiAgQXV0b0luaXQ6IHRydWUsXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvbmljUG93IHtcclxuICBjb25maWc6IENvbmZpZ1xyXG4gIHN0b3JhZ2U6IFN0b3JhZ2VcclxuICBldmVudHM6IEV2ZW50cyB8IHVuZGVmaW5lZFxyXG5cclxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBUb25pY1Bvd09wdGlvbnMgPSBkZWZhdWx0T3B0aW9ucykge1xyXG4gICAgLy8gSW1idWUgb3B0aW9uc1xyXG4gICAgZm9yIChsZXQgW29wdGlvbktleSwgb3B0aW9uVmFsXSBvZiBPYmplY3QuZW50cmllcyhvcHRpb25zKSkge1xyXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgb3B0aW9uS2V5LCB7XHJcbiAgICAgICAgdmFsdWU6IG9wdGlvblZhbCxcclxuICAgICAgICB3cml0YWJsZTogZmFsc2UsXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IG5hbWVzcGFjZXNcclxuICAgIHRoaXMuY29uZmlnID0gbmV3IENvbmZpZygpXHJcbiAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgU3RvcmFnZSgpXHJcblxyXG4gICAgLy8gU3RhcnQgdGhlIFRvbmljUG93IHNlcnZpY2UgYW5kIGxvYWQgbW9kdWxlc1xyXG4gICAgaWYgKG9wdGlvbnMuQXV0b0luaXQpIHtcclxuICAgICAgLy8gTG9hZCB0aGUgVG9uaWNQb3cgd2lkZ2V0XHJcbiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdpbnRlcmFjdGl2ZScpIHtcclxuICAgICAgICAvLyBUaGlzIGxvYWRzIGlmIHRoZSA8c2NyaXB0PiBpcyBkeW5hbWljYWxseSBpbmplY3RlZCBpbnRvIHRoZSBwYWdlXHJcbiAgICAgICAgdGhpcy5sb2FkKClcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRzKClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBUaGlzIGxvYWRzIGlmIHRoZSA8c2NyaXB0PiBpcyBoYXJkY29kZWQgaW4gdGhlIGh0bWwgcGFnZSBpbiB0aGUgPGhlYWQ+XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZCgpXHJcbiAgICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRzKClcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyByZWdpc3RlckV2ZW50c1xyXG4gIHJlZ2lzdGVyRXZlbnRzID0gKCkgPT4ge1xyXG4gICAgLy8gUmVnaXN0ZXIgZXZlbnRzIGlmIHdlIGhhdmUgYSB2YWxpZCBzZXNzaW9uXHJcbiAgICBsZXQgc2Vzc2lvbiA9IHRoaXMuZ2V0VmlzaXRvclNlc3Npb24oKVxyXG4gICAgaWYgKHNlc3Npb24pIHtcclxuICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdGVyaW5nIHNlc3Npb24nLCBzZXNzaW9uKVxyXG4gICAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudHMoc2Vzc2lvbilcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIHNldE9yZW8gZm9yIGNyZWF0aW5nIG5ldyBvcmVvc1xyXG4gIHNldE9yZW8gPSAobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBkYXlzOiBudW1iZXIpID0+IHtcclxuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpXHJcbiAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAyNCAqIDYwICogNjAgKiAxMDAwICogZGF5cylcclxuICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke25hbWV9PSR7dmFsdWV9O3BhdGg9LztleHBpcmVzPSR7ZGF0ZS50b1VUQ1N0cmluZygpfWBcclxuICB9XHJcblxyXG4gIC8vIGNhcHR1cmVWaXNpdG9yU2Vzc2lvbiB3aWxsIGNhcHR1cmUgdGhlIHNlc3Npb24gYW5kIHN0b3JlIGl0XHJcbiAgLy8gQnVpbGRzIGEgY29va2llIHNvIGl0J3Mgc2VudCBvbiByZXF1ZXN0cyBhdXRvbWF0aWNhbGx5XHJcbiAgLy8gU3RvcmVzIGluIGxvY2FsIHN0b3JhZ2UgZm9yIGVhc3kgYWNjZXNzIGZyb20gdGhlIGFwcGxpY2F0aW9uXHJcbiAgY2FwdHVyZVZpc2l0b3JTZXNzaW9uID0gKGN1c3RvbVNlc3Npb25JZDogc3RyaW5nID0gJycpID0+IHtcclxuICAgIGxldCBzZXNzaW9uSWQgPSBjdXN0b21TZXNzaW9uSWRcclxuXHJcbiAgICBpZiAoKCFjdXN0b21TZXNzaW9uSWQgfHwgIWN1c3RvbVNlc3Npb25JZC5sZW5ndGgpICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaClcclxuICAgICAgc2Vzc2lvbklkID0gdXJsUGFyYW1zLmdldCh0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSkgfHwgJydcclxuICAgIH1cclxuICAgIGlmIChzZXNzaW9uSWQgJiYgc2Vzc2lvbklkLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5zZXRPcmVvKHRoaXMuY29uZmlnLnNlc3Npb25OYW1lLCBzZXNzaW9uSWQsIHRoaXMuY29uZmlnLm1heFNlc3Npb25EYXlzKVxyXG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0U3RvcmFnZShcclxuICAgICAgICB0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSxcclxuICAgICAgICBzZXNzaW9uSWQsXHJcbiAgICAgICAgMjQgKiA2MCAqIDYwICogdGhpcy5jb25maWcubWF4U2Vzc2lvbkRheXNcclxuICAgICAgKVxyXG4gICAgICByZXR1cm4gc2Vzc2lvbklkXHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuXHJcbiAgLy8gZ2V0VmlzaXRvclNlc3Npb24gd2lsbCBnZXQgdGhlIHNlc3Npb24gaWYgaXQgZXhpc3RzXHJcbiAgZ2V0VmlzaXRvclNlc3Npb24gPSAoKSA9PiB0aGlzLnN0b3JhZ2UuZ2V0U3RvcmFnZSh0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSlcclxuXHJcbiAgLy8gbG9hZERpdnMgcmVwbGFjZXMgZWFjaCBUb25pY1BvdyBkaXYgd2l0aCBhIGNvcnJlc3BvbmRpbmcgZW1iZWQgd2lkZ2V0XHJcbiAgbG9hZERpdnMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBHZXQgYWxsIGRpdnNcclxuICAgIGNvbnN0IHRvbmljRGl2cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGhpcy5jb25maWcud2lkZ2V0RGl2Q2xhc3MpXHJcblxyXG4gICAgLy8gTG9vcCBhbGwgZGl2cyB0aGF0IHdlIGZvdW5kXHJcbiAgICBmb3IgKGxldCBpID0gdG9uaWNEaXZzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgIC8vIFNldCB0aGUgZGl2XHJcbiAgICAgIGNvbnN0IHRvbmljRGl2ID0gdG9uaWNEaXZzW2ldXHJcblxyXG4gICAgICAvLyBHZXQgdGhlIHdpZGdldCBpZFxyXG4gICAgICBjb25zdCB3aWRnZXRJZCA9IHRvbmljRGl2LmdldEF0dHJpYnV0ZSh0aGlzLmNvbmZpZy53aWRnZXRJZClcclxuICAgICAgaWYgKCF3aWRnZXRJZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGAke3dpZGdldElkfSBub3QgZm91bmRgKVxyXG4gICAgICAgIGNvbnRpbnVlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCB0aGUgY3VzdG9tIGVudmlyb25tZW50IChzd2l0Y2hpbmcgYXdheSBmcm9tIGRlZmF1bHQ6IHByb2R1Y3Rpb24pXHJcbiAgICAgIGNvbnN0IGN1c3RvbUVudmlyb25tZW50ID0gdG9uaWNEaXYuZ2V0QXR0cmlidXRlKHRoaXMuY29uZmlnLmN1c3RvbUVudmlyb25tZW50KVxyXG4gICAgICB0aGlzLmNvbmZpZy5zZXRFbnZpcm9ubWVudChjdXN0b21FbnZpcm9ubWVudCB8fCAncHJvZHVjdGlvbicpXHJcblxyXG4gICAgICAvLyBGaXJlIHRoZSByZXF1ZXN0IHRvIGxvYWQgdGhlIHdpZGdldCBkYXRhXHJcbiAgICAgIGNvbnN0IHByb21pc2UgPSBhd2FpdCBmZXRjaChcclxuICAgICAgICBgJHt0aGlzLmNvbmZpZy5hcGlVcmx9L3YxL3dpZGdldHMvZGlzcGxheS8ke3dpZGdldElkfT9wcm92aWRlcj1lbWJlZC0ke3RoaXMuY29uZmlnLnZlcnNpb259YFxyXG4gICAgICApXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcHJvbWlzZS5qc29uKClcclxuXHJcbiAgICAgIC8vIFNldCBVUkkgZW5jb2RlZCB0aXRsZVxyXG4gICAgICBjb25zdCBjYW1wYWlnblRpdGxlID0gZW5jb2RlVVJJQ29tcG9uZW50KHJlc3BvbnNlLnRpdGxlKVxyXG5cclxuICAgICAgLy8gU2V0IHRoZSBIVE1MXHJcbiAgICAgIHRvbmljRGl2LmlubmVySFRNTCA9IGBcclxuICAgIDxhIGhyZWY9XCIke3Jlc3BvbnNlLmxpbmtfdXJsfT91dG1fc291cmNlPXRvbmljcG93LXdpZGdldHMmdXRtX21lZGl1bT13aWRnZXQmdXRtX2NhbXBhaWduPSR7d2lkZ2V0SWR9JnV0bV9jb250ZW50PSR7Y2FtcGFpZ25UaXRsZX1cIj5cclxuICAgICAgPGltZyBzcmM9XCIke3Jlc3BvbnNlLmltYWdlX3VybH1cIiBcclxuICAgICAgd2lkdGg9XCIke3Jlc3BvbnNlLndpZHRofVwiIFxyXG4gICAgICBoZWlnaHQ9XCIke3Jlc3BvbnNlLmhlaWdodH1cIiBcclxuICAgICAgYWx0PVwiJHtyZXNwb25zZS50aXRsZX1cIiAvPlxyXG4gICAgPC9hPmBcclxuXHJcbiAgICAgIC8vIFNldCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXHJcbiAgICAgIHRvbmljRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS13aWR0aCcsIHJlc3BvbnNlLndpZHRoKVxyXG4gICAgICB0b25pY0Rpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JywgcmVzcG9uc2UuaGVpZ2h0KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTG9hZCB0aGUgVG9uaWNQb3cgc2NyaXB0KHMpIGFuZCBkZWZhdWx0IHNldHRpbmdzXHJcbiAgbG9hZCA9ICgpID0+IHtcclxuICAgIC8vIFdlIG9ubHkgd29yayBpbiBhIGJyb3dzZXJcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdUb25pY1BvdyBlbWJlZCBvbmx5IHdvcmtzIGluIHRoZSBicm93c2VyJylcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9hZCBhbGwgdG9uaWNzIGZvdW5kIG9uIHRoZSBwYWdlIChpZiB3ZSBoYXZlIGRpdilcclxuICAgIGNvbnN0IHRvbmljRGl2cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGhpcy5jb25maWcud2lkZ2V0RGl2Q2xhc3MpXHJcbiAgICBpZiAodG9uaWNEaXZzICYmIHRvbmljRGl2cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMubG9hZERpdnMoKS50aGVuKCgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnVG9uaWNQb3cgd2lkZ2V0KHMpIGxvYWRlZCEnKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2Nlc3MgdmlzaXRvciB0b2tlblxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuY2FwdHVyZVZpc2l0b3JTZXNzaW9uKClcclxuXHJcbiAgICAvLyBDYXB0dXJlIGV2ZW50cyBpZiB3ZSBoYXZlIGEgc2Vzc2lvblxyXG4gICAgaWYgKHNlc3Npb24pIHtcclxuICAgICAgdGhpcy5ldmVudHMgPSBuZXcgRXZlbnRzKHNlc3Npb24pXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyBUT0RPIC0gaG93IHRmIGRvIHdlIHdlIGF1dG9ydW4gdGhpcyBub3c/XHJcblxyXG4vLyBTZXQgb24gd2luZG93XHJcbjsod2luZG93IGFzIGFueSkuVG9uaWNQb3cgPSBUb25pY1BvdyB8fCB7fVxyXG4iLCIvKiBnbG9iYWwgbG9jYWxTdG9yYWdlICovXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdG9yYWdlIHtcclxuICAvKlxyXG4gIHJlbW92ZVN0b3JhZ2U6IHJlbW92ZXMgYSBrZXkgZnJvbSBsb2NhbFN0b3JhZ2UgYW5kIGl0cyBzaWJsaW5nIGV4cGlyYWN5IGtleVxyXG4gIHBhcmFtczpcclxuICAgICAga2V5IDxzdHJpbmc+IDogbG9jYWxTdG9yYWdlIGtleSB0byByZW1vdmVcclxuICByZXR1cm5zOlxyXG4gICAgICA8Ym9vbGVhbj4gOiB0ZWxsaW5nIGlmIG9wZXJhdGlvbiBzdWNjZWVkZWRcclxuICAqL1xyXG4gIHJlbW92ZVN0b3JhZ2UgPSAobmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShuYW1lKVxyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgJHtuYW1lfV9leHBpcmVzSW5gKVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBgcmVtb3ZlU3RvcmFnZTogRXJyb3IgcmVtb3Zpbmcga2V5IFske25hbWV9XSBmcm9tIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gXHJcbiAgICAgIClcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZVxyXG4gIH1cclxuXHJcbiAgLypcclxuICBnZXRTdG9yYWdlOiByZXRyaWV2ZXMgYSBrZXkgZnJvbSBsb2NhbFN0b3JhZ2UgcHJldmlvdXNseSBzZXQgd2l0aCBzZXRTdG9yYWdlKCkuXHJcbiAgcGFyYW1zOlxyXG4gICAgICBrZXkgPHN0cmluZz4gOiBsb2NhbFN0b3JhZ2Uga2V5XHJcbiAgcmV0dXJuczpcclxuICAgICAgPHN0cmluZz4gOiB2YWx1ZSBvZiBsb2NhbFN0b3JhZ2Uga2V5XHJcbiAgICAgIG51bGwgOiBpbiBjYXNlIG9mIGV4cGlyZWQga2V5IG9yIGZhaWx1cmVcclxuICAqL1xyXG4gIGdldFN0b3JhZ2UgPSAoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgIC8vIGVwb2NoIHRpbWUsIGxldHMgZGVhbCBvbmx5IHdpdGggaW50ZWdlclxyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxyXG5cclxuICAgIC8vIFNldCBleHBpcmF0aW9uIGZvciBzdG9yYWdlXHJcbiAgICBsZXQgZXhwaXJlc1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGV4cGlyZXMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgJHtrZXl9X2V4cGlyZXNgKVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgZ2V0SXRlbTogZXJyb3IgZ2V0dGluZyBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YClcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZXhwaXJlcyA9PT0gdW5kZWZpbmVkIHx8IGV4cGlyZXMgPT09IG51bGwpIHtcclxuICAgICAgZXhwaXJlcyA9IDBcclxuICAgIH1cclxuXHJcbiAgICAvLyBFeHBpcmVkXHJcbiAgICBpZiAoZXhwaXJlcyA8IG5vdykge1xyXG4gICAgICB0aGlzLnJlbW92ZVN0b3JhZ2Uoa2V5KVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCB0aGUgZXhpc3RpbmcgaXRlbVxyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSlcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYGdldFN0b3JhZ2U6IEVycm9yIHJlYWRpbmcga2V5IFske2tleX1dIGZyb20gbG9jYWxTdG9yYWdlOiAke0pTT04uc3RyaW5naWZ5KGUpfWApXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gIHNldFN0b3JhZ2U6IHdyaXRlcyBhIGtleSBpbnRvIGxvY2FsU3RvcmFnZSBzZXR0aW5nIGEgZXhwaXJlIHRpbWVcclxuICBwYXJhbXM6XHJcbiAgICAgIGtleSA8c3RyaW5nPiAgICAgOiBsb2NhbFN0b3JhZ2Uga2V5XHJcbiAgICAgIHZhbHVlIDxzdHJpbmc+ICAgOiBsb2NhbFN0b3JhZ2UgdmFsdWVcclxuICAgICAgZXhwaXJlcyA8bnVtYmVyPiA6IG51bWJlciBvZiBzZWNvbmRzIGZyb20gbm93IHRvIGV4cGlyZSB0aGUga2V5XHJcbiAgcmV0dXJuczpcclxuICAgICAgPGJvb2xlYW4+IDogdGVsbGluZyBpZiBvcGVyYXRpb24gc3VjY2VlZGVkXHJcbiAgKi9cclxuICBzZXRTdG9yYWdlID0gKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBleHBpcmVzOiBudW1iZXIgfCBudWxsID0gbnVsbCkgPT4ge1xyXG4gICAgLy8gRXhwaXJlZCB0aW1lXHJcbiAgICBpZiAoZXhwaXJlcykge1xyXG4gICAgICBleHBpcmVzID0gTWF0aC5hYnMoZXhwaXJlcykgLy8gbWFrZSBzdXJlIGl0J3MgcG9zaXRpdmVcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGV4cGlyZXMgPSAyNCAqIDYwICogNjAgLy8gZGVmYXVsdDogc2Vjb25kcyBmb3IgMSBkYXlcclxuICAgIH1cclxuXHJcbiAgICAvLyBNaWxsaSBzZWNvbmRzIHNpbmNlIGVwb2NoIHRpbWUsIGxldHMgZGVhbCBvbmx5IHdpdGggaW50ZWdlclxyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxyXG4gICAgY29uc3Qgc2NoZWR1bGUgPSBub3cgKyBleHBpcmVzICogMTAwMFxyXG4gICAgdHJ5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSlcclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7a2V5fV9leHBpcmVzYCwgc2NoZWR1bGUudG9TdHJpbmcoKSlcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5sb2coYHNldFN0b3JhZ2U6IEVycm9yIHNldHRpbmcga2V5IFske2tleX1dIGluIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gKVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlXHJcbiAgfVxyXG59XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdGlmKF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0pIHtcblx0XHRyZXR1cm4gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYwNyk7XG4iXSwic291cmNlUm9vdCI6IiJ9