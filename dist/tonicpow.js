(()=>{var t={916:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});const n=i.p+"0cc67b926321b46c35cc929178804e2f.svg"},913:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.isEnvironmentValid=t=>this.environments.includes(t),this.setEnvironment=t=>{t&&this.isEnvironmentValid(t)&&(this.environment=t,t===this.environmentStaging?(this.apiUrl=this.apiUrlStaging,this.eventsUrl=this.eventsUrlStaging):t===this.environmentLocal?(this.apiUrl=this.apiUrlLocal,this.eventsUrl=this.eventsUrlLocal):t===this.environmentProduction&&(this.apiUrl=this.apiUrlProduction,this.eventsUrl=this.eventsUrlProduction))},this.environmentLocal="local",this.environmentStaging="staging",this.environmentProduction="production",this.apiUrl="https://api.tonicpow.com",this.apiUrlLocal="http://localhost:3000",this.apiUrlStaging="https://api.staging.tonicpow.com",this.apiUrlProduction="https://api.tonicpow.com",this.eventsUrl="https://events.tonicpow.com",this.eventsUrlLocal="http://localhost:3002",this.eventsUrlStaging="https://events.staging.tonicpow.com",this.eventsUrlProduction="https://events.tonicpow.com",this.customEnvironmentAttribute="data-environment",this.environment="",this.environments=[this.environmentLocal,this.environmentStaging,this.environmentProduction],this.maxSessionDays=60,this.sessionName="tncpw_session",this.version="v0.0.8",this.widgetDivClass="tonicpow-widget",this.widgetIdAttribute="data-widget-id"}}}.apply(e,[i,e]))||(t.exports=n)},242:function(t,e,i){var n,o=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function c(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,c)}a((n=n.apply(t,e||[])).next())}))};void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.detectWidgetClick=()=>{document.addEventListener("click",(t=>o(this,void 0,void 0,(function*(){var e,i,n=(t||window.event).target;let o=null===(e=null==n?void 0:n.parentElement)||void 0===e?void 0:e.parentElement;if(null===(i=null==o?void 0:o.classList)||void 0===i?void 0:i.contains("tonicpow-widget"))try{yield this.sendEvent("click",o.getAttribute("widget-id")||"")}catch(t){console.error("failed to report interaction: click",t)}}))))},this.detectBounce=()=>{window.onbeforeunload=()=>{this.sendEvent("bounce",((new Date).getTime()-this.start).toString())}},this.detectInteraction=()=>{document.addEventListener("mousedown",(()=>o(this,void 0,void 0,(function*(){if(!this.interactionSent)try{yield this.sendEvent("interaction","mousedown"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: mousedown",t)}})))),document.addEventListener("scroll",(()=>o(this,void 0,void 0,(function*(){if(!this.interactionSent)try{yield this.sendEvent("interaction","scroll"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: scroll",t)}})))),document.addEventListener("keypress",(()=>o(this,void 0,void 0,(function*(){if(!this.interactionSent)try{yield this.sendEvent("interaction","keypress"),this.interactionSent=!0}catch(t){console.error("failed to report interaction: keypress",t)}}))))},this.sendEvent=(t,e)=>o(this,void 0,void 0,(function*(){if(!this.sessionId)return void console.info("you must call init with a session before sending events");let i={v:this.config.version,name:t,tncpw_session:this.sessionId,data:e};yield fetch(`${this.config.eventsUrl}/v1/events?d=${btoa(JSON.stringify(i))}`,{method:"get"})})),this.sessionId=t,this.config=e,this.interactionSent=!1,this.start=(new Date).getTime(),this.detectInteraction(),this.detectBounce(),this.detectWidgetClick()}}}.apply(e,[i,e]))||(t.exports=n)},607:function(t,e,i){var n,o,s=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function c(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,c)}a((n=n.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(916),i(913),i(242),i(912)],void 0===(o=function(t,e,i,n,o,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i=r(i),n=r(n),o=r(o),c=r(c);class a{constructor(t){this.registerEvents=()=>{if(!this.events){let t=this.getVisitorSession();t&&t.length&&(this.events=new o.default(t,this.config))}},this.setOreo=(t,e,i)=>{const n=new Date;n.setTime(n.getTime()+864e5*i),document.cookie=`${t}=${e};path=/;expires=${n.toUTCString()}`},this.captureVisitorSession=(t="")=>{let e=t;return t&&t.length||"undefined"==typeof window||(e=new URLSearchParams(window.location.search).get(this.config.sessionName)||""),e&&e.length>0?(this.setOreo(this.config.sessionName,e,this.config.maxSessionDays),this.storage.setStorage(this.config.sessionName,e,86400*this.config.maxSessionDays),e):null},this.getVisitorSession=()=>this.storage.getStorage(this.config.sessionName),this.loadDivs=()=>s(this,void 0,void 0,(function*(){const t=document.getElementsByClassName(this.config.widgetDivClass);for(let n=t.length-1;n>=0;n--){const o=t[n];if(!o){console.log("exit early - remove this?");continue}const s=o.getAttribute(this.config.widgetIdAttribute);if(!s){console.log(`${s} not found`);continue}const r=o.getAttribute(this.config.customEnvironmentAttribute);this.config.setEnvironment(r||"production"),this.widgets.set(s,null);try{const t=yield fetch(`${this.config.apiUrl}/v1/widgets/display/${s}?provider=embed-${this.config.version}`);var e;403===t.status?(console.info(`${t.status}: Domain not allowed`),e={link_url:"https://tonicpow.com",image_url:i.default}):e=yield t.json();const n=encodeURIComponent(e.title);o.innerHTML=`\n      <a href="${e.link_url}?utm_source=tonicpow-widgets&utm_medium=widget&utm_campaign=${s}&utm_content=${n}" style="display: inline-block">\n      <img src="${e.image_url}" \n      width="${e.width}" \n      height="${e.height}" \n      alt="${e.title}" />\n      </a>`,o.setAttribute("data-width",e.width),o.setAttribute("data-height",e.height),this.widgets.set(s,e),this.options&&this.options.onWidgetLoaded&&(e.id=s,this.options.onWidgetLoaded(e))}catch(t){throw t}}})),this.load=()=>s(this,void 0,void 0,(function*(){if("undefined"==typeof window)return void console.error("TonicPow embed only works in the browser");const t=document.getElementsByClassName(this.config.widgetDivClass);if(t&&t.length>0)try{yield this.loadDivs(),console.log("%c TonicPow widget(s) loaded! ","background: #974CD2; color: #fff")}catch(t){throw t}const e=this.captureVisitorSession();e&&(this.events=new o.default(e,this.config))})),this.config=new n.default,this.storage=new c.default,this.widgets=new Map,this.options=t,"complete"===document.readyState||"interactive"===document.readyState?(this.load(),this.registerEvents()):document.addEventListener("DOMContentLoaded",(()=>{this.load(),this.registerEvents()}))}}e.default=a;var l=new a;window.TonicPow=l||{}}.apply(e,n))||(t.exports=o)},912:(t,e,i)=>{var n;void 0===(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.removeStorage=t=>{try{localStorage.removeItem(t),localStorage.removeItem(`${t}_expiresIn`)}catch(e){return console.log(`removeStorage: Error removing key [${t}] from localStorage: ${JSON.stringify(e)}`),!1}return!0},this.getStorage=t=>{const e=Date.now();let i;try{i=localStorage.getItem(`${t}_expires`)}catch(t){return console.log(`getItem: error getting localStorage: ${JSON.stringify(t)}`),null}if(null==i&&(i=0),i<e)return this.removeStorage(t),null;try{return localStorage.getItem(t)}catch(e){return console.log(`getStorage: Error reading key [${t}] from localStorage: ${JSON.stringify(e)}`),null}},this.setStorage=(t,e,i=null)=>{i=i?Math.abs(i):86400;const n=Date.now()+1e3*i;try{localStorage.setItem(t,e),localStorage.setItem(`${t}_expires`,n.toString())}catch(e){return console.log(`setStorage: Error setting key [${t}] in localStorage: ${JSON.stringify(e)}`),!1}return!0}}}}.apply(e,[i,e]))||(t.exports=n)}},e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.p="",i(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0Ly4vc3JjL2Fzc2V0cy9pbWFnZV9wbGFjZWhvbGRlcl90b25pY3Bvd19zcXVhcmUuc3ZnIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvY29uZmlnLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvZXZlbnRzLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC8uL3NyYy9zdG9yYWdlLnRzIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQHRvbmljcG93L3dpZGdldC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9AdG9uaWNwb3cvd2lkZ2V0L3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL0B0b25pY3Bvdy93aWRnZXQvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbImlzRW52aXJvbm1lbnRWYWxpZCIsImVudmlyb25tZW50IiwidGhpcyIsImVudmlyb25tZW50cyIsImluY2x1ZGVzIiwic2V0RW52aXJvbm1lbnQiLCJlbnZpcm9ubWVudFN0YWdpbmciLCJhcGlVcmwiLCJhcGlVcmxTdGFnaW5nIiwiZXZlbnRzVXJsIiwiZXZlbnRzVXJsU3RhZ2luZyIsImVudmlyb25tZW50TG9jYWwiLCJhcGlVcmxMb2NhbCIsImV2ZW50c1VybExvY2FsIiwiZW52aXJvbm1lbnRQcm9kdWN0aW9uIiwiYXBpVXJsUHJvZHVjdGlvbiIsImV2ZW50c1VybFByb2R1Y3Rpb24iLCJjdXN0b21FbnZpcm9ubWVudEF0dHJpYnV0ZSIsIm1heFNlc3Npb25EYXlzIiwic2Vzc2lvbk5hbWUiLCJ2ZXJzaW9uIiwid2lkZ2V0RGl2Q2xhc3MiLCJ3aWRnZXRJZEF0dHJpYnV0ZSIsInNlc3Npb25JZCIsImNvbmZpZyIsImRldGVjdFdpZGdldENsaWNrIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRhcmdldCIsIndpbmRvdyIsImV2ZW50IiwiY29udGFpbmVyIiwicGFyZW50RWxlbWVudCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwic2VuZEV2ZW50IiwiZ2V0QXR0cmlidXRlIiwiY29uc29sZSIsImVycm9yIiwiZGV0ZWN0Qm91bmNlIiwib25iZWZvcmV1bmxvYWQiLCJEYXRlIiwiZ2V0VGltZSIsInN0YXJ0IiwidG9TdHJpbmciLCJkZXRlY3RJbnRlcmFjdGlvbiIsImludGVyYWN0aW9uU2VudCIsImV2ZW50TmFtZSIsImRhdGEiLCJpbmZvIiwicGF5bG9hZCIsInYiLCJuYW1lIiwidG5jcHdfc2Vzc2lvbiIsImZldGNoIiwiYnRvYSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRob2QiLCJUb25pY1BvdyIsIm9wdGlvbnMiLCJyZWdpc3RlckV2ZW50cyIsImV2ZW50cyIsInNlc3Npb24iLCJnZXRWaXNpdG9yU2Vzc2lvbiIsImxlbmd0aCIsInNldE9yZW8iLCJ2YWx1ZSIsImRheXMiLCJkYXRlIiwic2V0VGltZSIsImNvb2tpZSIsInRvVVRDU3RyaW5nIiwiY2FwdHVyZVZpc2l0b3JTZXNzaW9uIiwiY3VzdG9tU2Vzc2lvbklkIiwiVVJMU2VhcmNoUGFyYW1zIiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJzdG9yYWdlIiwic2V0U3RvcmFnZSIsImdldFN0b3JhZ2UiLCJsb2FkRGl2cyIsInRvbmljRGl2cyIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJpIiwidG9uaWNEaXYiLCJsb2ciLCJ3aWRnZXRJZCIsImN1c3RvbUVudmlyb25tZW50Iiwid2lkZ2V0cyIsInNldCIsInByb21pc2UiLCJyZXNwb25zZSIsInN0YXR1cyIsImxpbmtfdXJsIiwiaW1hZ2VfdXJsIiwianNvbiIsImNhbXBhaWduVGl0bGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJ0aXRsZSIsImlubmVySFRNTCIsIndpZHRoIiwiaGVpZ2h0Iiwic2V0QXR0cmlidXRlIiwib25XaWRnZXRMb2FkZWQiLCJpZCIsImxvYWQiLCJNYXAiLCJyZWFkeVN0YXRlIiwidHBvdyIsInJlbW92ZVN0b3JhZ2UiLCJsb2NhbFN0b3JhZ2UiLCJyZW1vdmVJdGVtIiwia2V5Iiwibm93IiwiZXhwaXJlcyIsImdldEl0ZW0iLCJNYXRoIiwiYWJzIiwic2NoZWR1bGUiLCJzZXRJdGVtIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwiZCIsImRlZmluaXRpb24iLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwicCJdLCJtYXBwaW5ncyI6InNFQUFBLFFBQWUsSUFBMEIsd0MsNEdDQXpDLGdCQXFCRSxjQXdCQSxLQUFBQSxtQkFBc0JDLEdBQXdCQyxLQUFLQyxhQUFhQyxTQUFTSCxHQUd6RSxLQUFBSSxlQUFrQkosSUFFWEEsR0FLQUMsS0FBS0YsbUJBQW1CQyxLQUs3QkMsS0FBS0QsWUFBY0EsRUFHZkEsSUFBZ0JDLEtBQUtJLG9CQUN2QkosS0FBS0ssT0FBU0wsS0FBS00sY0FDbkJOLEtBQUtPLFVBQVlQLEtBQUtRLGtCQUNiVCxJQUFnQkMsS0FBS1Msa0JBQzlCVCxLQUFLSyxPQUFTTCxLQUFLVSxZQUNuQlYsS0FBS08sVUFBWVAsS0FBS1csZ0JBQ2JaLElBQWdCQyxLQUFL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a19wdWJsaWNfcGF0aF9fICsgXCIwY2M2N2I5MjYzMjFiNDZjMzVjYzkyOTE3ODgwNGUyZi5zdmdcIjsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDb25maWcge1xyXG4gIGVudmlyb25tZW50TG9jYWw6IHN0cmluZ1xyXG4gIGVudmlyb25tZW50U3RhZ2luZzogc3RyaW5nXHJcbiAgZW52aXJvbm1lbnRQcm9kdWN0aW9uOiBzdHJpbmdcclxuICBhcGlVcmw6IHN0cmluZ1xyXG4gIGFwaVVybExvY2FsOiBzdHJpbmdcclxuICBhcGlVcmxTdGFnaW5nOiBzdHJpbmdcclxuICBhcGlVcmxQcm9kdWN0aW9uOiBzdHJpbmdcclxuICBldmVudHNVcmw6IHN0cmluZ1xyXG4gIGV2ZW50c1VybExvY2FsOiBzdHJpbmdcclxuICBldmVudHNVcmxTdGFnaW5nOiBzdHJpbmdcclxuICBldmVudHNVcmxQcm9kdWN0aW9uOiBzdHJpbmdcclxuICBjdXN0b21FbnZpcm9ubWVudEF0dHJpYnV0ZTogc3RyaW5nXHJcbiAgZW52aXJvbm1lbnQ6IHN0cmluZ1xyXG4gIGVudmlyb25tZW50czogc3RyaW5nW11cclxuICBtYXhTZXNzaW9uRGF5czogbnVtYmVyXHJcbiAgc2Vzc2lvbk5hbWU6IHN0cmluZ1xyXG4gIHZlcnNpb246IHN0cmluZ1xyXG4gIHdpZGdldERpdkNsYXNzOiBzdHJpbmdcclxuICB3aWRnZXRJZEF0dHJpYnV0ZTogc3RyaW5nXHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudExvY2FsID0gJ2xvY2FsJ1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudFN0YWdpbmcgPSAnc3RhZ2luZydcclxuICAgIHRoaXMuZW52aXJvbm1lbnRQcm9kdWN0aW9uID0gJ3Byb2R1Y3Rpb24nXHJcblxyXG4gICAgdGhpcy5hcGlVcmwgPSAnaHR0cHM6Ly9hcGkudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5hcGlVcmxMb2NhbCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnXHJcbiAgICB0aGlzLmFwaVVybFN0YWdpbmcgPSAnaHR0cHM6Ly9hcGkuc3RhZ2luZy50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmFwaVVybFByb2R1Y3Rpb24gPSAnaHR0cHM6Ly9hcGkudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5ldmVudHNVcmwgPSAnaHR0cHM6Ly9ldmVudHMudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5ldmVudHNVcmxMb2NhbCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDInXHJcbiAgICB0aGlzLmV2ZW50c1VybFN0YWdpbmcgPSAnaHR0cHM6Ly9ldmVudHMuc3RhZ2luZy50b25pY3Bvdy5jb20nXHJcbiAgICB0aGlzLmV2ZW50c1VybFByb2R1Y3Rpb24gPSAnaHR0cHM6Ly9ldmVudHMudG9uaWNwb3cuY29tJ1xyXG4gICAgdGhpcy5jdXN0b21FbnZpcm9ubWVudEF0dHJpYnV0ZSA9ICdkYXRhLWVudmlyb25tZW50J1xyXG4gICAgdGhpcy5lbnZpcm9ubWVudCA9ICcnXHJcbiAgICB0aGlzLmVudmlyb25tZW50cyA9IFt0aGlzLmVudmlyb25tZW50TG9jYWwsIHRoaXMuZW52aXJvbm1lbnRTdGFnaW5nLCB0aGlzLmVudmlyb25tZW50UHJvZHVjdGlvbl1cclxuICAgIHRoaXMubWF4U2Vzc2lvbkRheXMgPSA2MFxyXG4gICAgdGhpcy5zZXNzaW9uTmFtZSA9ICd0bmNwd19zZXNzaW9uJ1xyXG4gICAgdGhpcy52ZXJzaW9uID0gJ3YwLjAuOCdcclxuICAgIHRoaXMud2lkZ2V0RGl2Q2xhc3MgPSAndG9uaWNwb3ctd2lkZ2V0J1xyXG4gICAgdGhpcy53aWRnZXRJZEF0dHJpYnV0ZSA9ICdkYXRhLXdpZGdldC1pZCdcclxuICB9XHJcblxyXG4gIC8vIGlzRW52aXJvbm1lbnRWYWxpZCB3aWxsIGNoZWNrIGlmIHRoZSBnaXZlbiBlbnZpcm9ubWVudCBpcyB2YWxpZFxyXG4gIGlzRW52aXJvbm1lbnRWYWxpZCA9IChlbnZpcm9ubWVudDogc3RyaW5nKSA9PiB0aGlzLmVudmlyb25tZW50cy5pbmNsdWRlcyhlbnZpcm9ubWVudClcclxuXHJcbiAgLy8gc2V0RW52aXJvbm1lbnQgd2lsbCBzZXQgdGhlIGVudmlyb25tZW50XHJcbiAgc2V0RW52aXJvbm1lbnQgPSAoZW52aXJvbm1lbnQ6IHN0cmluZykgPT4ge1xyXG4gICAgLy8gTm8gZW52aXJvbm1lbnQgc2V0PyB1c2UgdGhlIGRlZmF1bHRcclxuICAgIGlmICghZW52aXJvbm1lbnQpIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTm90IGEgdmFsaWQgZW52aXJvbm1lbnQ/XHJcbiAgICBpZiAoIXRoaXMuaXNFbnZpcm9ubWVudFZhbGlkKGVudmlyb25tZW50KSkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgdGhlIGVudmlyb25tZW50XHJcbiAgICB0aGlzLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnRcclxuXHJcbiAgICAvLyBTZXQgdGhlIEFQSSB1cmxcclxuICAgIGlmIChlbnZpcm9ubWVudCA9PT0gdGhpcy5lbnZpcm9ubWVudFN0YWdpbmcpIHtcclxuICAgICAgdGhpcy5hcGlVcmwgPSB0aGlzLmFwaVVybFN0YWdpbmdcclxuICAgICAgdGhpcy5ldmVudHNVcmwgPSB0aGlzLmV2ZW50c1VybFN0YWdpbmdcclxuICAgIH0gZWxzZSBpZiAoZW52aXJvbm1lbnQgPT09IHRoaXMuZW52aXJvbm1lbnRMb2NhbCkge1xyXG4gICAgICB0aGlzLmFwaVVybCA9IHRoaXMuYXBpVXJsTG9jYWxcclxuICAgICAgdGhpcy5ldmVudHNVcmwgPSB0aGlzLmV2ZW50c1VybExvY2FsXHJcbiAgICB9IGVsc2UgaWYgKGVudmlyb25tZW50ID09PSB0aGlzLmVudmlyb25tZW50UHJvZHVjdGlvbikge1xyXG4gICAgICB0aGlzLmFwaVVybCA9IHRoaXMuYXBpVXJsUHJvZHVjdGlvblxyXG4gICAgICB0aGlzLmV2ZW50c1VybCA9IHRoaXMuZXZlbnRzVXJsUHJvZHVjdGlvblxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgQ29uZmlnIGZyb20gJy4vY29uZmlnJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXZlbnRzIHtcclxuICBzZXNzaW9uSWQ6IHN0cmluZ1xyXG4gIHN0YXJ0OiBudW1iZXJcclxuICBpbnRlcmFjdGlvblNlbnQ6IGJvb2xlYW5cclxuICBjb25maWc6IENvbmZpZ1xyXG5cclxuICBjb25zdHJ1Y3RvcihzZXNzaW9uSWQ6IHN0cmluZywgY29uZmlnOiBDb25maWcpIHtcclxuICAgIC8vIFNldCB0aGUgY3VycmVudCBzZXNzaW9uXHJcbiAgICB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JZFxyXG4gICAgdGhpcy5jb25maWcgPSBjb25maWdcclxuXHJcbiAgICB0aGlzLmludGVyYWN0aW9uU2VudCA9IGZhbHNlXHJcblxyXG4gICAgLy8gUmVtZW1iZXIgd2hlbiB3ZSBzdGFydGVkXHJcbiAgICB0aGlzLnN0YXJ0ID0gbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgIHRoaXMuZGV0ZWN0SW50ZXJhY3Rpb24oKVxyXG4gICAgdGhpcy5kZXRlY3RCb3VuY2UoKVxyXG4gICAgdGhpcy5kZXRlY3RXaWRnZXRDbGljaygpXHJcbiAgfVxyXG5cclxuICAvLyBEZXRlY3RzIGNsaWNrIG9uIHRoZSB3aWRnZXRcclxuICBkZXRlY3RXaWRnZXRDbGljayA9ICgpID0+IHtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGU6IEV2ZW50KSA9PiB7XHJcbiAgICAgIC8vIEdldCB0aGUgY2xpY2sgdGFyZ2V0XHJcbiAgICAgIHZhciB0YXJnZXQgPSAoZSB8fCB3aW5kb3cuZXZlbnQpLnRhcmdldCBhcyBIVE1MRGl2RWxlbWVudFxyXG5cclxuICAgICAgLy8gR2V0IHRoZSB3aWRnZXQgY29udGFpbmVyXHJcbiAgICAgIGxldCBjb250YWluZXIgPSB0YXJnZXQ/LnBhcmVudEVsZW1lbnQ/LnBhcmVudEVsZW1lbnRcclxuXHJcbiAgICAgIC8vIFNlbmQgZXZlbnQgb25seSBpZiB3aWRnZXQgd2FzIGNsaWNrZWRcclxuICAgICAgaWYgKGNvbnRhaW5lcj8uY2xhc3NMaXN0Py5jb250YWlucygndG9uaWNwb3ctd2lkZ2V0JykpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2NsaWNrJywgY29udGFpbmVyLmdldEF0dHJpYnV0ZSgnd2lkZ2V0LWlkJykgfHwgJycpXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjogY2xpY2snLCBlKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vIERldGVjdHMgYSBib3VuY2UgZXZlbnRcclxuICBkZXRlY3RCb3VuY2UgPSAoKSA9PiB7XHJcbiAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgIC8vIENhbGN1bGF0ZSB0aW1lIG9uIHBhZ2VcclxuICAgICAgdGhpcy5zZW5kRXZlbnQoJ2JvdW5jZScsIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuc3RhcnQpLnRvU3RyaW5nKCkpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBEZXRlY3RzIGEgcGFnZSBpbnRlcmFjdGlvblxyXG4gIGRldGVjdEludGVyYWN0aW9uID0gKCkgPT4ge1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25TZW50KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEV2ZW50KCdpbnRlcmFjdGlvbicsICdtb3VzZWRvd24nKVxyXG4gICAgICAgICAgdGhpcy5pbnRlcmFjdGlvblNlbnQgPSB0cnVlXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjogbW91c2Vkb3duJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuaW50ZXJhY3Rpb25TZW50KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEV2ZW50KCdpbnRlcmFjdGlvbicsICdzY3JvbGwnKVxyXG4gICAgICAgICAgdGhpcy5pbnRlcmFjdGlvblNlbnQgPSB0cnVlXHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIHJlcG9ydCBpbnRlcmFjdGlvbjogc2Nyb2xsJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5pbnRlcmFjdGlvblNlbnQpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRXZlbnQoJ2ludGVyYWN0aW9uJywgJ2tleXByZXNzJylcclxuICAgICAgICAgIHRoaXMuaW50ZXJhY3Rpb25TZW50ID0gdHJ1ZVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2ZhaWxlZCB0byByZXBvcnQgaW50ZXJhY3Rpb246IGtleXByZXNzJywgZSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvLyBTZW5kIGV2ZW50IHdpbGwgc2VuZCBhbiBldmVudCB0byBUb25pY1Bvd1xyXG4gIHNlbmRFdmVudCA9IGFzeW5jIChldmVudE5hbWU6IHN0cmluZywgZGF0YTogc3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoIXRoaXMuc2Vzc2lvbklkKSB7XHJcbiAgICAgIGNvbnNvbGUuaW5mbygneW91IG11c3QgY2FsbCBpbml0IHdpdGggYSBzZXNzaW9uIGJlZm9yZSBzZW5kaW5nIGV2ZW50cycpXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIC8vIFBhY2thZ2UgcGF5bG9hZFxyXG4gICAgbGV0IHBheWxvYWQgPSB7XHJcbiAgICAgIHY6IHRoaXMuY29uZmlnLnZlcnNpb24sXHJcbiAgICAgIG5hbWU6IGV2ZW50TmFtZSxcclxuICAgICAgdG5jcHdfc2Vzc2lvbjogdGhpcy5zZXNzaW9uSWQsXHJcbiAgICAgIGRhdGEsXHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgZmV0Y2goYCR7dGhpcy5jb25maWcuZXZlbnRzVXJsfS92MS9ldmVudHM/ZD0ke2J0b2EoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpfWAsIHtcclxuICAgICAgbWV0aG9kOiAnZ2V0JyxcclxuICAgIH0pXHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBmYWxsYmFja0ltYWdlIGZyb20gJy4vYXNzZXRzL2ltYWdlX3BsYWNlaG9sZGVyX3RvbmljcG93X3NxdWFyZS5zdmcnXHJcbmltcG9ydCBDb25maWcgZnJvbSAnLi9jb25maWcnXHJcbmltcG9ydCBFdmVudHMgZnJvbSAnLi9ldmVudHMnXHJcbmltcG9ydCBTdG9yYWdlIGZyb20gJy4vc3RvcmFnZSdcclxuaW1wb3J0IFdpZGdldCBmcm9tICcuL3R5cGVzJ1xyXG5cclxuaW50ZXJmYWNlIFRvbmljUG93T3B0aW9ucyB7XHJcbiAgb25XaWRnZXRMb2FkZWQ6ICh3aWRnZXQ6IHR5cGVvZiBXaWRnZXQpID0+IHZvaWRcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVG9uaWNQb3cge1xyXG4gIGNvbmZpZzogQ29uZmlnXHJcbiAgc3RvcmFnZTogU3RvcmFnZVxyXG4gIGV2ZW50czogRXZlbnRzIHwgdW5kZWZpbmVkXHJcbiAgd2lkZ2V0czogTWFwPFN0cmluZywgdHlwZW9mIFdpZGdldCB8IG51bGw+XHJcbiAgb3B0aW9uczogVG9uaWNQb3dPcHRpb25zIHwgdW5kZWZpbmVkXHJcblxyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM/OiBUb25pY1Bvd09wdGlvbnMpIHtcclxuICAgIC8vIFNldCBuYW1lc3BhY2VzXHJcbiAgICB0aGlzLmNvbmZpZyA9IG5ldyBDb25maWcoKVxyXG4gICAgdGhpcy5zdG9yYWdlID0gbmV3IFN0b3JhZ2UoKVxyXG4gICAgdGhpcy53aWRnZXRzID0gbmV3IE1hcDxTdHJpbmcsIHR5cGVvZiBXaWRnZXQ+KClcclxuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnNcclxuXHJcbiAgICAvLyBTdGFydCB0aGUgVG9uaWNQb3cgc2VydmljZSBhbmQgbG9hZCBtb2R1bGVzXHJcblxyXG4gICAgLy8gTG9hZCB0aGUgVG9uaWNQb3cgd2lkZ2V0IHdoZW4gRE9NIGlzIHJlYWR5XHJcbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJyB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnaW50ZXJhY3RpdmUnKSB7XHJcbiAgICAgIC8vIFRoaXMgbG9hZHMgaWYgdGhlIDxzY3JpcHQ+IGlzIGR5bmFtaWNhbGx5IGluamVjdGVkIGludG8gdGhlIHBhZ2VcclxuICAgICAgdGhpcy5sb2FkKClcclxuICAgICAgdGhpcy5yZWdpc3RlckV2ZW50cygpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBUaGlzIGxvYWRzIGlmIHRoZSA8c2NyaXB0PiBpcyBoYXJkY29kZWQgaW4gdGhlIGh0bWwgcGFnZSBpbiB0aGUgPGhlYWQ+XHJcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2FkKClcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnRzKClcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIHJlZ2lzdGVyRXZlbnRzIC1SZWdpc3RlcnMgZXZlbnQgbGlzdGVuZXJzLiBSdW5zIG9ubHkgb25jZVxyXG4gIHJlZ2lzdGVyRXZlbnRzID0gKCkgPT4ge1xyXG4gICAgaWYgKCF0aGlzLmV2ZW50cykge1xyXG4gICAgICAvLyBSZWdpc3RlciBldmVudHMgaWYgd2UgaGF2ZSBhIHZhbGlkIHNlc3Npb25cclxuICAgICAgbGV0IHNlc3Npb24gPSB0aGlzLmdldFZpc2l0b3JTZXNzaW9uKClcclxuICAgICAgLy8gVE9ETzogVmFsaWRhdGUgc2Vzc2lvbiBoZXJlXHJcbiAgICAgIGlmIChzZXNzaW9uICYmIHNlc3Npb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgdGhpcy5ldmVudHMgPSBuZXcgRXZlbnRzKHNlc3Npb24sIHRoaXMuY29uZmlnKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBzZXRPcmVvIGZvciBjcmVhdGluZyBuZXcgb3Jlb3NcclxuICBzZXRPcmVvID0gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgZGF5czogbnVtYmVyKSA9PiB7XHJcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKVxyXG4gICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgMjQgKiA2MCAqIDYwICogMTAwMCAqIGRheXMpXHJcbiAgICBkb2N1bWVudC5jb29raWUgPSBgJHtuYW1lfT0ke3ZhbHVlfTtwYXRoPS87ZXhwaXJlcz0ke2RhdGUudG9VVENTdHJpbmcoKX1gXHJcbiAgfVxyXG5cclxuICAvLyBjYXB0dXJlVmlzaXRvclNlc3Npb24gd2lsbCBjYXB0dXJlIHRoZSBzZXNzaW9uIGFuZCBzdG9yZSBpdFxyXG4gIC8vIEJ1aWxkcyBhIGNvb2tpZSBzbyBpdCdzIHNlbnQgb24gcmVxdWVzdHMgYXV0b21hdGljYWxseVxyXG4gIC8vIFN0b3JlcyBpbiBsb2NhbCBzdG9yYWdlIGZvciBlYXN5IGFjY2VzcyBmcm9tIHRoZSBhcHBsaWNhdGlvblxyXG4gIGNhcHR1cmVWaXNpdG9yU2Vzc2lvbiA9IChjdXN0b21TZXNzaW9uSWQ6IHN0cmluZyA9ICcnKSA9PiB7XHJcbiAgICBsZXQgc2Vzc2lvbklkID0gY3VzdG9tU2Vzc2lvbklkXHJcblxyXG4gICAgaWYgKCghY3VzdG9tU2Vzc2lvbklkIHx8ICFjdXN0b21TZXNzaW9uSWQubGVuZ3RoKSAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpXHJcbiAgICAgIHNlc3Npb25JZCA9IHVybFBhcmFtcy5nZXQodGhpcy5jb25maWcuc2Vzc2lvbk5hbWUpIHx8ICcnXHJcbiAgICB9XHJcbiAgICBpZiAoc2Vzc2lvbklkICYmIHNlc3Npb25JZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuc2V0T3Jlbyh0aGlzLmNvbmZpZy5zZXNzaW9uTmFtZSwgc2Vzc2lvbklkLCB0aGlzLmNvbmZpZy5tYXhTZXNzaW9uRGF5cylcclxuICAgICAgdGhpcy5zdG9yYWdlLnNldFN0b3JhZ2UoXHJcbiAgICAgICAgdGhpcy5jb25maWcuc2Vzc2lvbk5hbWUsXHJcbiAgICAgICAgc2Vzc2lvbklkLFxyXG4gICAgICAgIDI0ICogNjAgKiA2MCAqIHRoaXMuY29uZmlnLm1heFNlc3Npb25EYXlzXHJcbiAgICAgIClcclxuICAgICAgcmV0dXJuIHNlc3Npb25JZFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcblxyXG4gIC8vIGdldFZpc2l0b3JTZXNzaW9uIHdpbGwgZ2V0IHRoZSBzZXNzaW9uIGlmIGl0IGV4aXN0c1xyXG4gIGdldFZpc2l0b3JTZXNzaW9uID0gKCkgPT4gdGhpcy5zdG9yYWdlLmdldFN0b3JhZ2UodGhpcy5jb25maWcuc2Vzc2lvbk5hbWUpXHJcblxyXG4gIC8vIGxvYWREaXZzIHJlcGxhY2VzIGVhY2ggVG9uaWNQb3cgZGl2IHdpdGggYSBjb3JyZXNwb25kaW5nIGVtYmVkIHdpZGdldFxyXG4gIGxvYWREaXZzID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gR2V0IGFsbCBkaXZzXHJcbiAgICBjb25zdCB0b25pY0RpdnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuY29uZmlnLndpZGdldERpdkNsYXNzKVxyXG5cclxuICAgIC8vIExvb3AgYWxsIGRpdnMgdGhhdCB3ZSBmb3VuZFxyXG4gICAgZm9yIChsZXQgaSA9IHRvbmljRGl2cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAvLyBTZXQgdGhlIGRpdlxyXG4gICAgICBjb25zdCB0b25pY0RpdiA9IHRvbmljRGl2c1tpXSBhcyBIVE1MRGl2RWxlbWVudFxyXG5cclxuICAgICAgLy8gTm90IHN1cmUgd2h5IHRoaXMgaXMgbmVlZGVkIGJ1dCBlbmNvdW50ZXJlZCB0aGlzIGluIHByb2QgMy81LzIwMjEgLSBsdWtlXHJcbiAgICAgIGlmICghdG9uaWNEaXYpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnZXhpdCBlYXJseSAtIHJlbW92ZSB0aGlzPycpXHJcbiAgICAgICAgY29udGludWVcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IHRoZSB3aWRnZXQgaWRcclxuICAgICAgY29uc3Qgd2lkZ2V0SWQgPSB0b25pY0Rpdi5nZXRBdHRyaWJ1dGUodGhpcy5jb25maWcud2lkZ2V0SWRBdHRyaWJ1dGUpXHJcbiAgICAgIGlmICghd2lkZ2V0SWQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgJHt3aWRnZXRJZH0gbm90IGZvdW5kYClcclxuICAgICAgICBjb250aW51ZVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGN1c3RvbSBlbnZpcm9ubWVudCAoc3dpdGNoaW5nIGF3YXkgZnJvbSBkZWZhdWx0OiBwcm9kdWN0aW9uKVxyXG4gICAgICBjb25zdCBjdXN0b21FbnZpcm9ubWVudCA9IHRvbmljRGl2LmdldEF0dHJpYnV0ZSh0aGlzLmNvbmZpZy5jdXN0b21FbnZpcm9ubWVudEF0dHJpYnV0ZSlcclxuICAgICAgdGhpcy5jb25maWcuc2V0RW52aXJvbm1lbnQoY3VzdG9tRW52aXJvbm1lbnQgfHwgJ3Byb2R1Y3Rpb24nKVxyXG5cclxuICAgICAgLy8gQWRkIHRvIHdpZGdldHMgbWFwXHJcbiAgICAgIHRoaXMud2lkZ2V0cy5zZXQod2lkZ2V0SWQsIG51bGwpXHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIC8vIEZpcmUgdGhlIHJlcXVlc3QgdG8gbG9hZCB0aGUgd2lkZ2V0IGRhdGFcclxuICAgICAgICBjb25zdCBwcm9taXNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgICAgICBgJHt0aGlzLmNvbmZpZy5hcGlVcmx9L3YxL3dpZGdldHMvZGlzcGxheS8ke3dpZGdldElkfT9wcm92aWRlcj1lbWJlZC0ke3RoaXMuY29uZmlnLnZlcnNpb259YFxyXG4gICAgICAgIClcclxuXHJcbiAgICAgICAgdmFyIHJlc3BvbnNlXHJcblxyXG4gICAgICAgIC8vIEhhbmRsZSBkb21haW4gbm90IGFsbG93ZWRcclxuICAgICAgICBpZiAocHJvbWlzZS5zdGF0dXMgPT09IDQwMykge1xyXG4gICAgICAgICAgY29uc29sZS5pbmZvKGAke3Byb21pc2Uuc3RhdHVzfTogRG9tYWluIG5vdCBhbGxvd2VkYClcclxuICAgICAgICAgIHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICBsaW5rX3VybDogJ2h0dHBzOi8vdG9uaWNwb3cuY29tJyxcclxuICAgICAgICAgICAgaW1hZ2VfdXJsOiBmYWxsYmFja0ltYWdlLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBHZXQgSlNPTiByZXNwb25zZVxyXG4gICAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBwcm9taXNlLmpzb24oKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2V0IFVSSSBlbmNvZGVkIHRpdGxlXHJcbiAgICAgICAgY29uc3QgY2FtcGFpZ25UaXRsZSA9IGVuY29kZVVSSUNvbXBvbmVudChyZXNwb25zZS50aXRsZSlcclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBIVE1MXHJcbiAgICAgICAgdG9uaWNEaXYuaW5uZXJIVE1MID0gYFxyXG4gICAgICA8YSBocmVmPVwiJHtyZXNwb25zZS5saW5rX3VybH0/dXRtX3NvdXJjZT10b25pY3Bvdy13aWRnZXRzJnV0bV9tZWRpdW09d2lkZ2V0JnV0bV9jYW1wYWlnbj0ke3dpZGdldElkfSZ1dG1fY29udGVudD0ke2NhbXBhaWduVGl0bGV9XCIgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2tcIj5cclxuICAgICAgPGltZyBzcmM9XCIke3Jlc3BvbnNlLmltYWdlX3VybH1cIiBcclxuICAgICAgd2lkdGg9XCIke3Jlc3BvbnNlLndpZHRofVwiIFxyXG4gICAgICBoZWlnaHQ9XCIke3Jlc3BvbnNlLmhlaWdodH1cIiBcclxuICAgICAgYWx0PVwiJHtyZXNwb25zZS50aXRsZX1cIiAvPlxyXG4gICAgICA8L2E+YFxyXG5cclxuICAgICAgICAvLyBTZXQgd2lkZ2V0IGRpbWVzaW9uc1xyXG4gICAgICAgIHRvbmljRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS13aWR0aCcsIHJlc3BvbnNlLndpZHRoKVxyXG4gICAgICAgIHRvbmljRGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1oZWlnaHQnLCByZXNwb25zZS5oZWlnaHQpXHJcblxyXG4gICAgICAgIC8vIEFkZCB0byB3aWRnZXRzIG1hcFxyXG4gICAgICAgIHRoaXMud2lkZ2V0cy5zZXQod2lkZ2V0SWQsIHJlc3BvbnNlIGFzIHR5cGVvZiBXaWRnZXQpXHJcblxyXG4gICAgICAgIC8vIEZpcmUgb25XaWRnZXRMb2FkZWQgY2FsbGJhY2sgaWYgcHJvdmlkZWRcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5vbldpZGdldExvYWRlZCkge1xyXG4gICAgICAgICAgcmVzcG9uc2UuaWQgPSB3aWRnZXRJZFxyXG4gICAgICAgICAgdGhpcy5vcHRpb25zLm9uV2lkZ2V0TG9hZGVkKHJlc3BvbnNlIGFzIHR5cGVvZiBXaWRnZXQpXHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgdGhyb3cgZVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBMb2FkIHRoZSBUb25pY1BvdyBzY3JpcHQocykgYW5kIGRlZmF1bHQgc2V0dGluZ3NcclxuICBsb2FkID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gV2Ugb25seSB3b3JrIGluIGEgYnJvd3NlclxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RvbmljUG93IGVtYmVkIG9ubHkgd29ya3MgaW4gdGhlIGJyb3dzZXInKVxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBMb2FkIGFsbCB0b25pY3MgZm91bmQgb24gdGhlIHBhZ2UgKGlmIHdlIGhhdmUgZGl2KVxyXG4gICAgY29uc3QgdG9uaWNEaXZzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLmNvbmZpZy53aWRnZXREaXZDbGFzcylcclxuICAgIGlmICh0b25pY0RpdnMgJiYgdG9uaWNEaXZzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCB0aGlzLmxvYWREaXZzKClcclxuICAgICAgICBjb25zb2xlLmxvZygnJWMgVG9uaWNQb3cgd2lkZ2V0KHMpIGxvYWRlZCEgJywgJ2JhY2tncm91bmQ6ICM5NzRDRDI7IGNvbG9yOiAjZmZmJylcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHRocm93IGVcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2Nlc3MgdmlzaXRvciB0b2tlblxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuY2FwdHVyZVZpc2l0b3JTZXNzaW9uKClcclxuXHJcbiAgICAvLyBDYXB0dXJlIGV2ZW50cyBpZiB3ZSBoYXZlIGEgc2Vzc2lvblxyXG4gICAgaWYgKHNlc3Npb24pIHtcclxuICAgICAgdGhpcy5ldmVudHMgPSBuZXcgRXZlbnRzKHNlc3Npb24sIHRoaXMuY29uZmlnKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8gQXV0by1sb2FkIGFuZCBzZXQgb24gd2luZG93XHJcbnZhciB0cG93ID0gbmV3IFRvbmljUG93KClcclxuXHJcbjsod2luZG93IGFzIGFueSkuVG9uaWNQb3cgPSB0cG93IHx8IHt9XHJcbiIsIi8qIGdsb2JhbCBsb2NhbFN0b3JhZ2UgKi9cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0b3JhZ2Uge1xyXG4gIC8qXHJcbiAgcmVtb3ZlU3RvcmFnZTogcmVtb3ZlcyBhIGtleSBmcm9tIGxvY2FsU3RvcmFnZSBhbmQgaXRzIHNpYmxpbmcgZXhwaXJhY3kga2V5XHJcbiAgcGFyYW1zOlxyXG4gICAgICBrZXkgPHN0cmluZz4gOiBsb2NhbFN0b3JhZ2Uga2V5IHRvIHJlbW92ZVxyXG4gIHJldHVybnM6XHJcbiAgICAgIDxib29sZWFuPiA6IHRlbGxpbmcgaWYgb3BlcmF0aW9uIHN1Y2NlZWRlZFxyXG4gICovXHJcbiAgcmVtb3ZlU3RvcmFnZSA9IChuYW1lOiBzdHJpbmcpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKG5hbWUpXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGAke25hbWV9X2V4cGlyZXNJbmApXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgIGByZW1vdmVTdG9yYWdlOiBFcnJvciByZW1vdmluZyBrZXkgWyR7bmFtZX1dIGZyb20gbG9jYWxTdG9yYWdlOiAke0pTT04uc3RyaW5naWZ5KGUpfWBcclxuICAgICAgKVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlXHJcbiAgfVxyXG5cclxuICAvKlxyXG4gIGdldFN0b3JhZ2U6IHJldHJpZXZlcyBhIGtleSBmcm9tIGxvY2FsU3RvcmFnZSBwcmV2aW91c2x5IHNldCB3aXRoIHNldFN0b3JhZ2UoKS5cclxuICBwYXJhbXM6XHJcbiAgICAgIGtleSA8c3RyaW5nPiA6IGxvY2FsU3RvcmFnZSBrZXlcclxuICByZXR1cm5zOlxyXG4gICAgICA8c3RyaW5nPiA6IHZhbHVlIG9mIGxvY2FsU3RvcmFnZSBrZXlcclxuICAgICAgbnVsbCA6IGluIGNhc2Ugb2YgZXhwaXJlZCBrZXkgb3IgZmFpbHVyZVxyXG4gICovXHJcbiAgZ2V0U3RvcmFnZSA9IChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgLy8gZXBvY2ggdGltZSwgbGV0cyBkZWFsIG9ubHkgd2l0aCBpbnRlZ2VyXHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXHJcblxyXG4gICAgLy8gU2V0IGV4cGlyYXRpb24gZm9yIHN0b3JhZ2VcclxuICAgIGxldCBleHBpcmVzXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgZXhwaXJlcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGAke2tleX1fZXhwaXJlc2ApXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBnZXRJdGVtOiBlcnJvciBnZXR0aW5nIGxvY2FsU3RvcmFnZTogJHtKU09OLnN0cmluZ2lmeShlKX1gKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG5cclxuICAgIGlmIChleHBpcmVzID09PSB1bmRlZmluZWQgfHwgZXhwaXJlcyA9PT0gbnVsbCkge1xyXG4gICAgICBleHBpcmVzID0gMFxyXG4gICAgfVxyXG5cclxuICAgIC8vIEV4cGlyZWRcclxuICAgIGlmIChleHBpcmVzIDwgbm93KSB7XHJcbiAgICAgIHRoaXMucmVtb3ZlU3RvcmFnZShrZXkpXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHRoZSBleGlzdGluZyBpdGVtXHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgZ2V0U3RvcmFnZTogRXJyb3IgcmVhZGluZyBrZXkgWyR7a2V5fV0gZnJvbSBsb2NhbFN0b3JhZ2U6ICR7SlNPTi5zdHJpbmdpZnkoZSl9YClcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qXHJcbiAgc2V0U3RvcmFnZTogd3JpdGVzIGEga2V5IGludG8gbG9jYWxTdG9yYWdlIHNldHRpbmcgYSBleHBpcmUgdGltZVxyXG4gIHBhcmFtczpcclxuICAgICAga2V5IDxzdHJpbmc+ICAgICA6IGxvY2FsU3RvcmFnZSBrZXlcclxuICAgICAgdmFsdWUgPHN0cmluZz4gICA6IGxvY2FsU3RvcmFnZSB2YWx1ZVxyXG4gICAgICBleHBpcmVzIDxudW1iZXI+IDogbnVtYmVyIG9mIHNlY29uZHMgZnJvbSBub3cgdG8gZXhwaXJlIHRoZSBrZXlcclxuICByZXR1cm5zOlxyXG4gICAgICA8Ym9vbGVhbj4gOiB0ZWxsaW5nIGlmIG9wZXJhdGlvbiBzdWNjZWVkZWRcclxuICAqL1xyXG4gIHNldFN0b3JhZ2UgPSAoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIGV4cGlyZXM6IG51bWJlciB8IG51bGwgPSBudWxsKSA9PiB7XHJcbiAgICAvLyBFeHBpcmVkIHRpbWVcclxuICAgIGlmIChleHBpcmVzKSB7XHJcbiAgICAgIGV4cGlyZXMgPSBNYXRoLmFicyhleHBpcmVzKSAvLyBtYWtlIHN1cmUgaXQncyBwb3NpdGl2ZVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZXhwaXJlcyA9IDI0ICogNjAgKiA2MCAvLyBkZWZhdWx0OiBzZWNvbmRzIGZvciAxIGRheVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE1pbGxpIHNlY29uZHMgc2luY2UgZXBvY2ggdGltZSwgbGV0cyBkZWFsIG9ubHkgd2l0aCBpbnRlZ2VyXHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXHJcbiAgICBjb25zdCBzY2hlZHVsZSA9IG5vdyArIGV4cGlyZXMgKiAxMDAwXHJcbiAgICB0cnkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKVxyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtrZXl9X2V4cGlyZXNgLCBzY2hlZHVsZS50b1N0cmluZygpKVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgc2V0U3RvcmFnZTogRXJyb3Igc2V0dGluZyBrZXkgWyR7a2V5fV0gaW4gbG9jYWxTdG9yYWdlOiAke0pTT04uc3RyaW5naWZ5KGUpfWApXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWVcclxuICB9XHJcbn1cclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0aWYoX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSkge1xuXHRcdHJldHVybiBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNjA3KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=